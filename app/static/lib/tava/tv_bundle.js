function mOverview(){function e(e){var t=e.append("svg").attr("class","ov"),r=t.append("g").attr({class:"chartHolder",transform:"translate(0,0)"});a=function(a){if(o.display.sizeToFit||a&&a.sizeToFit){var s=e.node().getBoundingClientRect();o.width=Math.max(s.width,300),o.height=o.width/4}t.attr({width:o.width,height:o.height});var l=r.selectAll(".frame").data([0]);l.enter().append("rect").attr({class:"frame"}),l.exit().remove(),l.attr({height:o.height,width:o.width,fill:"white",stroke:"blue",opacity:0});var c=r.selectAll(".divider").data([0]);c.enter().append("line").attr({class:"divider"}),c.exit().remove(),c.attr({stroke:"black",x1:.05*o.width,x2:.95*o.width,y1:o.height/2,y2:o.height/2});var u=.05*o.width,d=0,p=r.selectAll(".player").data(n.teams());p.enter().append("text").attr({class:"player"}),p.exit().remove(),p.text(function(e){return e}).style({"font-size":u+"px",fill:function(e){return o.display.highlight_winner?e==n.score().winner?o.colors.players[n.teams().indexOf(e)]:"black":o.colors.players[n.teams().indexOf(e)]},"font-weight":function(e){return e==n.score().winner?"bold":"normal"}}).attr({length:function(){var e=this.getComputedTextLength();e>d&&(d=e)}}).translate(function(e,t){return[.045*o.width,.38*o.height+t*o.height*.4]});var f=n.score().sets.map(function(e){var t=e.games.map(function(t,r){return[r,t,e.tiebreak]});return t[0][1]>t[1][1]?t[0][3]="leads":t[0][1]<t[1][1]&&(t[1][3]="leads"),t});if(f=f.length?f.reduce(function(e,t){return e.concat(t)}).reverse():[[0,0],[1,0]],n.score().point_score){var h=n.score().point_score.split("-");f.unshift([0,h[0],void 0,"points"]),f.unshift([1,h[1],void 0,"points"])}var m=r.selectAll(".pointsDivider").data(n.score().point_score?[0]:[]);m.enter().append("line").attr({class:"pointsDivider"}),m.exit().remove(),m.attr({stroke:"gray",x1:.9*o.width-.25*u*i,x2:.9*o.width-.25*u*i,y1:.25*o.height,y2:.75*o.height});var v=r.selectAll(".gamescore").data(f);v.enter().append("text").attr({class:"gamescore"}),v.exit().remove(),v.text(function(e){return e[1]}).style({"font-size":u+"px",fill:function(e){return"leads"==e[3]?o.colors.players[e[0]]:"points"==e[3]?"red":"black"},"font-weight":function(e){return"leads"==e[3]?"bold":"normal"}}).translate(function(e,t){return[.9*o.width-Math.floor(t/2)*u*i,.38*o.height+e[0]*o.height*.4]});var g=v.selectAll(".super").data(function(e){return[e]});g.enter().append("tspan").attr("class","super").attr("baseline-shift","super"),g.exit().remove(),g.style({"font-size":.8*u+"px"}).text(function(e){if(void 0!=e[2]&&6==e[1])return e[2]})}}function t(e,r){if(e&&r)for(var n=Object.keys(e),a=Object.keys(r),i=0;i<n.length;i++)if(a.indexOf(n[i])>=0){var o=r[n[i]],s=e[n[i]];"object"==typeof o&&"function"!=typeof s&&o.constructor!==Array?t(e[n[i]],r[n[i]]):r[n[i]]=e[n[i]]}}function r(){o.display.responsive&&e.update()}var n,a,i=1.5,o={width:window.innerWidth,height:window.innerHeight,margins:{top:30,bottom:20,left:10,right:10},display:{sizeToFit:!0,responsive:!1,highlight_winner:!0},colors:{players:{0:"#a55194",1:"#6b6ecf"}}},s={update:{begin:null,end:null}};return e.exports=function(){return{}},e.options=function(r){return arguments.length?(t(r,o),e):o},e.events=function(r){return arguments.length?(t(r,s),e):s},e.width=function(t){return arguments.length?(o.width=t,e):o.width},e.height=function(t){return arguments.length?(o.height=t,e):o.height},e.data=function(t){return arguments.length?(n=t,e):n},e.update=function(e){s.update.begin&&s.update.begin(),"function"==typeof a&&n&&a(e),setTimeout(function(){s.update.end&&s.update.end()},o.display.transition_time)},e.colors=function(t){if(!arguments.length)return colors;if("object"!=typeof t)return!1;var r=Object.keys(t);return!!r.length&&(r.forEach(function(e){/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t[e])||delete t[e]}),Object.keys(t).length?colors=t:colors=JSON.parse(JSON.stringify(default_colors)),e)},window.addEventListener("resize",r,!1),e}function statView(){function e(){return d.fullWidth-d.margins.left-d.margins.right}function t(){return d.fullHeight-d.margins.top-d.margins.bottom}function r(){return d.fullRowHeight-d.margins.top-d.margins.bottom}function n(e){return"translate("+e[0]+","+e[1]+")"}function a(a){a.each(function(){l=d3.select(this);var i=l.append("div").attr("id",d.id);s=function(o){function s(e){var t=isNaN(e)?0:b(e),r=t<0||isNaN(t)?0:t;return r}function l(e){return d.rowHeight/2}function p(e,t){var r=t?d.width-b(e):0;return n([isNaN(r)?0:r,d.rowHeight/2])}function f(e){if(void 0!=e.numerator){var t=e.numerator.reduce(function(e,t){return e+t});if(0!=t){var r=100*(e.numerator[0]/t).toFixed(1);r=r>100?100:r;var n=100-(isNaN(r)?0:r);return e.numerator[0]<0&&e.numerator[1]<0?[n,r]:[r,n]}if(e.numerator[0]>e.numerator[1])return[100,0];if(e.numerator[1]>e.numerator[0])return[0,100]}return[]}var h=c.filter(function(e){return e.numerator&&(e.numerator[0]||e.numerator[1])}),m=a.node().getBoundingClientRect();(d.display.sizeToFit.width||o&&o.sizeToFit&&o.sizeToFit.width)&&(d.fullWidth=Math.max(m.width,100)),(d.display.sizeToFit.height||o&&o.sizeToFit&&o.sizeToFit.height)&&(d.fullHeight=Math.max(m.height,100)),d.width=e(),d.height=t(),d.rowHeight=r(),d.marginTranslate=[d.margins.left,d.margins.top];var v=.5*d.rowHeight,g=i.selectAll("svg").data(h);g.enter().append("svg").attr("id",function(e,t){return d.id+"i"+t}),g.exit().remove(),g.attr("width",function(e){return d.fullWidth}).attr("height",function(e){return d.fullRowHeight});var y=g.selectAll("g").data(function(e){return[e]});y.enter().append("g"),y.exit().remove(),y.attr("width",function(e){return d.fullWidth}).attr("height",function(e){return d.rowHeight}).attr("transform",function(e){return n(d.marginTranslate)});var x=y.selectAll("text").data(function(e){var t=[],r=void 0!=e.numerator&&void 0!=e.denominator?e.numerator[0]+"/"+e.denominator[0]:void 0!=e.numerator?e.numerator[0]:"",n=void 0!=e.numerator&&void 0!=e.denominator?e.numerator[1]+"/"+e.denominator[1]:void 0!=e.numerator?e.numerator[1]:"";return void 0!=e.pct&&(d.width>400?(r=Math.round(e.pct[0])+"% ("+r+")",n=Math.round(e.pct[1])+"% ("+n+")"):(r=Math.round(e.pct[0])+"%",n=Math.round(e.pct[1])+"%")),t.push({text:e.name,anchor:"middle",translate:[d.fullWidth/2,d.rowHeight/4]}),t.push({text:r,anchor:"start",translate:[0,d.rowHeight/4]}),t.push({text:n,anchor:"end",translate:[d.width,d.rowHeight/4]}),t});x.enter().append("text"),x.exit().remove(),x.text(function(e){return e.text}).style({"text-anchor":function(e){return e.anchor},"alignment-baseline":"middle","font-size":v+"px",fill:"black","font-weight":function(e){return"normal"}}).attr("transform",function(e){return n(e.translate)});var b=d3.scale.linear().domain([0,100]).range([0,d.width]),w=y.selectAll("rect").data(f);w.enter().append("rect").attr({width:s,height:l,fill:function(e,t){return d.colors.players[t]},transform:p}),w.exit().remove(),w.transition().duration(u).attr({width:s,height:l,fill:function(e,t){return d.colors.players[t]},transform:p})}})}function i(e,t){if(e&&t)for(var r=Object.keys(e),n=Object.keys(t),a=0;a<r.length;a++)if(n.indexOf(r[a])>=0){var o=t[r[a]],s=e[r[a]];"object"==typeof o&&"function"!=typeof s&&o.constructor!==Array?i(e[r[a]],t[r[a]]):t[r[a]]=e[r[a]]}}function o(){d.display.responsive&&a.update()}var s,l,c=[],u=1e3,d={id:"sv",fullWidth:window.innerWidth,fullHeight:300,fullRowHeight:30,margins:{top:2,bottom:2,left:10,right:10},display:{sizeToFit:{width:!0,height:!1},responsive:!1},colors:{players:{0:"#a55194",1:"#6b6ecf"}}},p={update:{begin:null,end:null}};return a.options=function(e){return arguments.length?(i(e,d),a):d},a.update=function(e){p.update.begin&&p.update.begin(),"function"==typeof s&&c&&s(e),setTimeout(function(){p.update.end&&p.update.end()},d.display.transition_time)},a.data=function(e){return arguments.length?(c=e,a):c},window.addEventListener("resize",o,!1),a}function ptsMatch(){function e(e){a=e;for(var t=a.append("div").attr("class",i.class+"root").style("width",i.width+"px").style("height",i.height+"px"),s=0;s<5;s++)o[s]=t.append("div").attr("class","pts").style("display","none"),o[s].call(pts_charts[s]);n=function(){for(var e=r.sets(),n=0,a=0;a<pts_charts.length;a++)e[a]&&e[a].points().length?(o[a].style("display","inline"),pts_charts[a].update(),n+=+i.height+5):o[a].style("display","none");t.style("width",i.width+"px").style("height",n+"px")}}function t(e,r){if(e&&r)for(var n=Object.keys(e),a=Object.keys(r),i=0;i<n.length;i++)if(a.indexOf(n[i])>=0){var o=r[n[i]],s=e[n[i]];"object"==typeof o&&"function"!=typeof s&&o&&o.constructor!==Array?t(e[n[i]],r[n[i]]):r[n[i]]=e[n[i]]}}var r,n,a,i={id:0,class:"ptsMatch",resize:!0,width:window.innerWidth,height:80,margins:{top:5,right:15,bottom:5,left:5},set:{average_points:56},lines:{width:2,interpolation:"linear"},points:{max_width_points:100},score:{font:"Arial",font_size:"12px",font_weight:"bold",reverse:!0},header:{font:"Arial",font_size:"14px",font_weight:"bold"},display:{sizeToFit:!0,transition_time:0,point_highlighting:!0,point_opacity:.4,win_err_highlight:!0,game_highlighting:!0,game_opacity:.2,game_boundaries:!0,gamepoints:!1,score:!0,points:!0,winner:!0},colors:{orientation:"yellow",gamepoints:"black",players:{0:"#a55194",1:"#6b6ecf"}}},o=[];pts_charts=[];for(var s=0;s<5;s++)pts_charts.push(ptsChart());var l={update:{begin:null,end:null},set_box:{mouseover:null,mouseout:null},update:{begin:null,end:null},point_bars:{mouseover:null,mouseout:null,click:null}};return e.options=function(r){return arguments.length?(t(r,i),e):i},e.events=function(r){return arguments.length?(t(r,l),e):l},e.colors=function(t){return arguments.length?(i.colors.players=t,e):i.colors},e.width=function(t){return arguments.length?(i.width=t,"function"==typeof n&&n(!0),pts_charts.forEach(function(e){e.width(t)}),e):i.width},e.height=function(t){return arguments.length?(i.height=t,"function"==typeof n&&n(!0),pts_charts.forEach(function(e){e.height(t)}),e):i.height},e.duration=function(t){return arguments.length?(i.display.transition_time=t,e):i.display.transition_time},e.update=function(e){e=e?e:i.resize,l.update.begin&&l.update.begin();var t=r.sets();return t.forEach(function(r,n){pts_charts[n].data(t[n]),pts_charts[n].options({id:n,resize:e}),pts_charts[n].options({lines:i.lines,points:i.points,score:i.score,header:i.header}),pts_charts[n].options({set:i.set,display:i.display,colors:i.colors}),pts_charts[n].events(l),pts_charts[n].width(i.width).height(i.height).update()}),"function"==typeof n&&n(e),setTimeout(function(){l.update.end&&l.update.end()},i.display.transition_time),!0},e.data=function(t){return arguments.length?"function"==typeof t&&"UMO"==t.type&&(r=t,void e.update()):r},e}function ptsChart(){function e(e){e.each(function(){u=d3.select(this);var e=u.append("svg").attr("class",f.class+"root").style("width",f.width+"px").style("height",f.height+"px"),i=e.append("g").attr("class",f.class+"pts").attr("transform","translate(5, 5)"),m=e.append("g").attr("class",f.class+"pts").attr("transform","translate(5, 5)"),v=i.append("text").attr("class",f.class+"Header").attr("opacity",0).attr("font-size",f.header.font_size).attr("font-weight",f.header.font_weight).attr("x",function(e,t){return f.margins.left+"px"}).attr("y",function(e,t){return f.margins.top+8+"px"}),g=i.append("text").attr("class",f.class+"Score").attr("opacity",0).attr("font-size",f.score.font_size).attr("font-weight",f.score.font_weight).attr("x",function(e,t){return f.margins.left+"px"}).attr("y",function(e,t){return f.margins.top+20+"px"}),y=i.append("text").attr("class",f.class+"Points").attr("opacity",0).attr("font-size",f.score.font_size).attr("font-weight",f.score.font_weight).attr("x",function(e,t){return f.margins.left+40+"px"}).attr("y",function(e,t){return f.margins.top+20+"px"});c=function(c){function u(e){var t="",r=o.score();if(r&&r.legend&&(t=r.legend),v.transition().duration(e?0:f.display.transition_time).attr("opacity",1).attr("fill",f.colors.players[r?r.leader:""]).text(t),!l[0].length||0!=a(l[0]).pts&&0!=a(l[1]).pts)w.length?x(w.length-1):(v.transition().duration(e?0:f.display.transition_time).attr("opacity",0),g.transition().duration(e?0:f.display.transition_time).attr("opacity",0),y.transition().duration(e?0:f.display.transition_time).attr("opacity",0));else{var n=w[w.length-1].winner,i=r.game_score;if(n){var s=i.split(" "),c=s[0].split("(");i=c?c[0].split("-").reverse().join("-"):s[0].split("-").reverse().join("-"),c[1]&&(i+="("+c[1]),s[1]&&(i+=s[1])}g.transition().duration(e?0:f.display.transition_time).attr("opacity",1).attr("fill",f.colors.players[n]).text(i),y.transition().duration(e?0:f.display.transition_time).attr("opacity",0)}}function x(e){if(w[e]){var t=o.score(e),r=t.point_score;f.score.reverse&&w[e].server&&(r=r.split("-").reverse().join("-")),!l[0][e+1]||0!=l[0][e+1].pts&&0!=l[1][e+1].pts||i.selectAll("."+f.class+"Game").attr("opacity",f.display.game_opacity),v.transition().duration(100).attr("opacity",1).attr("fill",function(){return void 0!=t.leader?f.colors.players[t.leader]:"black"}).text(t.legend),g.transition().duration(100).attr("opacity",1).attr("fill",function(){return void 0!=t.leader?f.colors.players[t.leader]:"black"}).text(t.game_score),y.transition().duration(100).attr("opacity",1).attr("fill",function(){return void 0!=t.leader?f.colors.players[t.leader]:"black"}).text(r)}}function b(e,t){var r=0,n=0,a=0;if(f.display.win_err_highlight){var i=e.rally,o=e.result,s=i?100-Math.floor(i.length/S*100):100;d.indexOf(o)>=0?r=s:p.indexOf(o)>=0?n=s:a=s}return[{offset:"0%",color:"blue"},{offset:a+"%",color:"blue"},{offset:a+"%",color:"green"},{offset:a+r+"%",color:"green"},{offset:a+r+"%",color:"red"},{offset:a+r+n+"%",color:"red"},{offset:a+r+n+"%",color:f.colors.orientation},{offset:"100%",color:f.colors.orientation}]}if(!o)return!1;e.transition().duration(c?0:f.display.transition_time).style("width",f.width+"px").style("height",f.height+"px");var w=o.points(),_=o.options();s=o.games(),l=o.player_data();var k=_.set.games/2*4,S=Math.max.apply(null,w.map(function(e){return e.rally?e.rally.length:0}))+2;u(c);var O=d3.scale.linear().domain([0,n()]).range([0,f.width-(f.margins.left+f.margins.right)]),A=d3.scale.linear().range([f.height-(f.margins.top+f.margins.bottom),f.margins.bottom]).domain([-2,k-1]),T=i.selectAll("."+f.class+"SetBox").data([f.id]);T.enter().append("rect").attr("class",f.class+"SetBox").style("position","relative").attr("height",function(){return f.height-(f.margins.top+f.margins.bottom)}).attr("width",function(){return O(r()+1)}).attr("stroke","black").attr("stroke-width",1).attr("fill","none").on("mouseover",function(e,t){h.set_box.mouseover&&h.set_box.mouseover(e,t)}).on("mouseout",function(e,t){h.set_box.mouseout&&h.set_box.mouseout(e,t)}),T.exit().transition().duration(c?0:f.display.transition_time).style("opacity",0).remove(),T.transition().duration(c?0:f.display.transition_time).attr("height",function(){return f.height-(f.margins.top+f.margins.bottom)}).attr("width",function(){return O(r()+1)});var P=i.selectAll("."+f.class+"GameBoundary").data(s);P.enter().append("rect").attr("class",f.class+"GameBoundary"),P.exit().remove(),P.attr("id",function(e,t){return f.class+f.id+"boundary"+t}).transition().duration(c?0:f.display.transition_time).attr("opacity",function(){return f.display.game_boundaries?.02:0}).attr("transform",function(e,t){return"translate("+O(e.range[0])+", 0)"}).attr("height",A(-2)).attr("width",function(e){return O(e.range[1]+1)-O(e.range[0])}).attr("stroke","black").attr("stroke-width",1).attr("fill","none");var R=i.selectAll("."+f.class+"Game").data(s);R.enter().append("rect").attr("class",f.class+"Game"),R.exit().remove(),R.attr("id",function(e,t){return f.class+f.id+"game"+t}).transition().duration(c?0:f.display.transition_time).attr("opacity",function(){return f.display.game_boundaries?.02:0}).attr("transform",function(e,t){return"translate("+O(e.range[0])+", 0)"}).attr("height",A(-2)).attr("width",function(e){return O(e.range[1]+1)-O(e.range[0])}).attr("stroke",function(e){return f.colors.players[e.winner]}).attr("stroke-width",1).attr("fill",function(e){return f.colors.players[e.winner]});var M=d3.svg.line().x(function(e,t){return O(t)}).y(function(e){return A(k-e.pts)}),E=i.selectAll("."+f.class+"Line").data([0,1]);E.enter().append("path").attr("class",f.class+"Line").attr("id",function(e){return f.class+f.id+"player"+e+"Line"}).attr("fill","none"),E.exit().remove(),E.transition().duration(c?0:f.display.transition_time/2).style("opacity",.1).transition().duration(c?0:f.display.transition_time/2).style("opacity",1).attr("stroke",function(e){return f.colors.players[e]}).attr("stroke-width",function(e){return f.lines.width}).attr("d",function(e){return M(l[e])});var C=i.selectAll("."+f.class+"BPWrapper").data(l);C.enter().append("g").attr("class",f.class+"BPWrapper");var j=C.selectAll("."+f.class+"Breakpoint").data(function(e,r){return t(e,r)});j.enter().append("circle").attr("class",f.class+"Breakpoint").attr("opacity","0"),j.exit().attr("opacity","0").remove(),j.transition().duration(c?0:f.display.transition_time/2).style("opacity",0).transition().duration(c?0:f.display.transition_time/2).attr("fill",function(e,t){return w[t-1]&&void 0!=w[t-1].breakpoint?f.colors.players[e._i]:w[t-1]&&void 0!=w[t-1].gamepoint?f.colors.gamepoints:void 0}).style("opacity",function(e,t){if(w[t-1]){if(void 0!=w[t-1].breakpoint)return w[t-1].breakpoint==e._i?1:0;if(void 0!=w[t-1].gamepoint&&f.display.gamepoints)return w[t-1].gamepoint==e._i?1:0}}).attr("cx",function(e,t){return O(t)}).attr("cy",function(e){return A(k-e.pts)}).attr("r",2);var F=d3.range(w.length),W=d3.scale.ordinal().domain(F).rangeBands([0,O(w.length)],0,0),z=d3.scale.linear().domain([0,w.length]).range([0,O(w.length)]);i.selectAll(".gradient"+f.id).remove();var N=i.selectAll(".gradient"+f.id).data(d3.range(w.length));N.enter().append("linearGradient").attr("id",function(e,t){return"gradient"+f.id+t}).attr("class",function(){return"gradient"+f.id}).attr("gradientUnits","userSpaceOnUse").attr("x1",function(e){return W.rangeBand()/2}).attr("y1",function(e){return 0}).attr("x2",function(e){return W.rangeBand()/2}).attr("y2",function(e){return A(-2)}),N.exit().remove(),N.attr("transform",function(e,t){return"translate("+z(t)+", 0)"});var B=N.selectAll(".points_stop").data(function(e,t){return b(w[e],t)});B.enter().append("stop").attr("class","points_stop").attr("offset",function(e){return e.offset}).attr("stop-color",function(e){return e.color}),B.exit().remove(),B.attr("offset",function(e){return e.offset});var D=m.selectAll("."+f.class+"Bar").data(d3.range(w.length));D.enter().append("line").attr("class",f.class+"Bar").attr("opacity","0"),D.exit().transition().duration(c?0:f.display.transition_time).attr("opacity","0").remove(),D.attr("opacity","0").attr("transform",function(e,t){return"translate("+z(t)+", 0)"}).attr("x1",function(e){return W.rangeBand()/2}).attr("y1",function(e){return 0}).attr("x2",function(e){return W.rangeBand()/2}).attr("y2",function(e){return A(-2)}).attr("stroke-width",function(){return W.rangeBand()}).attr("stroke",function(e,t){return"url(#gradient"+f.id+t+")"}).attr("uid",function(e,t){return"point"+t}).on("mousemove",function(e,t){f.display.point_highlighting&&d3.select(this).attr("opacity",f.display.point_opacity),f.display.game_highlighting&&w[t]&&d3.select('[id="'+f.class+f.id+"game"+w[t].game+'"]').attr("opacity",f.display.game_opacity),h.point_bars.mouseover&&h.point_bars.mouseover(w[e],t),0==e&&m.selectAll("."+f.class+"Bar").attr("opacity",f.display.point_opacity),x(e,t)}).on("mouseout",function(e,t){m.selectAll("."+f.class+"Bar").attr("opacity",0),i.selectAll("."+f.class+"Game").attr("opacity","0"),h.point_bars.mouseout&&h.point_bars.mouseout(w[e],t),u()}).on("click",function(e,t){h.point_bars.click&&h.point_bars.click(w[e],t,this)})}})}function t(e,t){for(var r=0;r<e.length;r++)e[r]._i=t;return e}function r(){var e=o.points().length-1,t=o.player_data(),r=e<f.set.average_points?f.set.average_points:t[0].length-1;return!t[0].length||0!=a(t[0]).pts&&0!=a(t[1]).pts||(r=e),r}function n(){var e=o.points().length-1,t=Math.max(e,f.points.max_width_points,f.set.average_points);return t}function a(e){return e[e.length-1]}function i(){f.display.responsive&&e.update()}var o,s,l,c,u,d=["Ace","Winner","Serve Winner"],p=["Forced Error","Unforced Error","Double Fault","Penalty","Out","Net"],f={id:0,class:"ptsChart",resize:!0,width:window.innerWidth,height:80,margins:{top:5,right:15,bottom:5,left:5},set:{average_points:56},lines:{width:2,interpolation:"linear"},points:{max_width_points:100},score:{font:"Arial",font_size:"12px",font_weight:"bold",reverse:!0},header:{font:"Arial",font_size:"14px",font_weight:"bold"},display:{transition_time:0,point_highlighting:!0,point_opacity:.4,win_err_highlight:!0,game_highlighting:!0,game_opacity:.2,game_boundaries:!1,gamepoints:!1,score:!0,points:!0,winner:!0},colors:{orientation:"yellow",gamepoints:"black",players:{0:"blue",1:"purple"}}},h={set_box:{mouseover:null,mouseout:null},update:{begin:null,end:null},point_bars:{mouseover:null,mouseout:null,click:null}};return e.options=function(t){if(!arguments.length)return f;for(var r=Object.keys(t),n=Object.keys(f),a=0;a<r.length;a++)if(n.indexOf(r[a])>=0)if("object"==typeof f[r[a]])for(var i=Object.keys(t[r[a]]),o=Object.keys(f[r[a]]),s=0;s<i.length;s++)o.indexOf(i[s])>=0&&(f[r[a]][i[s]]=t[r[a]][i[s]]);else f[r[a]]=t[r[a]];return e},e.data=function(e){return arguments.length?void(o=e):o},e.events=function(t){if(!arguments.length)return h;for(var r=Object.keys(t),n=Object.keys(h),a=0;a<r.length;a++)n.indexOf(r[a])>=0&&(h[r[a]]=t[r[a]]);return e},e.colors=function(t){return arguments.length?(f.colors.players=t,e):f.colors},e.width=function(t){return arguments.length?(f.width=t,e):f.width},e.height=function(t){return arguments.length?(f.height=t,e):f.height},e.update=function(e){return h.update.begin&&h.update.begin(),"function"==typeof c&&c(e),setTimeout(function(){h.update.end&&h.update.end()},f.display.transition_time),!0},e.duration=function(t){return arguments.length?(f.display.transition_time=t,e):f.display.transition_time},window.addEventListener("resize",i,!1),e}function momentumChart(){function e(){return s.fullWidth-s.margins.left-s.margins.right}function t(){return s.fullHeight-s.margins.top-s.margins.bottom}function r(r){r.each(function(){dom_parent=d3.select(this);var n=dom_parent.append("div").attr("class","momentumRoot").attr("transform","translate(0, 0)"),l=n.append("svg").attr({class:"momentumFrame"});l.node().setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg"),l.node().setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");var c=l.append("g").attr("id","momentumBars"),d=l.append("g").attr("id","momentumFish"),p=l.append("g").attr("id","momentumGame");i=function(i){function f(e){return m(0,_?e.l:e.o-M,0)}function h(e,t){var r=_?k/3:s.height/3,n=t?S+r:S-r+3*M,a=-1*M*(_?.25:.5);return m(n,a,0)}function m(e,t,r){var n=_?e:t,a=_?t:e;return"translate("+n+","+a+") rotate("+r+")"}function v(e,t){return M>20?2:1}function g(){var e;if("vertical"==s.display.orientation)e=s.width/2/(y()+1);else var t=s.width/(a.points().length+4),e=Math.sqrt(2*t*t);return Math.min(s.fish.max_cell_size,e)}function y(){var e=0,t=[0,0],r=a.winProgression().split("");return r.forEach(function(r){t[r]+=1;var n=Math.abs(t[0]-t[1]);n>e&&(e=n)}),e}function x(){s.display.settingsImg&&N.attr("opacity",1)}function b(){s.display.settingsImg&&N.attr("opacity",0)}if(s.display.sizeToFit||i&&i.sizeToFit){var w=r.node().getBoundingClientRect();"vertical"==s.display.orientation?(s.fullWidth=Math.max(w.width,100),s.fullHeight=Math.max(w.height,100)):s.fullHeight=g()*y()*2}s.height=t(),s.width=e();var _="vertical"==s.display.orientation?1:0,k=_?s.width:s.height,S=(_?s.height:s.width,k/2),O=0,A=[],T=a.sets();T.forEach(function(e){var t=e.games();t.forEach(function(r,n){var a=e.points().slice(r.range[0],r.range[1]+1);a.forEach(function(e){void 0!=e.rally&&e.rally.length>O&&(O=e.rally.length)}),A.push({points:a,score:r.score,last_game:t.length==n+1})})});var P=g(),R=o.slice(A.length);R.forEach(function(e){d3.selectAll(".c"+e.options().id).remove()}),o=o.slice(0,A.length);var M,E=[0,0],C=[];A.forEach(function(e,t){o[t]||(o.push(gameFish()),l.call(o[t]),o[t].g({bars:c.append("g").attr("class","cGF"+t),fish:d.append("g").attr("class","cGF"+t),game:p.append("g").attr("class","cGF"+t)}),o[t].options({id:"GF"+t,display:{score:!1,point_score:!1}})),o[t].width(k).height(k),o[t].options({score:e.score,fish:{cell_size:P,max_rally:O},display:{orientation:s.display.orientation,service:s.display.service,rally:s.display.rally,player:s.display.player,grid:s.display.grid},colors:{players:{0:s.colors.players[0],1:s.colors.players[1]}}}),o[t].data(e.points),o[t].coords(E).update();var r=o[t].coords();E[0]+=_?r[0]:r[1]-r[2]/2,E[1]+=_?r[1]:r[0]+r[2]/2,C.push({score:e.score,l:E[1]+1.75*r[2],o:E[0]+1.75*r[2],set_end:e.last_game}),e.last_game&&!s.display.continuous&&(E[_?0:1]=0),M=r[2]/2}),n.attr({width:s.width+"px",height:(_?100+E[1]:s.height)+"px"}).on("mouseover",x).on("mouseout",b),l.attr({width:s.width+"px",height:(_?100+E[1]:s.height)+"px"});var j=d.selectAll(".midline"+s.id).data([0]);j.enter().append("line").attr({class:"midline"+s.id,x1:_?S:M,x2:_?S:E[0]+5*(M||0),y1:_?M:S,y2:_?E[1]+5*M:S,"stroke-width":v,stroke:"#ccccdd"}),j.exit().remove(),j.transition().duration(s.display.transition_time).attr({x1:_?S:M,x2:_?S:E[0]+5*(M||0),y1:_?M:S,y2:_?E[1]+5*M:S,"stroke-width":v,stroke:"#ccccdd"});var F=d.selectAll(".score_line"+s.id).data(C);if(F.enter().append("line").attr({class:"score_line"+s.id,x1:function(e){return _?2*P:e.o},x2:function(e){return _?k-2*P:e.o},y1:function(e){return _?e.l:3*P},y2:function(e){return _?e.l:k-3*P},"stroke-width":v,"stroke-dasharray":function(e){return e.set_end?"0":"5,5"},stroke:function(e){return e.set_end?"#000000":"#ccccdd"}}),F.exit().remove(),F.transition().duration(s.display.transition_time).attr({x1:function(e){return _?2*P:e.o},x2:function(e){return _?k-2*P:e.o},y1:function(e){return _?e.l:3*P},y2:function(e){return _?e.l:k-3*P},"stroke-width":v,"stroke-dasharray":function(e){return e.set_end?"0":"5,5"},stroke:function(e){return e.set_end?"#000000":"#ccccdd"}}),s.display.momentum_score){var W=d.selectAll(".score_text"+s.id).data(C);W.enter().append("g").attr("class","score_text"+s.id),W.exit().remove(),W.attr({transform:f});var z=W.selectAll(".score"+s.id).data(function(e){return e.score});z.enter().append("text").attr({class:"score"+s.id,transform:h,"font-size":4*M+"px",opacity:.1,"text-anchor":"middle"}),z.exit().remove(),z.transition().duration(s.display.transition_time).attr({transform:h,"font-size":4*M+"px",opacity:.1,"text-anchor":"middle"}).text(function(e){return e})}else d.selectAll(".score_text"+s.id).remove();if(s.display.settingsImg){var N=l.selectAll("image").data([0]);N.enter().append("image").attr({"xlink:href":s.display.settingsImg,x:0,y:0,height:"20px",width:"20px",opacity:0}).on("click",function(){u.settings.click&&u.settings.click()}),N.exit().remove()}else l.selectAll("image").remove()}})}function n(e,t){if(e&&t)for(var r=Object.keys(e),a=Object.keys(t),i=0;i<r.length;i++)if(a.indexOf(r[i])>=0){var o=t[r[i]],s=e[r[i]];"object"==typeof o&&"function"!=typeof s&&o.constructor!==Array?n(e[r[i]],t[r[i]]):t[r[i]]=e[r[i]]}}var a,i,o=[],s={id:"m1",fullWidth:window.innerWidth,fullHeight:window.innerHeight,margins:{top:1,bottom:1,left:3,right:3},fish:{gridcells:["0","15","30","40","G"],tailcells:["D","A","G"],cell_size:void 0,min_cell_size:5,max_cell_size:10},display:{continuous:!1,orientation:"vertical",settingsImg:!1,transition_time:0,sizeToFit:!0,service:!0,player:!0,rally:!0,score:!1,momentum_score:!0,grid:!0},colors:{players:{0:"red",1:"black"},results:{Out:"red",Net:"coral","Unforced Error":"red",Forced:"orange",Ace:"lightgreen","Serve Winner":"lightgreen",Winner:"lightgreen","Forced Volley Error":"orange","Forced Error":"orange",In:"yellow","Passing Shot":"lightgreen","Out Passing Shot":"red","Net Cord":"yellow","Out Wide":"red","Out Long":"red","Double Fault":"red",Unknown:"blue",Error:"red"}}};s.height=t(),s.width=e();var l={default:"#235dba"},c=JSON.parse(JSON.stringify(l)),u={settings:{click:null},update:{begin:null,end:null},point:{mouseover:null,mouseout:null,click:null}};return r.exports=function(){return{function1:function1,function1:function1}},r.options=function(e){return arguments.length?(n(e,s),r):s},r.events=function(e){return arguments.length?(n(e,u),r):u},r.width=function(e){return arguments.length?(s.fullWidth=e,r):s.fullWidth},r.height=function(e){return arguments.length?(s.fullHeight=e,r):s.fullHeight},r.data=function(e){return arguments.length?(a=e,r):a},r.update=function(e){u.update.begin&&u.update.begin(),"function"==typeof i&&a&&i(e),setTimeout(function(){u.update.end&&u.update.end()},s.display.transition_time)},r.colors=function(e){if(!arguments.length)return c;if("object"!=typeof e)return!1;var t=Object.keys(e);return!!t.length&&(t.forEach(function(t){/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e[t])||delete e[t]}),c=Object.keys(e).length?e:JSON.parse(JSON.stringify(l)),r)},r}function gameFish(){function e(e){function t(e){var t=e.split("-").map(function(e){return e.replace("T","")}),r=t[0],n=t[1];return e.indexOf("T")>0?(r>=f.set.tiebreak_to&&n>=f.set.tiebreak_to&&(r-=f.set.tiebreak_to,n-=f.set.tiebreak_to),n-r):f.fish.gridcells.indexOf(r)>=0&&f.fish.gridcells.indexOf(n)>=0?f.fish.gridcells.indexOf(n)-f.fish.gridcells.indexOf(r):f.fish.tailcells.indexOf(r)>=0&&f.fish.tailcells.indexOf(n)>=0?f.fish.tailcells.indexOf(n)-f.fish.tailcells.indexOf(r):void 0}var r=e[0][0].tagName.toLowerCase();if("svg"!=r){l=e.append("div").attr("class","fishRoot");var h=l.append("svg").attr({id:"gameFish"+f.id,class:"fishFrame"});c=h.append("g"),u=h.append("g"),d=h.append("g")}s=function(r){function s(e,t){return f.display.player||f.display.service?te/4:te/2}function m(e,t){return te>20?1:.5}function v(e,t){return f.colors.results[e.result]}function g(e,t){return void 0==e.rally?"white":e.rally.length>1?"yellow":1==e.rally.length?f.colors.results[e.result]:"white"}function y(e,t){return e.rally?ue(e.rally.length):0}function x(e,t){var r=t?V+.5*te:V-.5*te,r=q?r:r+.3*te,n=te*(q?.8:.5);return T(r,n,0)}function b(e,t){var r=t?V:V-te,n=0;return T(r,n,0)}function w(e,t){var r=+V+e.o,n=te+e.l;return T(r,n,e.rotate)}function _(e,t){var r=V+(e[1]-e[0]+q-1)*te,n=(e[0]+e[1]+3-q)*te;return T(r,n,45)}function k(e,r){var n=V+(t(e.fish_score)+q-1)*te,a=(r+4-q)*te;return o=[n-V,a-ee,ee],T(n,a,45)}function S(e,t){var r=0==e.server?V-U/2*Y:V+U/2*Y-1.5*te,n=te+P(e,t);return T(r,n,0)}function O(e,t){var r=V,n=te+P(e,t);return T(r,n,0)}function A(e,t){var r=e.rally?V-ue(e.rally.length)/2:0,n=te+P(e,t);return T(r,n,0)}function T(e,t,r){var n=q?e:t,a=q?t:e;return"translate("+n+","+a+") rotate("+r+")"}function P(e,t){return(t+2.5)*te}function R(e,t){return q?C(e,t):E(e,t)}function M(e,t){return q?E(e,t):C(e,t)}function E(e,t){return te+(t+3)*te}function C(e,t){return 0==e.server?V+U/2*Y-.75*te:V-U/2*Y+.75*te}function j(e,t){return q?z(e,t):W(e,t)}function F(e,t){return q?W(e,t):z(e,t)}function W(e,t){return te+(e.point+3)*te}function z(e){var t="first"==e.serve&&0==e.server||"second"==e.serve&&1==e.server?.4:1.1;return 0==e.server?V-U/2*Y+t*te:V+U/2*Y-t*te}function N(e,t){return q?L(e,t):D(e,t)}function B(e,t){return q?D(e,t):L(e,t)}function D(e,t){return te+(t+3)*te}function L(e,r){return+V+t(e.fish_score)*te}if(void 0!=c&&void 0!=u&&void 0!=d){if(f.display.sizeToFit||r&&r.sizeToFit){var I=e.node().getBoundingClientRect();f.width=Math.max(I.width,100),f.height=Math.max(I.height,100)}var G=!1,H=0;n.forEach(function(e){e.rally&&e.rally.length>H&&(H=e.rally.length),e.score.indexOf("T")>0&&(G=!0)}),f.fish.max_rally&&f.fish.max_rally>H&&(H=f.fish.max_rally),a=f.width-(f.margins.left+f.margins.right),i=f.height-(f.margins.top+f.margins.bottom);var q="vertical"==f.display.orientation?1:0,U=q?a:i,J=q?i:a,V=(q?f.margins.left:f.margins.top)+U/2,Y=1,X=.9;
if(c.attr("transform","translate("+(q?0:p[0])+","+(q?p[1]:0)+")"),u.attr("transform","translate("+p[0]+","+p[1]+")"),d.attr("transform","translate("+p[0]+","+p[1]+")"),f.fish.cell_size)var K=f.fish.cell_size;else var Q=G?f.set.tiebreak_to+4:f.fish.gridcells.length+2,$=U/(f.fish.gridcells.length+(f.display.service?Q:0)),Z=J/(n.length+2),K=Math.min($,Z),K=Math.max(f.fish.min_cell_size,K),K=Math.min(f.fish.max_cell_size,K);var ee=Math.sqrt(2*Math.pow(K,2)),te=ee/2;grid_data=[],grid_labels=[];for(var re=G?f.set.tiebreak_to:f.fish.gridcells.length-1,ne=0;ne<re;ne++){var ae=G?ne:f.fish.gridcells[ne];grid_labels.push({label:ae,l:(ne+(q?1.25:.75))*te,o:(ne+(q?.75:1.25))*te,rotate:45}),grid_labels.push({label:ae,l:(ne+1.25)*te,o:-1*(ne+.75)*te,rotate:-45});for(var ie=0;ie<re;ie++)grid_data.push([ne,ie])}f.display.score?K:0;if(l&&(l.attr({width:f.width+"px",height:f.height+"px"}),h.attr({width:f.width+"px",height:f.height+"px"})),f.display.point_score){var oe=u.selectAll(".game_score"+f.id).data(grid_labels);oe.enter().append("text").attr({"font-size":.8*te+"px",transform:w,"text-anchor":"middle"}),oe.exit().remove(),oe.transition().duration(f.display.transition_time).attr({class:"game_score"+f.id,"font-size":.8*te+"px",transform:w,"text-anchor":"middle"}).text(function(e){return e.label})}else u.selectAll(".game_score"+f.id).remove();if(f.display.grid){var se=u.selectAll(".gridcell"+f.id).data(grid_data);se.enter().append("rect").attr({class:"gridcell"+f.id,stroke:"#ccccdd","stroke-width":m,width:K,height:K,transform:_,"fill-opacity":0}),se.exit().remove(),se.transition().duration(f.display.transition_time).attr({class:"gridcell"+f.id,"stroke-width":m,width:K,height:K,transform:_,"fill-opacity":0})}else u.selectAll(".gridcell"+f.id).remove();var le=d.selectAll(".gamecell"+f.id).data(n);le.enter().append("rect").attr({class:"gamecell"+f.id,transform:k,stroke:"#ccccdd","stroke-width":m,opacity:0}).style("fill",function(e){return f.colors.players[e.winner]}),le.exit().remove(),le.attr("id",function(e,t){return f.id+"Gs"+e.set+"g"+e.game+"p"+t}).transition().duration(f.display.transition_time).attr({class:"gamecell"+f.id,width:K,height:K,transform:k,stroke:"#ccccdd","stroke-width":m,opacity:f.display.player?1:0}).style("fill",function(e){return f.colors.players[e.winner]});var ce=d.selectAll(".result"+f.id).data(n);ce.enter().append("circle").attr({class:"result"+f.id,opacity:0,cx:N,cy:B,r:s}).style("fill",function(e){return f.colors.results[e.result]}),ce.exit().remove(),ce.attr("id",function(e,t){return f.id+"Rs"+e.set+"g"+e.game+"p"+t}).transition().duration(f.display.transition_time).attr({opacity:1,stroke:"black","stroke-width":m,cx:N,cy:B,r:s}).style("fill",function(e){return f.colors.results[e.result]});var ue=d3.scale.linear().range([0,U*X]).domain([0,H]),de=d3.scale.ordinal().domain(d3.range(n.length)).rangeRoundBands([0,n.length*te]);if(f.display.rally){var pe=c.selectAll(".rally_bar"+f.id).data(n);pe.enter().append("rect").attr({class:"rally_bar"+f.id,opacity:0,stroke:"white","stroke-width":m,fill:"#eeeeff",transform:O,height:q?de.rangeBand():0,width:q?0:de.rangeBand()}),pe.exit().remove(),pe.on("mouseover",function(e){d3.select(this).attr("fill","yellow")}).on("mouseout",function(e){d3.select(this).attr("fill","#eeeeff")}).transition().duration(f.display.transition_time).attr("id",function(e,t){return f.id+"Bs"+e.set+"g"+e.game+"p"+t}).attr({opacity:1,stroke:"white","stroke-width":m,fill:"#eeeeff",transform:A,height:q?de.rangeBand():y,width:q?y:de.rangeBand()})}else c.selectAll(".rally_bar"+f.id).remove();if(f.display.score){var fe=c.selectAll(".set_score"+f.id).data(f.score);fe.enter().append("text").attr("class","set_score"+f.id),fe.exit().remove(),fe.attr({transform:x,"font-size":.8*te+"px","text-anchor":"middle"}).text(function(e){return e});var he=c.selectAll(".ssb"+f.id).data(f.score);he.enter().append("rect").attr("class","ssb"+f.id),he.exit().remove(),he.attr({transform:b,stroke:"black","stroke-width":m,"fill-opacity":0,height:te+"px",width:te+"px"})}else c.selectAll(".set_score"+f.id).remove(),c.selectAll(".ssb"+f.id).remove();if(f.display.service){var me=[];n.forEach(function(e,t){var r=!1,n=["Ace","Serve Winner","Double Fault"];e.first_serve&&(r=!0,me.push({point:t,serve:"first",server:e.server,result:e.first_serve.error})),me.push({point:t,serve:r?"second":"first",server:e.server,result:n.indexOf(e.result)>=0?e.result:"In"})});var ve=c.selectAll(".serve"+f.id).data(me);ve.enter().append("circle"),ve.exit().remove(),ve.attr({class:"serve"+f.id,cx:j,cy:F,r:s,stroke:v,"stroke-width":m,fill:v});var ge=c.selectAll(".sbox"+f.id).data(n);ge.enter().append("rect").attr({transform:S,stroke:"#ccccdd","stroke-width":m,"fill-opacity":0,height:q?de.rangeBand():1.5*te,width:q?1.5*te:de.rangeBand()}),ge.exit().remove(),ge.attr({transform:S,class:"sbox"+f.id,"stroke-width":m,height:q?de.rangeBand():1.5*te,width:q?1.5*te:de.rangeBand()});var ye=c.selectAll(".return"+f.id).data(n);ye.enter().append("circle").attr({class:"return"+f.id,cx:R,cy:M,r:s,stroke:g,"stroke-width":m,fill:g}),ye.exit().remove(),ye.attr({class:"return"+f.id,cx:R,cy:M,r:s,stroke:g,"stroke-width":m,fill:g})}else c.selectAll(".sbox"+f.id).remove(),c.selectAll(".return"+f.id).remove(),c.selectAll(".serve"+f.id).remove()}}}function t(e,r){if(e&&r)for(var n=Object.keys(e),a=Object.keys(r),i=0;i<n.length;i++)if(a.indexOf(n[i])>=0){var o=r[n[i]],s=e[n[i]];"object"==typeof o&&"function"!=typeof s&&o&&o.constructor!==Array?t(e[n[i]],r[n[i]]):r[n[i]]=e[n[i]]}}function r(e){var t=!1;e.forEach(function(e){var r=e.score.split("-");"40"!=r[0]||"40"!=r[1]||t?t?("40"==r[0]&&(r[0]="D"),"40"==r[1]&&(r[1]="D"),e.fish_score=r.join("-")):e.fish_score=e.score:(t=!0,e.fish_score=e.score)})}var n,a,i,o,s,l,c,u,d,p=[0,0],f={id:"gf1",score:[0,0],width:window.innerWidth,height:window.innerHeight,margins:{top:10,bottom:10,left:10,right:10},fish:{gridcells:["0","15","30","40","G"],tailcells:["D","A","G"],max_rally:void 0,cell_size:void 0,min_cell_size:5,max_cell_size:20},set:{tiebreak_to:7},display:{orientation:"vertical",transition_time:1e3,sizeToFit:!1,point_score:!0,service:!0,player:!0,rally:!0,score:!0,grid:!0},colors:{players:{0:"red",1:"black"},results:{Out:"red",Net:"coral","Unforced Error":"red",Forced:"orange",Ace:"lightgreen","Serve Winner":"lightgreen",Winner:"lightgreen","Forced Volley Error":"orange","Forced Error":"orange",In:"yellow","Passing Shot":"lightgreen","Out Passing Shot":"red","Net Cord":"yellow","Out Wide":"red","Out Long":"red","Double Fault":"red",Unknown:"blue",Error:"red"}}},h={default:"#235dba"},m=JSON.parse(JSON.stringify(h)),v={update:{begin:null,end:null},point:{mouseover:null,mouseout:null,click:null}};return e.g=function(t){return arguments.length?void("object"==typeof t&&t.constructor!=Array&&(t.bars&&(c=t.bars),t.fish&&(u=t.fish),t.game&&(d=t.game))):e},e.exports=function(){return{function1:function1,function1:function1}},e.options=function(r){return arguments.length?(t(r,f),e):f},e.events=function(r){return arguments.length?(t(r,v),e):v},e.width=function(t){return arguments.length?(f.width=t,e):f.width},e.height=function(t){return arguments.length?(f.height=t,e):f.height},e.coords=function(t){return arguments.length?(p=t,e):o},e.data=function(t){return arguments.length?(n=JSON.parse(JSON.stringify(t)),r(n),e):n},e.update=function(e){v.update.begin&&v.update.begin(),"function"==typeof s&&n&&s(e),setTimeout(function(){v.update.end&&v.update.end()},f.display.transition_time)},e.colors=function(t){if(!arguments.length)return m;if("object"!=typeof t)return!1;var r=Object.keys(t);return!!r.length&&(r.forEach(function(e){/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t[e])||delete t[e]}),m=Object.keys(t).length?t:JSON.parse(JSON.stringify(h)),e)},e}function GameTree(){function e(e){return Math.max.apply(null,e)}function t(e){return Math.min.apply(null,e)}function r(r){var n=r.append("div").attr("class","gametreeRoot");g.width-(g.margins.left+g.margins.right),.9*g.width;h=n.append("svg"),f=function(n){if(!v.length&&!g.display.showEmpty)return void h.selectAll("*").remove();if(a(),g.display.sizeToFit||n&&n.sizeToFit){var o=r.node().getBoundingClientRect();g.width=Math.max(o.width,100),g.height=Math.max(o.height,100)}var s=g.width-(g.margins.left+g.margins.right),c=.9*g.width;m=(c+s)/2*.03;var u=R.map(function(e){return e.id}),f=t(u.map(function(e){return isNaN(b.p[e])?0:b.p[e]})),x=e([e(u.map(function(e){return isNaN(b.p[e])?0:b.p[e]})),g.min_max]),_=d3.scale.linear().domain([f,x]).range([0,2*m]);h.transition().duration(y).attr("width",s).attr("height",c);var k=h.selectAll(".gradient").data(R,i);k.enter().append("linearGradient").attr("id",function(e){return"gradient"+e.id}).attr("class","gradient").attr("gradientUnits","userSpaceOnUse").attr("x1",function(e){return e.start.x*s}).attr("y1",function(e){return e.start.y*c}).attr("x2",function(e){return e.end.x*s}).attr("y2",function(e){return e.end.y*c}),k.exit().remove(),k.attr("x1",function(e){return e.start.x*s}).attr("y1",function(e){return e.start.y*c}).attr("x2",function(e){return e.end.x*s}).attr("y2",function(e){return e.end.y*c});var S=k.selectAll(".points_stop").data(function(e,t){return l(e,t)});S.enter().append("stop").attr("class","points_stop").attr("offset",function(e){return e.offset}).attr("stop-color",function(e){return e.color}),S.exit().remove(),S.attr("offset",function(e){return e.offset});var O=h.selectAll(".line").data(R);O.enter().append("line").attr("class","line").attr("id",function(e){return e.id}).attr("x1",function(e){return e.start.x*s}).attr("y1",function(e){return e.start.y*c}).attr("x2",function(e){return e.end.x*s}).attr("y2",function(e){return e.end.y*c}).attr("stroke-width",function(e){return e.width?e.width:0}).attr("stroke",function(e){return"url(#gradient"+e.id+")"}).on("mousemove",function(e,t){w.point.mousemove&&w.point.mousemove(e,t)}).on("mouseout",function(e,t){w.point.mouseout&&w.point.mouseout(e,t)}).on("click",function(e,t){w.point.click&&w.point.click(e,t)}),O.exit().remove(),O.transition().duration(g.lines.easing||n&&n.easing?g.lines.duration:0).ease(g.lines.easing||n&&n.easing||"none").attr("x1",function(e){return e.start.x*s}).attr("y1",function(e){return e.start.y*c}).attr("x2",function(e){return e.end.x*s}).attr("y2",function(e){return e.end.y*c}).attr("stroke-width",function(e){return b.p[e.id]?_(b.p[e.id]):0});var A=h.selectAll(".uline").data(M);A.enter().append("line").attr("class","uline").attr("id",function(e){return e.id}).attr("x1",function(e){return e.start.x*s}).attr("y1",function(e){return e.start.y*c}).attr("x2",function(e){return e.end.x*s}).attr("y2",function(e){return e.end.y*c}).attr("stroke-width",function(e){return e.width?e.width:0}).attr("stroke",function(e){return g.lines.colors.underlines}),A.exit().remove(),A.transition().duration(y).attr("id",function(e){return e.id}).attr("x1",function(e){return e.start.x*s}).attr("y1",function(e){return e.start.y*c}).attr("x2",function(e){return e.end.x*s}).attr("y2",function(e){return e.end.y*c}).attr("stroke-width",function(e){return e.width?e.width:0});var T=h.selectAll(".node").data(P);T.enter().append("circle").attr("class","node").attr("cx",function(e){return e.pos.x*s}).attr("cy",function(e){return e.pos.y*c}).attr("r",function(e){return m}).attr("stroke",function(e){return void 0!=e.color_pct?d(p(g.nodes.colors[e.player]),e.color_pct):g.nodes.colors.neutral}).attr("fill",function(e){return void 0!=e.color_pct?d(p(g.nodes.colors[e.player]),e.color_pct):g.nodes.colors.neutral}).on("mousemove",function(e,t){w.score.mousemove&&w.score.mousemove(e,t)}).on("mouseout",function(e,t){w.node.mouseout&&w.node.mouseout(e,t)}).on("click",function(e,t){w.node.click&&w.node.click(e,t)}),T.exit().remove(),T.transition().duration(y).attr("cx",function(e){return e.pos.x*s}).attr("cy",function(e){return e.pos.y*c}).attr("r",function(e){return m});var F=h.selectAll(".score").data(E);F.enter().append("text").attr("class","score").attr("x",function(e){return e.pos.x*s}).attr("y",function(e){return e.pos.y*c}).attr("font-size",function(e){return m*e.fontsize+"px"}).attr("font-family","Lato, Arial, sans-serif").attr("text-anchor","middle").attr("alignment-baseline","central").attr("stroke",function(e){return e.stroke}).attr("fill",function(e){return e.fill}).text(function(e){if(m*e.fontsize>7)return e.text}).on("mousemove",function(e,t){w.score.mousemove&&w.score.mousemove(e,t)}).on("mouseout",function(e,t){w.score.mouseout&&w.score.mouseout(e,t)}).on("click",function(e,t){w.score.click&&w.score.click(e,t)}),F.exit().remove(),F.transition().duration(y).attr("x",function(e){return e.pos.x*s}).attr("y",function(e){return e.pos.y*c}).attr("font-size",function(e){return m*e.fontsize+"px"}).text(function(e){if(m*e.fontsize>5)return e.text});var W=h.selectAll(".gt_label").data(C);W.enter().append("text").attr("class","gt_label").attr("x",function(e){return e.pos.x*s}).attr("y",function(e){return e.pos.y*c}).attr("alignment-baseline",function(e){return e.baseline?e.baseline:void 0}).attr("font-size",function(e){return m*e.fontsize+"px"}).attr("text-anchor",function(e){return e.anchor?e.anchor:void 0}).attr("font-family","Lato, Arial, sans-serif").attr("stroke",function(e){return e.stroke}).attr("fill",function(e){return e.fill}).text(function(e){if(m*e.fontsize>5)return e.id}).attr("selector",function(e){return e.id}).on("click",function(e,t){w.label.click&&w.label.click(e,t,this)}),W.exit().remove(),W.transition().duration(y).attr("x",function(e){return e.pos.x*s}).attr("y",function(e){return e.pos.y*c}).attr("font-size",function(e){return m*e.fontsize+"px"}).text(function(e){if(m*e.fontsize>5)return g.labels[e.id]});var z=h.selectAll(".selector").data(j);z.enter().append("circle").attr("class","selector").attr("status",function(e){return e.status}).attr("id",function(e){return e.id}).attr("selector",function(e){return e.id}).attr("cx",function(e){return e.pos.x*s}).attr("cy",function(e){return e.pos.y*c+4}).attr("r",function(e){return m*e.r_pct}).attr("stroke",function(e,t){return g.nodes.colors[t]}).attr("stroke-width",function(e){return.25*m}).attr("fill",function(e,t){return!g.selectors.enabled||g.selectors.enabled&&g.selectors.selected[t]?g.nodes.colors[t]:g.nodes.colors.neutral}).attr("opacity",function(e){return e.opacity}).on("mousemove",function(e,t){w.selector.mousemove&&w.selector.mousemove(e,t)}).on("mouseout",function(e,t){w.selector.mouseout&&w.selector.mouseout(e,t)}).on("click",function(e,t){w.selector.click&&w.selector.click(e,t,this)}),z.exit(),z.transition().duration(y).attr("cx",function(e){return e.pos.x*s}).attr("cy",function(e){return e.pos.y*c+4}).attr("r",function(e){return m*e.r_pct}).attr("stroke-width",function(e){return.25*m}).attr("fill",function(e,t){return!g.selectors.enabled||g.selectors.enabled&&g.selectors.selected[t]?g.nodes.colors[t]:g.nodes.colors.neutral})}}function n(e,t){if(e&&t)for(var r=Object.keys(e),a=Object.keys(t),i=0;i<r.length;i++)if(a.indexOf(r[i])>=0){var o=t[r[i]],s=e[r[i]];"object"==typeof o&&"function"!=typeof s&&o&&o.constructor!==Array?n(e[r[i]],t[r[i]]):t[r[i]]=e[r[i]]}}function a(){if(b={w:{},e:{},p:{},o:{},n:{}},g.selectors.selected[0]||g.selectors.selected[1])var e=g.selectors.selected[0]?0:1,t=v.filter(function(t){return t.server==e});else var t=v;for(var r=0;r<t.length;r++){var n=0==r?"0-0":t[r-1].score;n.indexOf("G")>=0&&(n="0-0");var a="L"+n+x+t[r].score;g.points.highlight.length&&g.points.highlight.indexOf(r)<0||(b.n[n]=b.n[n]?b.n[n]+1:1,b.o[n]=t[r].outcome?b.o[n]?b.o[n]+1:1:b.o[n],b.p[a]=b.p[a]?b.p[a]+1:1,g.points.winners.indexOf(t[r].result)>=0?b.w[a]=b.w[a]?b.w[a]+1:1:g.points.errors.indexOf(t[r].result)>=0&&(b.e[a]=b.e[a]?b.e[a]+1:1))}}function i(e){return e&&e.id}function o(){d3.select("[id=Player]").attr("opacity",.4).attr("status","none").attr("fill",g.nodes.colors.neutral),d3.select("[id=Opponent]").attr("opacity",.4).attr("status","none").attr("fill",g.nodes.colors.neutral),g.selectors.selected[1]=!1,g.selectors.selected[0]=!1}function s(e,t,r){if(g.selectors.enabled){var n=d3.select(r).attr("selector");"none"==d3.select("[id="+n+"]").attr("status")?"Opponent"==d3.select(r).attr("selector")?(d3.select("[id=Player]").attr("opacity",.4).attr("status","none").attr("fill",g.nodes.colors.neutral),d3.select("[id=Opponent]").attr("opacity",1).attr("status","selected").attr("fill",g.nodes.colors[t]),g.selectors.selected[1]=!0,g.selectors.selected[0]=!1):(d3.select("[id=Opponent]").attr("opacity",.4).attr("status","none").attr("fill",g.nodes.colors.neutral),d3.select("[id=Player]").attr("opacity",1).attr("status","selected").attr("fill",g.nodes.colors[t]),g.selectors.selected[0]=!0,g.selectors.selected[1]=!1):(d3.select("[id="+n+"]").attr("opacity",.4).attr("status","none").attr("fill",g.nodes.colors.neutral),"Opponent"==d3.select(r).attr("selector")?g.selectors.selected[1]=!1:g.selectors.selected[0]=!1),f()}}function l(e,t){if(!b.p[e.id])return[];var r=void 0==b.p[e.id]?1:b.p[e.id],n=b.w[e.id]?b.w[e.id]:0,a=b.e[e.id]?b.e[e.id]:0,i=n/r*100,o=(r-(n+a))/r*100;return[{offset:"0%",color:g.lines.points.unknown},{offset:o+"%",color:g.lines.points.unknown},{offset:o+"%",color:g.lines.points.winners},{offset:o+i+"%",color:g.lines.points.winners},{offset:o+i+"%",color:g.lines.points.errors},{offset:"100%",color:g.lines.points.errors}]}function c(e,t){var r=parseInt(e.slice(1),16),n=t<0?0:255,a=t<0?t*-1:t,i=r>>16,o=r>>8&255,s=255&r;return"#"+(16777216+65536*(Math.round((n-i)*a)+i)+256*(Math.round((n-o)*a)+o)+(Math.round((n-s)*a)+s)).toString(16).slice(1)}function u(e,t){var r=e.split(","),n=t<0?0:255,a=t<0?t*-1:t,i=parseInt(r[0].slice(4)),o=parseInt(r[1]),s=parseInt(r[2]);return"rgb("+(Math.round((n-i)*a)+i)+","+(Math.round((n-o)*a)+o)+","+(Math.round((n-s)*a)+s)+")"}function d(e,t){return e.length>7?u(e,t):c(e,t)}function p(e){var t=document.createElement("div");t.style.color=e;var r=window.getComputedStyle(document.body.appendChild(t)).color.match(/\d+/g).map(function(e){return parseInt(e,10)});return document.body.removeChild(t),r.length>=3&&"#"+((1<<24)+(r[0]<<16)+(r[1]<<8)+r[2]).toString(16).substr(1)}var f,h,m,v=[],g={width:150,height:150,min_max:20,margins:{top:0,right:0,bottom:0,left:0},display:{sizeToFit:!0,showEmpty:!1},lines:{easing:!1,duration:600,points:{winners:"#2ed2db",errors:"#2ed2db",unknown:"#2ed2db"},colors:{underlines:"#2ed2db"}},nodes:{colors:{0:"black",1:"red",neutral:"#ecf0f1"}},points:{winners:["Winner","Ace","Serve Winner","Passing Shot","Return Winner","Forcing Error","Forcing Volley Error","Net Cord","In"],errors:["Unforced Error","Unforced","Forced Error","Error","Out","Net","Netted Passing Shot","L","Overhead Passing Shot","Double Fault"],highlight:[]},selectors:{enabled:!0,selected:{0:!1,1:!1}},labels:{Game:"GAME",Player:"Player",Opponent:"Opponent"}},y=0,x="x",b={w:{},e:{},p:{},o:{},n:{}},w={update:{begin:null,end:null},point:{mousemove:null,mouseout:null},node:{mousemove:null,mouseout:null},score:{mousemove:null,mouseout:null},label:{mousemove:null,mouseout:null,click:s},selector:{mousemove:null,mouseout:null,click:s}};r.exports=function(){return{selectView:s}},r.options=function(e){return arguments.length?(n(e,g),r):g},r.events=function(e){return arguments.length?(n(e,w),r):w},r.reset=function(e){return v=[],o(),b={w:{},e:{},p:{},o:{},n:{}},r},r.width=function(e){return arguments.length?(g.width=e,r):g.width},r.height=function(e){return arguments.length?(g.height=e,r):g.height},r.data=function(e){return arguments.length?(e.constructor===Array&&(r.reset(),v=e),r):v},r.counters=function(){return a(),b},r.update=function(e){w.update.begin&&w.update.begin(),"function"==typeof f&&f(e),setTimeout(function(){w.update.end&&w.update.end()},y)};var _=.07,k=.125,S=.05,O=.2,A={col1:_,col2:_+k,col3:_+2*k,col4:_+3*k,col5:_+4*k,col6:_+5*k,col7:_+6*k,row1:S,row2:S+O,row3:S+2*O,row4:S+3*O,row5:S+4*O,foot:S+4.1*O,adr1:S+3.5*O,adc1:_+2.5*k,adc2:_+3.5*k,selc:.8*_,tslc:_,sl1r:S/2,sl2r:1.5*S,plr1:.8*_,plr2:_+4*k,plrs:S+4.25*O},T={"p0-0":{x:A.col4,y:A.row1},"p15-15":{x:A.col4,y:A.row2},"p30-30":{x:A.col4,y:A.row3},"p40-40":{x:A.col4,y:A.row4},"p15-0":{x:A.col3,y:A.row2},"p0-15":{x:A.col5,y:A.row2},"p30-15":{x:A.col3,y:A.row3},"p15-30":{x:A.col5,y:A.row3},"p30-0":{x:A.col2,y:A.row3},"p0-30":{x:A.col6,y:A.row3},"p40-30":{x:A.col3,y:A.row4},"p30-40":{x:A.col5,y:A.row4},"p40-15":{x:A.col2,y:A.row4},"p15-40":{x:A.col6,y:A.row4},"p40-0":{x:A.col1,y:A.row4},"p0-40":{x:A.col7,y:A.row4},"p40-Ad":{x:A.adc1,y:A.adr1},"pAd-40":{x:A.adc2,y:A.adr1},"pG-D":{x:A.adc2,y:A.row5},"pD-G":{x:A.adc1,y:A.row5},"pG-15":{x:A.col2,y:A.row5},"p15-G":{x:A.col6,y:A.row5},"pG-30":{x:A.col3,y:A.row5},"p30-G":{x:A.col5,y:A.row5},"pG-40":{x:A.col4,y:A.row5},"p40-G":{x:A.col4,y:A.row5},"pG-0":{x:A.col1,y:A.row5},"p0-G":{x:A.col7,y:A.row5},sPlyr:{x:A.adc1,y:A.plrs},tPlyr:{x:A.col2,y:A.plrs},sOpp:{x:A.adc2,y:A.plrs},tOpp:{x:A.col6,y:A.plrs},GAME:{x:A.col4,y:A.foot},L1s:{x:A.col1,y:A.foot},L1e:{x:A.adc1,y:A.foot},L2s:{x:A.adc2,y:A.foot},L2e:{x:A.col7,y:A.foot}},P=[{name:"0-0",pos:T["p0-0"],player:0},{name:"15-15",pos:T["p15-15"],player:0},{name:"30-30",pos:T["p30-30"],player:0},{name:"40-40",pos:T["p40-40"],player:0},{name:"0-15",pos:T["p0-15"],color_pct:.4,player:1},{name:"15-30",pos:T["p15-30"],color_pct:.4,player:1},{name:"0-30",pos:T["p0-30"],color_pct:.2,player:1},{name:"30-40",pos:T["p30-40"],color_pct:.4,player:1},{name:"15-40",pos:T["p15-40"],color_pct:.2,player:1},{name:"0-40",pos:T["p0-40"],color_pct:0,player:1},{name:"40-A",pos:T["pAd-40"],color_pct:.5,player:1},{name:"15-0",pos:T["p15-0"],color_pct:.4,player:0},{name:"30-15",pos:T["p30-15"],color_pct:.4,player:0},{name:"30-0",pos:T["p30-0"],color_pct:.2,player:0},{name:"40-30",pos:T["p40-30"],color_pct:.4,player:0},{name:"40-15",pos:T["p40-15"],color_pct:.2,player:0},{name:"40-0",pos:T["p40-0"],color_pct:0,player:0},{name:"A-40",pos:T["p40-Ad"],color_pct:.5,player:0}],R=[{id:"L0-0x0-15",start:T["p0-0"],end:T["p0-15"]},{id:"L0-0x15-0",start:T["p0-0"],end:T["p15-0"]},{id:"L0-15x0-30",start:T["p0-15"],end:T["p0-30"]},{id:"L0-15x15-15",start:T["p0-15"],end:T["p15-15"]},{id:"L15-0x30-0",start:T["p15-0"],end:T["p30-0"]},{id:"L15-0x15-15",start:T["p15-0"],end:T["p15-15"]},{id:"L15-15x15-30",start:T["p15-15"],end:T["p15-30"]},{id:"L15-15x30-15",start:T["p15-15"],end:T["p30-15"]},{id:"L30-0x30-15",start:T["p30-0"],end:T["p30-15"]},{id:"L30-0x40-0",start:T["p30-0"],end:T["p40-0"]},{id:"L30-15x30-30",start:T["p30-15"],end:T["p30-30"]},{id:"L30-15x40-15",start:T["p30-15"],end:T["p40-15"]},{id:"L30-30x30-40",start:T["p30-30"],end:T["p30-40"]},{id:"L30-30x40-30",start:T["p30-30"],end:T["p40-30"]},{id:"L0-30x0-40",start:T["p0-30"],end:T["p0-40"]},{id:"L0-30x15-30",start:T["p0-30"],end:T["p15-30"]},{id:"L0-40x0-G",start:T["p0-40"],end:T["p0-G"]},{id:"L0-40x15-40",start:T["p0-40"],end:T["p15-40"]},{id:"L15-30x30-30",start:T["p15-30"],end:T["p30-30"]},{id:"L15-30x15-40",start:T["p15-30"],end:T["p15-40"]},{id:"L15-40x30-40",start:T["p15-40"],end:T["p30-40"]},{id:"L15-40x15-G",start:T["p15-40"],end:T["p15-G"]},{id:"L30-40x40-40",start:T["p30-40"],end:T["p40-40"]},{id:"L30-40x30-G",start:T["p30-40"],end:T["p30-G"]},{id:"L40-40x40-A",start:T["p40-40"],end:T["pAd-40"]},{id:"L40-40xA-40",start:T["p40-40"],end:T["p40-Ad"]},{id:"L40-40xG-40",start:T["p40-40"],end:T["pG-40"]},{id:"L40-40x40-G",start:T["p40-40"],end:T["p40-G"]},{id:"L40-30x40-40",start:T["p40-30"],end:T["p40-40"]},{id:"L40-30xG-30",start:T["p40-30"],end:T["pG-30"]},{id:"L40-15x40-30",start:T["p40-15"],end:T["p40-30"]},{id:"L40-15xG-15",start:T["p40-15"],end:T["pG-15"]},{id:"L40-0x40-15",start:T["p40-0"],end:T["p40-15"]},{id:"L40-0xG-0",start:T["p40-0"],end:T["pG-0"]},{id:"L40-Ax40-G",start:T["pAd-40"],end:T["pG-D"]},{id:"LA-40xG-40",start:T["p40-Ad"],end:T["pD-G"]}],M=[{stroke:"blue",start:T.L1s,end:T.L1e,width:2},{stroke:"blue",start:T.L2s,end:T.L2e,width:2}],E=[{pos:T["p0-0"],fill:"black",fontsize:.7,text:"0-0"},{pos:T["p15-15"],fill:"black",fontsize:.7,text:"15-15"},{pos:T["p30-30"],fill:"black",fontsize:.7,text:"30-30"},{pos:T["p40-40"],fill:"black",fontsize:.7,text:"40-40"},{pos:T["p0-15"],fill:"white",fontsize:.7,text:"0-15"},{pos:T["p15-30"],fill:"white",fontsize:.7,text:"15-30"},{pos:T["p0-30"],fill:"white",fontsize:.7,text:"0-30"},{pos:T["p30-40"],fill:"white",fontsize:.7,text:"30-40"},{pos:T["p15-40"],fill:"white",fontsize:.7,text:"15-40"},{pos:T["p0-40"],fill:"white",fontsize:.7,text:"0-40"},{pos:T["pAd-40"],fill:"white",fontsize:.7,text:"40-A"},{pos:T["p15-0"],fill:"white",fontsize:.7,text:"15-0"},{pos:T["p30-15"],fill:"white",fontsize:.7,text:"30-15"},{pos:T["p30-0"],fill:"white",fontsize:.7,text:"30-0"},{pos:T["p40-30"],fill:"white",fontsize:.7,text:"40-30"},{pos:T["p40-15"],fill:"white",fontsize:.7,text:"40-15"},{pos:T["p40-0"],fill:"white",fontsize:.7,text:"40-0"},{pos:T["p40-Ad"],fill:"white",fontsize:.7,text:"A-40"}],C=[{pos:T.tPlyr,fill:"black",fontsize:.9,id:"Player",anchor:"middle",baseline:"hanging"},{pos:T.tOpp,fill:"black",fontsize:.9,id:"Opponent",anchor:"middle",baseline:"hanging"},{pos:T.GAME,fill:"#555555",fontsize:.9,id:"Game",anchor:"middle",baseline:"central"}],j=[{id:"Player",pos:T.sPlyr,r_pct:.4,opacity:1,status:"none"},{id:"Opponent",pos:T.sOpp,r_pct:.4,opacity:.4,status:"none"}];return r}function rallyTree(){function e(e){var u=e.append("div").attr("class","rallyRoot"),p=u.append("svg").attr("class","rallyTree").attr("height","horizontal"==g.orientation?g.height:g.width).attr("width","horizontal"==g.orientation?g.width:g.height),f=p.append("g").attr("class","rttree"),y=p.append("g").attr("class","rtarea");h=function(u){function h(e){return d3.select("#player"+e+"pctarea").datum(rallyWinPct(e)).on("mouseover",function(t,r){k.pctarea.mouseover&&k.pctarea.mouseover(e,r),b&&d3.select(this).attr("opacity",1)}).on("mouseout",function(t,r){k.pctarea.mouseout&&k.pctarea.mouseout(e,r),b&&d3.select(this).attr("opacity",.2)}).transition().duration(x).attr("opacity",function(){return b?.1:0}).attr("d",n(e,widthScale,max0,max1)),e}if(m=d3.max(v,function(e){if(e.rally)return e.rallyLength()}),m<3)return p.selectAll("rect").remove(),y.selectAll("path").remove(),y.selectAll("line").remove(),void("function"==k.rallies.none&&k.rallies.none());if("function"==k.rallies.display&&k.rallies.display(),g.display.sizeToFit||u&&u.sizeToFit){var w=e.node().getBoundingClientRect();g.width=Math.max(w.width,100),g.height=Math.max(w.height,100)}if(v.length>500)var _=0,S=0;else var _=1,S=1;ryl=[[],[]],v.forEach(function(e,t){e.i=t,ryl[e.winner][e.rallyLength()]?ryl[e.winner][e.rallyLength()]+=1:ryl[e.winner][e.rallyLength()]=1,e.rl=[ryl[0][e.rallyLength()],ryl[1][e.rallyLength()]]}),g.data.sort&&d("result"),p.transition().duration(x).attr("width",g.width).attr("height",g.height),max0=v.length?1==v.length?v[0].rl[0]:d3.max(v,function(e){return e.rl[0]}):0,max1=v.length?1==v.length?v[0].rl[1]:d3.max(v,function(e){return e.rl[1]}):0,max0=max0?max0:0,max1=max1?max1:0,maxLimb=max0+max1+1,widthScale=("horizontal"==g.orientation?g.width:g.height)/maxLimb,barSpacing=("horizontal"==g.orientation?g.height:g.width)/(m+1),barHeight=barSpacing-_;var O=f.selectAll("rect.point-bar").data(v);O.enter().append("rect").attr("id",function(e,t){return"cell"+t}).attr("class","point-bar").attr("x",function(e){return Math.random()*g.width}).attr("y",function(e){return Math.random()*g.height}).attr("fill",function(e){return g.points.colors[e.result]}).attr("width",function(e,t){return"horizontal"==g.orientation?widthScale-S:barHeight}).attr("height",function(e,t){return"horizontal"==g.orientation?barHeight:widthScale-S}).on("mouseover",k.pointbar.mouseover).on("mouseout",k.pointbar.mouseout).on("click",k.pointbar.click).transition().duration(x).style("opacity",1).attr("x",function(e,t){return a(e,widthScale,barSpacing,max0,max1)}).attr("y",function(e,t){return i(e,widthScale,barSpacing,max0,max1)}),O.exit().transition().duration(.5*x).delay(function(e,t){return 20*(v.length-t)}).style("opacity",0).attr("x",function(e){return Math.random()*g.width}).attr("y",function(e){return Math.random()*g.height}).remove(),O.transition().duration(x).attr("fill",function(e){return g.points.colors[e.result]}).style("opacity",function(e){return e.hide?0:1}).attr("x",function(e,t){return a(e,widthScale,barSpacing,max0,max1)}).attr("y",function(e,t){return i(e,widthScale,barSpacing,max0,max1)}).attr("width",function(e,t){return"horizontal"==g.orientation?widthScale-S:barHeight}).attr("height",function(e,t){return"horizontal"==g.orientation?barHeight:widthScale-S});var A=y.selectAll(".pct-area").data([0,1]);A.enter().append("path").attr("id",function(e){return"player"+e+"pctarea"}).attr("class","pct-area").attr("opacity",0),A.exit().remove(),A.attr("fill",function(e){return g.areas.colors[e]}).attr("display",function(){if(b)return"inline"}).transition().delay(x).attr("display",function(){if(!b)return"none"}).attr("gen",function(e){return h(e)});var T=y.selectAll(".pct-fifty").data([0,1]);T.enter().append("line").attr("id",function(e){return"player"+e+"fifty"}).attr("class","pct-fifty").attr("stroke","black").attr("opacity",0).attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",0),T.exit().remove(),T.attr("display",function(){if(b)return"inline"}).transition().duration(x).attr("opacity",function(){return b?1:0}).attr("y1",function(e){return r(e,1)}).attr("y2",function(e){return r(e,2)}).attr("x1",function(e){return t(e,1)}).attr("x2",function(e){return t(e,2)}).transition().delay(x).attr("display",function(){if(!b)return"none"});var P=y.selectAll("rect.stat-bar").data([0]);P.enter().append("rect").attr("class","stat-bar").style("opacity",.2).attr("y",function(e,t){return s(widthScale,barSpacing,max0,max1)}).attr("width",function(e,t){return l(widthScale,barSpacing,max0,max1)}).attr("height",function(e,t){return c(widthScale,barSpacing,max0,max1)}).attr("x",function(e,t){return o(widthScale,barSpacing,max0,max1)}).attr("fill","blue"),P.exit().transition().duration(.3*x).delay(function(e,t){return 20*(v.length-t)}).style("opacity",0).remove(),P.on("click",k.statbar.click).transition().duration(x).style("opacity",.2).attr("y",function(e,t){return s(widthScale,barSpacing,max0,max1)}).attr("width",function(e,t){return l(widthScale,barSpacing,max0,max1)}).attr("height",function(e,t){return c(widthScale,barSpacing,max0,max1)}).attr("x",function(e,t){return o(widthScale,barSpacing,max0,max1)}).attr("fill","blue")}}function t(e,t){return"horizontal"==g.orientation?0==e?max0?max0*widthScale/2:0:max1?g.width-max1*widthScale/2:0:1==t?0:g.width}function r(e,t){return"horizontal"==g.orientation?1==t?0:g.height:0==e?max0?max0*widthScale/2:0:max1?g.height-max1*widthScale/2:0}function n(e,t,r,n){if("horizontal"==g.orientation)var a=d3.scale.linear().range(0==e?[r*t,0]:[(r+1)*t,g.width]).domain([0,100]),i=d3.scale.linear().range([0,g.height]).domain([0,rallyWinPct(e).length-1]),o=d3.svg.area().interpolate(g.areas.interpolation).x1(function(e,t){return a(e)}).x0(0==e?r*t:(r+1)*t).y(function(e,t){return i(t)});else var i=d3.scale.linear().range(0==e?[r*t,0]:[r*t,g.height]).domain([0,100]),a=d3.scale.linear().range([0,g.width]).domain([0,rallyWinPct(e).length-1]),o=d3.svg.area().interpolate(g.areas.interpolation).y1(function(e,t){return i(e)}).y0(0==e?r*t:r*t).x(function(e,t){return a(t)});return o}function a(e,t,r,n,a){return 0==e.winner?"horizontal"==g.orientation?n*t-e.rl[0]*t:e.rallyLength()*r:"horizontal"==g.orientation?n*t+e.rl[1]*t:e.rallyLength()*r}function i(e,t,r,n,a){return 0==e.winner?"horizontal"==g.orientation?e.rallyLength()*r:n*t-e.rl[0]*t:"horizontal"==g.orientation?e.rallyLength()*r:n*t+e.rl[1]*t}function o(e,t,r,n){return"horizontal"==g.orientation?isNaN(e)?void 0:r*e:0}function s(e,t,r,n){return"horizontal"==g.orientation?0:isNaN(e)?void 0:r*e}function l(e,t,r,n){return"horizontal"==g.orientation?isNaN(e)?void 0:e-_:g.width}function c(e,t,r,n){return"horizontal"==g.orientation?g.height:isNaN(e)?void 0:e-_}function u(e,t){if(e&&t)for(var r=Object.keys(e),n=Object.keys(t),a=0;a<r.length;a++)if(n.indexOf(r[a])>=0){
var i=t[r[a]],o=e[r[a]];"object"==typeof i&&"function"!=typeof o&&i&&i.constructor!==Array?u(e[r[a]],t[r[a]]):t[r[a]]=e[r[a]]}}function d(e){e=e?e:"result",p(0,e),p(1,e)}function p(t,r){var n=Object.keys(e.options().points.colors);n.push("Z");var a=d3.max(v,function(e){return e.rallyLength()});for(y=0;y<=a;y++){for(var i=[],o=0;o<v.length;o++)v[o].rallyLength()==y&&v[o].winner==t&&i.push(v[o]);i.sort(function(e,t){return n.indexOf(e.hide?"Z":e[r])<n.indexOf(t.hide?"Z":t[r])?-1:n.indexOf(e.hide?"Z":e[r])>n.indexOf(t.hide?"Z":t[r])?1:0}),i.forEach(function(e,r){e.rl[t]=r+1});for(var s=0;s<i.length;s++)v[i[s].i]=i[s]}}function f(e){return e[e.length-1]}var h,m,v=[],g={width:100,height:100,margins:{top:0,right:0,bottom:0,left:0},display:{sizeToFit:!1},orientation:"horizontal",data:{sort:!1},areas:{colors:{0:"blue",1:"purple"},interpolation:"linear"},points:{colors:{}}},x=1e3,b=!0,w=void 0,_=0,k={pointbar:{mouseover:null,mouseout:null,click:null},statbar:{click:null},pctarea:{mouseover:null,mouseout:null},update:{begin:null,end:null},rallies:{none:void 0,display:void 0}};return e.options=function(t){if(!arguments.length)return g;for(var r=Object.keys(t),n=Object.keys(g),a=0;a<r.length;a++)if(n.indexOf(r[a])>=0)if("object"==typeof g[r[a]])for(var i=Object.keys(t[r[a]]),o=Object.keys(g[r[a]]),s=0;s<i.length;s++)o.indexOf(i[s])>=0&&(g[r[a]][i[s]]=t[r[a]][i[s]]);else g[r[a]]=t[r[a]];return e},e.events=function(t){return arguments.length?(u(t,k),e):k},e.width=function(t){return arguments.length?(g.width=t,e):g.width},e.height=function(t){return arguments.length?(g.height=t,e):g.height},e.duration=function(t){return arguments.length?(x=t,e):x},e.orientation=function(t){return arguments.length?(["horizontal","vertical"].indexOf(t)>=0&&(g.orientation=t),e):g.orientation},e.update=function(){k.update.begin&&k.update.begin(data),"function"==typeof h&&h(),setTimeout(function(){k.update.end&&k.update.end(data)},x)},e.reset=function(e){v=[],"function"==typeof h&&h()},e.points=function(t){return arguments.length?(t.constructor===Array&&(v=t),e):v},e.pointsServed=function(e){if(!arguments.length||!m)return w;w=e;for(var t=0;t<v.length;t++)v[t].hide=void 0!=e&&v[t].server!=e;d("result"),"function"==typeof h&&h()},e.displayPct=function(t){return arguments.length?(b=t,h(),e):b},rallyWinPct=function(e){for(var t={},r={},n={},a={},i={},o={},s=0;s<v.length;s++){var l=v[s].rallyLength();t[l]=l in t?t[l]+1:1;var c=v[s].server==e?1:0;c?n[l]=l in n?n[l]+1:1:i[l]=l in i?i[l]+1:1,v[s].winner==e&&(r[l]=l in r?r[l]+1:1,c?a[l]=l in a?a[l]+1:1:o[l]=l in o?o[l]+1:1)}pp_keys=Object.keys(t);for(var u=[].slice.apply(new Uint8Array(parseInt(f(pp_keys))+1)),d=[].slice.apply(new Uint8Array(parseInt(f(pp_keys))+1)),p=[].slice.apply(new Uint8Array(parseInt(f(pp_keys))+1)),h=[].slice.apply(new Uint8Array(parseInt(f(pp_keys))+1)),m=[].slice.apply(new Uint8Array(parseInt(f(pp_keys))+1)),g=[].slice.apply(new Uint8Array(parseInt(f(pp_keys))+1)),y=[].slice.apply(new Uint8Array(parseInt(f(pp_keys))+1)),x=[].slice.apply(new Uint8Array(parseInt(f(pp_keys))+1)),b=[].slice.apply(new Uint8Array(parseInt(f(pp_keys))+1)),_=[].slice.apply(new Uint8Array(parseInt(f(pp_keys))+1)),k=0;k<u.length;k++){var S=0,O=0,A=0,T=0,P=0,R=0;remaining_rally_lengths=pp_keys.filter(function(e){return e>=k});for(var M=0;M<remaining_rally_lengths.length;M++)void 0!==t[remaining_rally_lengths[M]]&&(S+=t[remaining_rally_lengths[M]]),void 0!==n[remaining_rally_lengths[M]]&&(O+=n[remaining_rally_lengths[M]]),void 0!==i[remaining_rally_lengths[M]]&&(A+=i[remaining_rally_lengths[M]]),void 0!==r[remaining_rally_lengths[M]]&&(T+=r[remaining_rally_lengths[M]]),void 0!==a[remaining_rally_lengths[M]]&&(P+=a[remaining_rally_lengths[M]]),void 0!==o[remaining_rally_lengths[M]]&&(R+=o[remaining_rally_lengths[M]]);u[k]=S,d[k]=O,p[k]=A,h[k]=T,m[k]=P,g[k]=R,y[k]=Math.round(h[k]/u[k]*100),x[k]=d[k]?Math.round(m[k]/d[k]*100):0,b[k]=p[k]?Math.round(g[k]/p[k]*100):0,_[k]={pct_won:y[k],sv_pct_won:x[k],rc_pct_won:b[k],points_played:u[k],points_won:h[k]}}var E={0:[x,b],1:[b,x]};return E[w]?E[w][e]:y},e}function RadarChart(){function e(e){e.each(function(){t(),n(),A=d3.select(this),g();var e=A.append("svg").attr("width",R.width).attr("height",R.height);y=e.append("g").attr("class",R.class+"RadarNode"),x=e.append("g").attr("class",R.class+"HoverNode"),b=e.append("g").attr("class",R.class+"TooltipNode"),w=e.append("g").attr("class",R.class+"Legend");var r=y.append("g").attr("class",R.class+"AxisWrapper"),a=y.append("defs").append("filter").attr("id",R.filter_id),l=(a.append("feGaussianBlur").attr("stdDeviation","2.5").attr("result","coloredBlur"),a.append("feMerge"));l.append("feMergeNode").attr("in","coloredBlur"),l.append("feMergeNode").attr("in","SourceGraphic");k=b.append("text").attr("class",R.class+"Tooltip").style("opacity",0),_=function(){var a=W;t(),n(),S=E.map(function(e){return e.key}),O=d3.scale.ordinal().domain(E.map(function(e){return e._i})).range(E.map(function(e){return e.key})),T=d3.scale.ordinal().domain(E.map(function(e){return R.areas.colors[O(e._i)]?O(e._i):e._i.toString()})).range(E.map(function(e){return s(e)})),e.transition().delay(z).duration(a).attr("width",R.width).attr("height",R.height),y.transition().delay(z).duration(a).attr("width",R.width).attr("height",R.height).attr("transform","translate("+((R.width-(R.margins.left+R.margins.right))/2+R.margins.left)+","+((R.height-(R.margins.top+R.margins.bottom))/2+R.margins.top)+")"),x.transition().delay(z).duration(a).attr("width",R.width).attr("height",R.height).attr("transform","translate("+((R.width-(R.margins.left+R.margins.right))/2+R.margins.left)+","+((R.height-(R.margins.top+R.margins.bottom))/2+R.margins.top)+")"),b.transition().delay(z).duration(a).attr("width",R.width).attr("height",R.height).attr("transform","translate("+((R.width-(R.margins.left+R.margins.right))/2+R.margins.left)+","+((R.height-(R.margins.top+R.margins.bottom))/2+R.margins.top)+")"),w.attr("transform","translate("+R.legend.position.x+","+R.legend.position.y+")");var l=r.selectAll("."+R.class+"GridCircle").data(d3.range(1,R.circles.levels+1).reverse());l.transition().duration(a).attr("r",function(e,t){return j.radius/R.circles.levels*e}).style("fill",R.circles.fill).style("fill-opacity",R.circles.opacity).style("stroke",R.circles.color).style("filter",function(){if(R.filter)return"url(#"+R.filter+")"}),l.enter().append("circle").attr("class",R.class+"GridCircle").attr("r",function(e,t){return j.radius/R.circles.levels*e}).on("mouseover",function(e,t){M.gridCircle.mouseover&&M.gridCircle.mouseover(e,t)}).on("mouseout",function(e,t){M.gridCircle.mouseout&&M.gridCircle.mouseout(e,t)}).on("click",function(e,t){M.gridCircle.mouseclick&&M.gridCircle.mouseclick(e,t)}).style("fill",R.circles.fill).style("fill-opacity",R.circles.opacity).style("stroke",R.circles.color).style("filter",function(){if(R.filter)return"url(#"+R.filter+")"}),l.exit().transition().duration(.5*a).delay(function(e,t){return 0}).remove();var c=r.selectAll("."+R.class+"AxisLabel").data(d3.range(1,R.circles.levels+1).reverse());c.enter().append("text").attr("class",R.class+"AxisLabel").attr("x",4).attr("y",function(e){return-e*j.radius/R.circles.levels}).attr("dy","0.4em").style("font-size","10px").attr("fill","#737373").on("mouseover",function(e,t){M.axisLabel.mouseover&&M.axisLabel.mouseover(e,t)}).on("mouseout",function(e,t){M.axisLabel.mouseout&&M.axisLabel.mouseout(e,t)}).text(function(e,t){if(j.maxValue)return F(j.maxValue*e/R.circles.levels)}),c.exit().transition().duration(.5*a).remove(),c.transition().duration(a/2).style("opacity",1).transition().duration(a/2).style("opacity",1).attr("y",function(e){return-e*j.radius/R.circles.levels}).text(function(e,t){if(j.maxValue)return F(j.maxValue*e/R.circles.levels)});var u=r.selectAll("."+R.class+"Axis").data(j.axes,B);u.enter().append("g").attr("class",R.class+"Axis").attr("key",function(e){return e.axis}),u.exit().transition().duration(a).style("opacity",0).remove();var d=u.selectAll("."+R.class+"Line").data(function(e){return[e]},B);d.enter().append("line").attr("class",R.class+"Line").attr("x1",0).attr("y1",0).attr("x2",function(e,t,r){return i(null,1.1,r)}).attr("y2",function(e,t,r){return o(null,1.1,r)}).on("mouseover",function(e,t,r){M.line.mouseover&&M.line.mouseover(e,r)}).on("mouseout",function(e,t,r){M.line.mouseout&&M.line.mouseout(e,r)}).style("stroke",R.axes.lineColor).style("stroke-width","2px"),d.exit().transition().duration(.5*a).delay(function(e,t){return 0}).remove(),d.transition().duration(a).style("stroke",R.axes.lineColor).style("stroke-width",R.axes.lineWidth).attr("x2",function(e,t,r){return i(null,1.1,r)}).attr("y2",function(e,t,r){return o(null,1.1,r)});var p=u.selectAll("."+R.class+"AxisLegend").data(function(e){return[e]},B);p.enter().append("text").attr("class",R.class+"AxisLegend").style("font-size",R.axes.fontWidth).attr("text-anchor","middle").attr("dy","0.35em").attr("x",function(e,t,r){return i(null,R.circles.labelFactor,r)}).attr("y",function(e,t,r){return o(null,R.circles.labelFactor,r)}).style("opacity",function(e,t){return R.axes.display?1:0}).on("mouseover",function(e,t,r){M.axisLegend.mouseover&&M.axisLegend.mouseover(e,t,r)}).on("mouseout",function(e,t,r){M.axisLegend.mouseout&&M.axisLegend.mouseout(e,t,r)}).call(v,R.axes.wrapWidth),p.exit().transition().duration(.5*a).delay(function(e,t){return 0}).remove(),p.transition().duration(a).style("opacity",function(e,t){return R.axes.display&&j.radius>R.axes.threshold?1:0}).attr("x",function(e,t,r){return i(null,R.circles.labelFactor,r)}).attr("y",function(e,t,r){return o(null,R.circles.labelFactor,r)}).selectAll("tspan").attr("x",function(e,t,r){return i(null,R.circles.labelFactor,r)}).attr("y",function(e,t,r){return o(null,R.circles.labelFactor,r)});var f=d3.svg.line.radial().interpolate(R.areas.rounded?"cardinal-closed":"linear-closed").radius(function(e){return j.rScale(e.value)}).angle(function(e,t){return t*j.angleSlice}),h=y.selectAll("."+R.class+"RadarWrapper").data(E,N);h.enter().append("g").attr("class",R.class+"RadarWrapper").attr("key",function(e){return e.key}),h.exit().transition().duration(a).style("opacity",0).remove(),h.style("fill-opacity",function(e,t){return R.areas.filter.indexOf(e.key)>=0?0:R.areas.opacity});var g=h.selectAll("."+R.class+"RadarArea").data(function(e){return[e]},N);g.enter().append("path").attr("class",function(e){return R.class+"RadarArea "+e.key.replace(/\s+/g,"")}).attr("d",function(e,t){return f(e.values)}).style("fill",function(e,t,r){return s(e)}).style("fill-opacity",0).on("mouseover",function(e,t){M.radarArea.mouseover&&M.radarArea.mouseover(e,t,this)}).on("mouseout",function(e,t){M.radarArea.mouseout&&M.radarArea.mouseout(e,t,this)}),g.exit().remove(),g.transition().duration(a).style("fill",function(e,t,r){return s(e)}).attr("d",function(e,t){return f(e.values)}).style("fill-opacity",function(e,t){return R.areas.filter.indexOf(e.key)>=0?0:R.areas.opacity});var _=h.selectAll("."+R.class+"RadarStroke").data(function(e){return[e]},N);_.enter().append("path").attr("class",R.class+"RadarStroke").attr("d",function(e,t){return f(e.values)}).style("opacity",0).style("stroke-width",R.areas.borderWidth+"px").style("stroke",function(e,t,r){return s(e)}).style("fill","none").style("filter",function(){if(R.filter)return"url(#"+R.filter+")"}),_.exit().remove(),_.transition().duration(a).style("stroke",function(e,t,r){return s(e)}).attr("d",function(e,t){return f(e.values)}).style("filter",function(){if(R.filter)return"url(#"+R.filter+")"}).style("opacity",function(e,t){return R.areas.filter.indexOf(e.key)>=0?0:1}),update_radarCircle=h.selectAll("."+R.class+"RadarCircle").data(function(e,t){return m(e._i,e.key,e.values)}),update_radarCircle.enter().append("circle").attr("class",R.class+"RadarCircle").attr("r",R.areas.dotRadius).attr("cx",function(e,t,r){return i(0,0,t)}).attr("cy",function(e,t,r){return o(0,0,t)}).style("fill",function(e,t,r){return s(e,e._i,E[r].key)}).style("fill-opacity",function(e,t){return 0}).transition().duration(a).attr("cx",function(e,t,r){return i(e.value,0,t)}).attr("cy",function(e,t,r){return o(e.value,0,t)}),update_radarCircle.exit().remove(),update_radarCircle.transition().duration(a).style("fill",function(e,t,r){return s(e,e._i,E[r].key)}).style("fill-opacity",function(e,t,r){var n=E.map(function(e){return e.key})[r];return R.areas.filter.indexOf(n)>=0?0:.8}).attr("r",R.areas.dotRadius).attr("cx",function(e,t){return i(e.value,0,t)}).attr("cy",function(e,t){return o(e.value,0,t)});var k=x.selectAll("."+R.class+"RadarCircleWrapper").data(E,N);if(k.enter().append("g").attr("class",R.class+"RadarCircleWrapper").attr("key",function(e){return e.key}),k.exit().transition().duration(a).style("opacity",0).remove(),update_radarInvisibleCircle=k.selectAll("."+R.class+"RadarInvisibleCircle").data(function(e,t){return m(e._i,e.key,e.values)}),update_radarInvisibleCircle.enter().append("circle").attr("class",R.class+"RadarInvisibleCircle").attr("r",1.5*R.areas.dotRadius).attr("cx",function(e,t){return i(e.value,0,t)}).attr("cy",function(e,t){return o(e.value,0,t)}).style("fill","none").style("pointer-events","all").on("mouseover",function(e,t){M.radarInvisibleCircle.mouseover&&M.radarInvisibleCircle.mouseover(e,t,this)}).on("mouseout",function(e,t){M.radarInvisibleCircle.mouseout&&M.radarInvisibleCircle.mouseout(e,t,this)}),update_radarInvisibleCircle.exit().remove(),update_radarInvisibleCircle.attr("cx",function(e,t){return i(e.value,0,t)}).attr("cy",function(e,t){return o(e.value,0,t)}),R.legend.display){var A=d3.svg.symbol().type(R.legend.symbol).size(150)(),T=d3.scale.ordinal().domain(E.map(function(e){return e._i})).range(E.map(function(e){return s(e)}));if(d3.legend){var P=d3.legend.color().shape("path",A).shapePadding(10).scale(T).labels(T.domain().map(function(e){return O(e)})).on("cellclick",function(e,t){M.legend.mouseclick&&M.legend.mouseclick(e,t,this)}).on("cellover",function(e,t){M.legend.mouseover&&M.legend.mouseover(e,t,this)}).on("cellout",function(e,t){M.legend.mouseout&&M.legend.mouseout(e,t,this)});w.call(P),w.selectAll(".cell").attr("gen",function(e,t){if(1==C[e])var r=d3.svg.symbol().type(R.legend.toggle).size(150)();else var r=d3.svg.symbol().type(R.legend.symbol).size(150)();return d3.select(this).select("path").attr("d",function(){return r}),C[e]})}}}})}function t(){E=JSON.parse(JSON.stringify(P));var e=r(E),t={};E.forEach(function(r){r.values.forEach(function(r,n){var a=t[e[n]]?t[e[n]]:R.axes.ranges[e[n]]?R.axes.ranges[e[n]].slice():[0,1],i=r.value>a[1]?r.value:a[1],o=r.value<a[0]?r.value:a[0];t[e[n]]=[o,i]})}),E.forEach(function(r){r.values.forEach(function(r,n){if(0!=t[e[n]][0]&&1!=t[e[n]][1]){var a=t[e[n]];r.original_value=Number(r.value),r.value=(r.value-a[0])/(a[1]-a[0])}R.axes.invert.indexOf(e[n])>=0&&(r.value=1-r.value)})}),E.forEach(function(e){e._avg=d3.mean(e.values,function(e){return e.value})}),E=R.areas.sort?E.sort(function(e,t){var e=e._avg,t=t._avg;return t-e}):E;var n=e.map(function(t,r){return R.axes.filter.indexOf(e[r])>=0?r:void 0}).reverse();E.forEach(function(e){n.forEach(function(t){t>=0&&e.values.splice(t,1)})});var a=function(e,t){for(;e--;)t[e]=e;return t}(10,[]),i=E.map(function(e){return e._i}),o=a.filter(function(e){return i.indexOf(e)<0}).reverse();E=E.map(function(e,t){return e._i>=0?e:(e._i=o.length?o.pop():t,e)})}function r(e){return e.length?e[0].values.map(function(e,t){return e.axis}):[]}function n(){var e=E.length?E[0].values.map(function(e,t){return e}):[],t=r(E);j={radius:Math.min((R.width-(R.margins.left+R.margins.right))/2,(R.height-(R.margins.bottom+R.margins.top))/2),axes:e,axisLabels:t,maxValue:Math.max(R.circles.maxValue,d3.max(E,function(e){return d3.max(e.values.map(function(e){return e.value}))}))},j.radius=Math.max(j.radius,R.minRadius),j.total=j.axes.length,j.angleSlice=j.total>0?2*Math.PI/j.total:1,j.rScale=d3.scale.linear().range([0,j.radius]).domain([0,j.maxValue])}function a(t,r,n){function a(e){!isNaN(e)&&function(e){return(0|e)===e}(parseFloat(e))?i(parseInt(e)):"string"==typeof e&&i(e)}function i(e){n.indexOf(e)>=0?o(e):e>=0&&e<n.length&&o(n[e])}function o(e){t.indexOf(e)>=0?s(t,e):t.push(e)}function s(e,t){for(var r=e.length;r--;)e[r]===t&&e.splice(r,1)}if(r.constructor===Array)r.forEach(function(e){a(e)});else{if("object"==typeof r)return e;a(r)}}function i(e,t,r){return j.rScale(e?e:j.maxValue*t)*Math.cos(j.angleSlice*r-Math.PI/2)}function o(e,t,r){return j.rScale(e?e:j.maxValue*t)*Math.sin(j.angleSlice*r-Math.PI/2)}function s(e,t,r){return t=t?t:e._i,r=r?r:e.key,R.areas.colors[r]?R.areas.colors[r]:R.color(t)}function l(e,t){if(e&&t)for(var r=Object.keys(e),n=Object.keys(t),a=0;a<r.length;a++)if(n.indexOf(r[a])>=0){var i=t[r[a]],o=e[r[a]];"object"==typeof i&&"function"!=typeof o&&i&&i.constructor!==Array?l(e[r[a]],t[r[a]]):t[r[a]]=e[r[a]]}}function c(e,t,r){C[e._i]||(y.selectAll("."+R.class+"RadarArea").transition().duration(200).style("fill-opacity",function(e,t,r){return R.areas.filter.indexOf(e.key)>=0?0:.1}),d3.select(r).transition().duration(200).style("fill-opacity",function(e,t,r){return R.areas.filter.indexOf(e.key)>=0?0:.7}))}function u(e,t,r){y.selectAll("."+R.class+"RadarArea").transition().duration(200).style("fill-opacity",function(e,t,r){return R.areas.filter.indexOf(e.key)>=0?0:R.areas.opacity})}function d(e,t,r){if(!C[e]){var n=S.indexOf(e)>=0?e:O(e);y.selectAll("."+R.class+"RadarArea").transition().duration(200).style("fill-opacity",function(e,t,r){return R.areas.filter.indexOf(e.key)>=0?0:.1}),y.selectAll("."+R.class+"RadarArea."+n.replace(/\s+/g,"")).transition().duration(200).style("fill-opacity",function(e,t,r){return R.areas.filter.indexOf(e.key)>=0?0:.7})}}function p(e,t,r){var n=E.map(function(e){return e.key});a(R.areas.filter,n[e],n),C[e]=!C[e],_()}function f(e,t,n){if(!C[e._i]){r(E);y.select('[key="'+e.axis+'"]').select("text").style("opacity",1);var a=e.original_value?e.original_value:F(e.value);newX=parseFloat(d3.select(n).attr("cx"))-10,newY=parseFloat(d3.select(n).attr("cy"))-10,k.attr("x",newX).attr("y",newY).text(a).transition().duration(200).style("opacity",1)}}function h(e,t,r){y.select('[key="'+e.axis+'"]').select("text").style("opacity",R.axes.display&&j.radius>R.axes.threshold?1:0),k.transition().duration(200).style("opacity",0)}function m(e,t,r){for(var n=0;n<r.length;n++)r[n]._i=e,r[n].key=t;return r}function v(e,t){e.each(function(e,r,n){for(var a,s=d3.select(this),l=e.axis.split(/\s+/).reverse(),c=[],u=0,d=1.4,p=(i(null,R.circles.labelFactor,n),o(null,R.circles.labelFactor,n),parseFloat(s.attr("dy"))),f=s.text(null).append("tspan").attr("dy",p+"em");a=l.pop();)c.push(a),f.text(c.join(" ")),f.node().getComputedTextLength()>t&&(c.pop(),f.text(c.join(" ")),c=[a],f=s.append("tspan").attr("dy",++u*d+p+"em").text(a))})}function g(){if(R.resize&&A){var t=A.node().getBoundingClientRect().left,r=A.node().getBoundingClientRect().top,n=Math.min(R.widthMax,document.documentElement.clientWidth-t),a=Math.min(R.heightMax,document.documentElement.clientHeight-r);R.height=a,R.width=n,e.update()}}var y,x,b,w,_,k,S,O,A,T=UUID.generate(),P=[],R={filter:"rcGlow"+T,filter_id:"rcGlow"+T,resize:!1,width:window.innerWidth,widthMax:window.innerWidth,height:window.innerHeight,heightMax:window.innerHeight,minRadius:80,margins:{top:100,right:100,bottom:100,left:100},circles:{levels:8,maxValue:0,labelFactor:1.25,opacity:.1,fill:"#CDCDCD",color:"#CDCDCD"},areas:{colors:{},opacity:.35,borderWidth:2,rounded:!0,dotRadius:4,sort:!0,filter:[]},axes:{display:!0,threshold:90,lineColor:"white",lineWidth:"2px",fontWidth:"11px",fontColor:"black",wrapWidth:60,filter:[],invert:[],ranges:{}},legend:{display:!1,symbol:"cross",toggle:"circle",position:{x:25,y:25}},class:"rc",color:d3.scale.category10()},M={update:{begin:null,end:null},gridCircle:{mouseover:null,mouseout:null,mouseclick:null},axisLabel:{mouseover:null,mouseout:null,mouseclick:null},line:{mouseover:null,mouseout:null,mouseclick:null},legend:{mouseover:d,mouseout:u,mouseclick:p},axisLegend:{mouseover:null,mouseout:null,mouseclick:null},radarArea:{mouseover:c,mouseout:u,mouseclick:null},radarInvisibleCircle:{mouseover:f,mouseout:h,mouseclick:null}},E=[],C=[],j={},F=d3.format("%"),W=1e3,z=0;e.nodes=function(){return{svg:svg,chart:y,hover:x,tooltip:b,legend:w}},e.width=function(t){return arguments.length?(R.resize?R.widthMax=t:R.width=t,g(),e):R.width},e.height=function(t){return arguments.length?(R.resize?R.heightMax=t:R.height=t,g(),e):R.height},e.duration=function(t){return arguments.length?(W=t,e):W},e.update=function(){M.update.begin&&M.update.begin(E),"function"==typeof _&&_(),setTimeout(function(){M.update.end&&M.update.end(E)},W)},e.data=function(t){if(!arguments.length)return P;if(C.length){var r=E.map(function(e){return e.key});C.forEach(function(t,n){e.filterAreas(r[n])})}return C=[],P=t,e},e.pop=function(){var e=P.pop();return"function"==typeof _&&_(),e},e.push=function(t){function r(e){e&&e.key&&P.map(function(e){return e.key}).indexOf(e.key)<0&&P.push(e)}if(t&&t.constructor===Array)for(var n=0;n<t.length;n++)r(t[n]);else r(t);return e},e.shift=function(){var e=P.shift();return"function"==typeof _&&_(),e},e.unshift=function(t){function r(e){e.key&&P.map(function(e){return e.key}).indexOf(e.key)<0&&P.unshift(e)}if(t&&t.constructor===Array)for(var n=0;n<t.length;n++)r(t[n]);else r(t);return e},e.slice=function(e,t){return P.slice(e,t)},e.options=function(t){return arguments.length?(l(t,R),e):R},e.events=function(t){return arguments.length?(l(t,M),e):M},e.margins=function(t){if(!arguments.length)return R.margins;for(var r=Object.keys(values),n=Object.keys(R.margins),a=0;a<r.length;a++)n.indexOf(r[a])>=0&&(R.margins[r[a]]=values[r[a]]);return e},e.levels=function(t){return arguments.length?(R.circles.levels=t,e):R.circles.levels},e.maxValue=function(t){return arguments.length?(R.circles.maxValue=t,e):R.circles.maxValue},e.opacity=function(t){return arguments.length?(R.areas.opacity=t,e):R.areas.opacity},e.borderWidth=function(t){return arguments.length?(R.areas.borderWidth=t,e):R.areas.borderWidth},e.rounded=function(t){return arguments.length?(R.areas.rounded=t,e):R.areas.rounded},e.color=function(t){return arguments.length?(R.color=t,e):R.color},e.colors=function(t){return arguments.length?(R.areas.colors=t,e):R.areas.colors},e.keys=function(){return P.map(function(e){return e.key})},e.axes=function(){return r(P)},e.filterAxes=function(t){if(!arguments.length)return R.axes.filter;var n=r(P);return a(R.axes.filter,t,n),e},e.filterAreas=function(t){if(!arguments.length)return R.areas.filter;var r=P.map(function(e){return e.key});return a(R.areas.filter,t,r),e},e.invert=function(t){if(!arguments.length)return R.axes.invert;var n=r(P);return a(R.axes.invert,t,n),e},e.ranges=function(t){function n(e){for(var t=Object.keys(e),r=0;r<t.length;r++)i.indexOf(t[r])>=0&&e[t[r]]&&e[t[r]].constructor===Array&&a(t[r],e[t[r]])&&(R.axes.ranges[t[r]]=e[t[r]])}function a(e,t){return 2==t.length&&!isNaN(t[0])&&!isNaN(t[1])||(0==t.length&&delete R.axes.ranges[e],!1)}if(!arguments.length)return R.axes.ranges;if("string"==typeof t)return e;var i=r(P);return t&&t.constructor===Array?t.forEach(function(e){n(e)}):n(t),e};var N=function(e){return e&&e.key},B=function(e){return e&&e.axis};return window.addEventListener("resize",g,!1),e}function ladderChart(){function e(e){e.each(function(){c=d3.select(this);var e,a=c.append("svg").attr("class","itemCalendar"),m=a.append("rect"),v=a.append("g").attr({class:"chartHolder",transform:"translate(0,0)"}),y=a.append("svg").attr("class","hoverFrame"),x=v.append("g").attr("class","calendarPlot"),b=x.append("path.connector"),w=x.append("g.axis.x"),_=x.append("g.axis.y"),k=x.append("line"),S=x.append("line"),O=v.append("g.legends"),A=O.append("text.title"),T=O.append("text.footnote");p=function(p){function v(){f.display.helpImg&&e.attr("opacity",1)}function O(){f.display.helpImg&&e.attr("opacity",0)}var P=!l.values.length;if(a.on("mouseover",v).on("mouseout",O),f.display.sizeToFit||p&&p.sizeToFit){var R=c.node().getBoundingClientRect();f.width=Math.max(R.width,300),f.height=Math.min(Math.max(f.width/3,100),200)}if(P||!f.data.calculateDomain)var M=[f.plot.dateDomain.start,f.plot.dateDomain.end];else{var M=d3.extent(l.values.map(function(e){return e[f.plot.shape.dateKey]})),E=i(M[0],M[1]),C=new Date(M[0].getFullYear(),0,1),j=new Date(M[1].getFullYear(),11,31);if(f.data.fullYearsOnly)M=[C,j];else if(f.data.oneYearMinimum&&E<365){var F=i(C,M[0]),W=i(M[1],j);M=F<W&&E+F>=365?[C,M[1]]:E+W>=365?[M[0],j]:[C,j]}}var z,N=o(M[0],M[1]),B=N>1?"%Y":"%b";z=N<=1?f.plot.xAxis.maxTicks:N>2?Math.min(N,f.plot.xAxis.maxTicks):2,u=f.width-(f.margins.left+f.margins.right),d=f.height-(f.margins.top+f.margins.bottom);var D=d3.scale.ordinal().range(f.plot.content.rows).domain(d3.range(0,f.plot.content.rows.length,1)),L=d3.time.scale().range([f.plot.margins.left,u-f.plot.margins.right]).domain(M),I=d3.svg.axis().orient("bottom").ticks(z).tickSize(-d).tickFormat(d3.time.format(B)).scale(L),G=d3.scale.linear().range([d-f.plot.margins.bottom,f.plot.margins.top]).domain([0,f.plot.content.rows.length-1]),H=d3.svg.axis().orient("left").ticks(f.plot.content.rows.length).tickSize(-u,0,0).tickFormat(D).scale(G);a.attr({width:f.width+"px",height:f.height+"px"}),m.attr({class:"frame",x:f.margins.left,y:0,width:f.width-(f.margins.left+f.margins.right)+"px",height:f.height+"px"}).style({fill:"white"}),T.style({fill:f.plot.footnote.fill,"font-size":s(f.plot.footnote.fontSize,u)+"px"}).html(function(){if(f.plot.source.text)return"Source: "+f.plot.source.text}).attr({class:"footnote",x:function(){return f.width-f.margins.right-80},y:f.height}),x.attr({transform:"translate("+f.margins.left+","+f.margins.top+")"}),w.translate([0,d-f.plot.margins.bottom]).call(I),k.attr("stroke","black").attr("x1",0).attr("x2",u).attr("y1",d-f.plot.margins.bottom).attr("y2",d-f.plot.margins.bottom),_.translate([f.plot.margins.left,0]).call(H),S.attr("stroke","black").attr("x1",f.plot.margins.left).attr("x2",f.plot.margins.left).attr("y1",d-f.plot.margins.bottom).attr("y2",f.plot.margins.top),x.selectAll(".axis.y .tick line").attr({dy:"-2"}).style({stroke:"#cec6b9","stroke-dasharray":"2 2"}),x.selectAll(".axis.y .tick text").attr({dy:"-2"}).style({fill:"#74736c"}).on("click",function(e,t){g.axis.y.click&&g.axis.y.click(e,t)}),x.selectAll(".axis.x .tick line").style({stroke:"#cec6b9","stroke-dasharray":"2 2"}),x.selectAll(".axis.x .tick text").attr({dx:"1"}).style({"font-weight":f.plot.xAxis.fontWeight,fill:"#74736c"}).on("click",function(e,t){var r=M[1].getFullYear()-M[0].getFullYear();g.axis.x.click&&g.axis.x.click(e,r)}),x.selectAll(".axis.y .tick line").translate([-f.plot.margins.left,0]),x.selectAll(".axis.x .tick line").translate([0,f.plot.margins.right]),x.selectAll("g.axis path.domain").style("display","none"),A.attr({x:f.plot.title.x,y:f.plot.title.y}).style({fill:f.plot.title.fill,"font-size":s(f.plot.title.fontSize,u)+"px"}).on("click",function(){g.title.click&&g.title.click()}).html(function(e){var t=[M[0].getFullYear(),M[1].getFullYear()].filter(function(e,t,r){return r.lastIndexOf(e)==t}).join(" - ");if(f.plot.title.text)return f.plot.title.text+" "+t});var q=d3.svg.line().interpolate("step-after").x(function(e){return L(e[f.plot.shape.dateKey])}).y(function(e){return G(e[f.plot.shape.rungKey])});if(b.transition().duration(f.display.transition_time).attr({class:"itemConnector",d:q(l.values)}).style({fill:f.plot.connector.fill,stroke:f.plot.connector.stroke,"stroke-opacity":f.plot.connector.opacity,"stroke-width":f.plot.connector.width}),d3.superformula)var U=d3.scale.ordinal().range(f.plot.shape.typeRange).domain(f.plot.shape.typeDomain),J=d3.superformula().type(function(e){var t=U(e[f.plot.shape.typeKey]);return t&&h.indexOf(t)>=0?t:"circle"}).size(r).segments(360);var V=x.selectAll(".itemDate").data(l.values);V.enter().append(J?"path":"circle").translate(function(e){return[L(e[f.plot.shape.dateKey]),G(e[f.plot.shape.rungKey])]}).style({opacity:0,"fill-opacity":0,stroke:n,"stroke-width":1}).attr({fill:n,class:"itemDate",r:t,d:J}),V.exit().transition().duration(f.display.transition_time).style({opacity:0,"fill-opacity":0}).remove(),V.translate(function(e){return[L(e[f.plot.shape.dateKey]),G(e[f.plot.shape.rungKey])]}).attr({id:function(e){var t=f.data.contextAttribute?e[f.data.contextAttribute]:"";return"itemDate"+t},r:t,d:J}).style({fill:n,opacity:f.plot.shape.opacity,"fill-opacity":f.plot.shape.opacity,stroke:n,"stroke-width":1}).on("mouseover",g.item.mouseover).on("mouseout",g.item.mouseout).on("click",g.item.click),x.select(".axis.y").selectAll("text").style({"font-size":s(f.plot.yAxis.fontSize,u)+"px"}),x.select(".axis.x").selectAll("text").style({"font-size":s(f.plot.xAxis.fontSize,u)+"px"}),f.display.helpImg?(e=y.selectAll("image").data([0]),e.enter().append("image").attr("class","help").on("click",function(){g.help.click&&g.help.click(f.id)}),e.exit().remove(),e.attr({"xlink:href":f.display.helpImg,x:u-10,y:0,height:"20px",width:"20px",opacity:0})):y.selectAll("image.help").remove()}})}function t(e){var t=e[f.plot.shape.sizeKey],r=2*f.plot.shape.shapeSizeBase;return t&&r?Math.sqrt(t*u/r):10}function r(e){var t=e[f.plot.shape.sizeKey],r=f.plot.shape.shapeSizeBase;return t&&r?t*u/r:u/3}function n(e){var t=e[f.plot.shape.colorKey];return t&&v[t]?v[t]:f.plot.color.default}function a(e,t){if(e&&t)for(var r=Object.keys(e),n=Object.keys(t),i=0;i<r.length;i++)if(n.indexOf(r[i])>=0){var o=t[r[i]],s=e[r[i]];"object"==typeof o&&"function"!=typeof s&&o.constructor!==Array?a(e[r[i]],t[r[i]]):t[r[i]]=e[r[i]]}}function i(e,t){return Math.round(Math.abs(+e-+t)/864e5)}function o(e,t){return Math.round(Math.abs(+e-+t)/31536e6)}function s(e,t){var r=d3.scale.linear();return r.domain([0,2e3]).range([5,e]),r(t)}var l,c,u,d,p,f={id:"ladderChart",width:window.innerWidth,height:window.innerHeight,margins:{top:30,bottom:10,left:15,right:10},data:{contextAttribute:void 0,calculateDomain:!0,oneYearMinimum:!1,fullYearsOnly:!1},plot:{title:{x:40,y:15,fill:"#74736c",fontSize:26,text:void 0},source:{text:void 0},footnote:{fill:"#74736c",fontSize:20,text:void 0},margins:{top:0,bottom:12,left:25,right:10},dateDomain:{start:new Date((new Date).getFullYear(),0,1),end:new Date((new Date).getFullYear(),11,31)},content:{rows:[]},color:{default:"#b3b3cc"},yAxis:{fontSize:18},xAxis:{maxTicks:10,fontSize:24,fontWeight:400},connector:{fill:"none",stroke:"#a7a59b",opacity:.6,width:2},shape:{opacity:.7,dateKey:"date",rungKey:"rung",colorKey:void 0,sizeKey:void 0,shapeSizeBase:void 0,typeKey:void 0,typeRange:[],typeDomain:[]}},display:{transition_time:0,settingsImg:!1,helpImg:!1,sizeToFit:!0}},h=["asterisk","bean","butterfly","circle","clover","cloverFour","cross","diamond","drop","ellipse","gear","heart","heptagon","hexagon","malteseCross","pentagon","rectangle","roundedStar","square","star","triangle"],m={default:"#b3b3cc"},v=JSON.parse(JSON.stringify(m)),g={settings:{click:null},help:{click:null},update:{begin:null,end:null},item:{mouseover:null,mouseout:null,click:null},axis:{x:{click:null},y:{click:null}},title:{click:null}};return e.exports=function(){return{circleRadius:t,shapeSize:r,shapeColor:n,root:c}},e.options=function(t){return arguments.length?(a(t,f),e):f},e.events=function(t){return arguments.length?(a(t,g),e):g},e.width=function(t){return arguments.length?(f.width=t,e):f.width},e.height=function(t){return arguments.length?(f.height=t,e):f.height},e.data=function(t){return arguments.length?(l=t,e):l},e.update=function(e){g.update.begin&&g.update.begin(),"function"==typeof p&&l&&p(e),setTimeout(function(){g.update.end&&g.update.end()},f.display.transition_time)},e.colors=function(t){if(!arguments.length)return v;if("object"!=typeof t)return!1;var r=Object.keys(t);return!!r.length&&(r.forEach(function(e){/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t[e])||delete t[e]}),v=Object.keys(t).length?t:JSON.parse(JSON.stringify(m)),e)},e}function pCoords(){function e(e){e.each(function(){o=d3.select(this),u=o.append("svg").attr("class","pCoords");
var e,r,n=u.append("g").attr({class:"chartHolder",transform:"translate(0,0)"}),_=u.append("svg").attr({class:"hoverFrame"}),k=n.append("g").attr("class","coordsPlot"),A=k.append("g"),T=k.append("g");c=function(c){function P(){averages=i(),axis_avgs=H.selectAll(".pc_axis_avg").data(function(e){return[e]},O),axis_avgs.enter().append("text").attr({class:"pc_axis_avg"}),axis_avgs.style({"font-size":q(s)+"px","text-anchor":"end",fill:"blue",cursor:"move","shape-rendering":"crispEdges"}).attr("y",l+25).text(function(e){return averages[e]}).on("mousedown",function(){m=v}).on("click",function(e,t){if(a(v,m)){var r=h[e].brush.extent(),n=y.map(function(t){return t[e]});if(r[0]!=r[1])var i=y.filter(function(t){return t[e]>=r[0]&&t[e]<=r[1]}),o=i.map(function(e){return e._context_});var s=y.map(function(e){var t={};return g.x.forEach(function(r){t[r]=e[r]}),t}).filter(function(t){return r[0]==r[1]||t[e]>=r[0]&&t[e]<=r[1]});S.axis.y.click&&S.axis.y.click({d:e,i:t,axis_values:n,extents:r,item_values:s,context:o})}})}function R(){w.display.helpImg&&e.attr("opacity",1),w.display.settingsImg&&r.attr("opacity",1)}function M(){w.display.helpImg&&e.attr("opacity",0),w.display.settingsImg&&r.attr("opacity",0)}function E(e){return L(g.x.map(function(t){return[j(t),h[t](e[t])]}))}function C(e){return e.transition().duration(500)}function j(e){var t=b[e];return null==t?f(e):t}function F(){d3.event.sourceEvent.stopPropagation(),S.brush.start&&S.brush.start()}function W(){S.brush.end&&S.brush.end()}function z(){P(),S.brush.brushed&&S.brush.brushed();var e=g.x.filter(function(e){return!h[e].brush.empty()}),t=e.map(function(e){return h[e].brush.extent()});d.style("display",function(r){return e.every(function(e,n){return t[n][0]<=r[e]&&r[e]<=t[n][1]})?null:"none"})}function N(){var e=w.data.scales,t=Object.keys(e),r=h||{},n=d3.keys(y[0]).filter(function(n){if(w.data.hide.indexOf(n)>=0)return!1;if("_context_"==n)return!1;if(t.indexOf(n)>=0)r[n]=r[n]||e[n].scale,r[n].domain(e[n].domain).range([l,0]),"date"==e[n].type&&r[n].tickFormat(d3.time.format("%Y-%m-%d"));else{r[n]=r[n]||d3.scale.linear();var a=d3.extent(y,function(e){return+e[n]});1==y.length&&(a=[Math.min(0,a[0]),Math.max(a[1],100)]),r[n].domain(a).range([l,0])}return!0});return{x:n,y:r}}if(y.length){if(x.domain([0,y.length]),u.on("mouseover",R).on("mouseout",M),w.display.sizeToFit||c&&c.sizeToFit){var B=o.node().getBoundingClientRect();w.width=Math.max(B.width,300),w.height=Math.min(Math.max(w.width/3,100),250)}if(s=w.width-(w.margins.left+w.margins.right),l=w.height-(w.margins.top+w.margins.bottom),u.attr({width:w.width+"px",height:w.height+"px"}),n.attr({width:s+"px",height:l+"px",transform:"translate("+w.margins.left+","+w.margins.top+")"}),k.attr({width:s+"px",height:l+"px"}),f=d3.scale.ordinal().rangePoints([0,s],1),g=N(),v){var D=[];v.forEach(function(e){g.x.indexOf(e)>=0&&D.push(e)}),g.x.forEach(function(e){D.indexOf(e)<0&&D.push(e)}),g.x=D}h=g.y,f.domain(g.x);var L=d3.svg.line().interpolate("cardinal"),I=(d3.svg.axis().orient("left"),d3.svg.axis().orient("left")),G=A.selectAll("path").data(y);G.enter().append("path").attr("class","o_line"),G.exit().remove(),G.attr({fill:"none",stroke:"#ddd","stroke-opacity":.3,"stroke-width":1.5,d:E}).style({"shape-rendering":"crispEdges"}),d=T.selectAll("path").data(y),d.enter().append("path").attr("class","pc_line"),d.exit().remove(),d.attr({id:function(e,t){return"midx"+t},d:E}).style({fill:"none","stroke-opacity":w.plot.lines.opacity,stroke:function(e,r){return t(e,r)},"stroke-width":1.5}).on("click",function(e,t){S.lines.click&&S.lines.click({d:e,i:t})}).on("mouseover",function(e,t){S.lines.mouseover&&S.lines.mouseover({d:e,i:t}),d3.select(this).style("stroke","yellow")}).on("mouseout",function(e,r){S.lines.mouseout&&S.lines.mouseout({d:e,i:r}),d3.select(this).style("stroke",t(e,r))});var H=k.selectAll(".cpDimension").data(g.x);H.enter().append("g").attr("class","cpDimension"),H.exit().remove(),H.attr("transform",function(e){return"translate("+f(e)+")"}).call(d3.behavior.drag().origin(function(e){return{x:f(e)}}).on("dragstart",function(e){b[e]=f(e),G.attr("visibility","hidden")}).on("drag",function(e){b[e]=Math.min(s,Math.max(0,d3.event.x)),d.attr("d",E),g.x.sort(function(e,t){return j(e)-j(t)}),f.domain(g.x),H.attr("transform",function(e){return"translate("+j(e)+")"})}).on("dragend",function(e){v=g.x.slice(),delete b[e],C(d3.select(this)).attr("transform","translate("+f(e)+")"),C(d).attr("d",E),G.attr("d",E).transition().attr("visibility",null)})),H.exit().remove();var q=d3.scale.linear();q.domain([0,2e3]).range([0,w.plot.xAxis.fontSize]),axis_scale=H.selectAll(".pc_axis").data(function(e){return[e]},O),axis_scale.enter().append("g").attr({class:"pc_axis","shape-rendering":"crispEdges"}),axis_scale.exit().remove(),axis_scale.each(function(e){d3.select(this).call(I.scale(h[e]))}),axis_text=H.selectAll(".pc_axis_text").data(function(e){return[e]},O),axis_text.enter().append("text").attr({class:"pc_axis_text"}),axis_text.style({"font-size":q(s)+"px","text-anchor":"middle",cursor:"move","shape-rendering":"crispEdges"}).attr("y",-9).attr("transform","rotate("+w.plot.xAxis.rotate+")").text(function(e){return e}),axis_text.exit().remove(),n.selectAll(".pc_axis text").style({"font-size":q(s)+"px","text-shadow":"0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff",cursor:"move"}),n.selectAll(".pc_axis path").style({fill:"none",stroke:"#000","shape-rendering":"crispEdges"}),p=H.selectAll(".brush").data(function(e){return[e]},O),p.enter().append("g").attr("class","brush"),p.exit().remove(),p.each(function(e,t){d3.select(this).call(h[e].brush=d3.svg.brush().y(h[e]).on("brushstart",F).on("brushend",W).on("brush",z))}).selectAll("rect").attr("fill-opacity",".3").attr("stroke","#fff").attr("shape-rendering","crispEdges").attr("x",-8).attr("width",16),P(),w.display.settingsImg?(r=_.selectAll("image.settings").data([0]),r.enter().append("image").attr("class","settings").on("click",function(){S.settings.click&&S.settings.click(w.id+"Settings")}),r.exit().remove(),r.attr({"xlink:href":w.display.settingsImg,x:s-10,y:l/2+30,height:"20px",width:"20px",opacity:0})):_.selectAll("image.settings").remove(),w.display.helpImg?(e=_.selectAll("image.help").data([0]),e.enter().append("image").attr("class","help").on("click",function(){S.help.click&&S.help.click(w.id)}),e.exit().remove(),e.attr({"xlink:href":w.display.helpImg,x:s-10,y:l/2,height:"20px",width:"20px",opacity:0})):_.selectAll("image.help").remove()}}})}function t(e,t){if(w.plot.lines.colorKey){if(e[w.plot.lines.colorKey]&&k[e[w.plot.lines.colorKey]]){var r=k[e[w.plot.lines.colorKey]];return r}return"#ddd"}return x(t)}function r(e,t){if(e&&t)for(var n=Object.keys(e),a=Object.keys(t),i=0;i<n.length;i++)if(a.indexOf(n[i])>=0){var o=t[n[i]],s=e[n[i]];"object"==typeof o&&"function"!=typeof s&&o.constructor!==Array?r(e[n[i]],t[n[i]]):t[n[i]]=e[n[i]]}}function n(){var e=[];return d.each(function(t){"inline"==d3.select(this).style("display")&&e.push(t)}),e}function a(e,t){if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!=t[r])return!1;return!0}function i(){var e={};v.forEach(function(t){e[t]=0});var t=n();return t.forEach(function(t){v.forEach(function(r){e[r]+=+t[r]})}),v.forEach(function(r){e[r]=t.length?(e[r]/t.length).toFixed(2):""}),e}var o,s,l,c,u,d,p,f,h,m,v,g,y=[],x=(d3.scale.category10(),d3.scale.quantize().range(["#33cccc","#66CD00","#db3e3e","#235dba"])),b={},w={id:"pCoords",width:window.innerWidth,height:window.innerHeight,margins:{top:30,bottom:30,left:10,right:10},data:{hide:[],scales:{}},plot:{lines:{opacity:.5,colorKey:void 0},color:{default:"#b3b3cc"},xAxis:{rotate:0,fontSize:20,fontWeight:400}},display:{transition_time:0,settingsImg:!1,helpImg:!1,sizeToFit:!0}},_={default:"#b3b3cc"},k=JSON.parse(JSON.stringify(_)),S={settings:{click:null},help:{click:null},update:{begin:null,end:null},lines:{click:null,mouseover:null,mouseout:null},item:{mouseover:null,mouseout:null,click:null},brush:{start:null,brushed:null,end:null,clear:null},axis:{x:{click:null},y:{click:null}}},O=function(e){return e&&e.key};return e.exports=function(){return{}},e.options=function(t){return arguments.length?(r(t,w),e):w},e.events=function(t){return arguments.length?(r(t,S),e):S},e.width=function(t){return arguments.length?(w.width=t,e.update(),e):w.width},e.height=function(t){return arguments.length?(w.height=t,e.update(),e):w.height},e.data=function(t){return arguments.length?(d&&d.style("display",null),S.brush.clear&&S.brush.clear(),e.clearBrushes(),y=t,void 0==v&&(v=Object.keys(y[0]).filter(function(e){return!(w.data.hide.indexOf(e)>0)&&"_context_"!=e})),e):y},e.filteredData=n,e.activeBrushes=function(){var e=[];return h&&Object.keys(h).forEach(function(t){h[t].brush.empty()||e.push(t)}),e},e.clearBrushes=function(){var t=e.activeBrushes();t.length&&d3.selectAll(".brush rect.extent").attr("height",0),t.forEach(function(e){h[e].brush.clear()}),d&&d.each(function(e){d3.select(this).style("display","inline")})},e.activeAxes=function(e){return arguments.length?void(v=e):v||Object.keys(h)},e.hide=function(t){return arguments.length?(t.constructor!==Array&&(t=[t]),w.data.hide=t,e):w.data.hide},e.scales=function(t){return arguments.length?(w.data.scales=t,e):w.data.scales},e.update=function(e){S.update.begin&&S.update.begin(),"function"==typeof c&&y&&c(e),setTimeout(function(){S.update.end&&S.update.end()},w.display.transition_time)},e.colors=function(t){if(!arguments.length)return k;if("object"!=typeof t)return!1;var r=Object.keys(t);return!!r.length&&(r.forEach(function(e){/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t[e])||delete t[e]}),k=Object.keys(t).length?t:JSON.parse(JSON.stringify(_)),e)},e}function datePicker(){function e(e){e.each(function(){a=d3.select(this);var e=a.append("svg").attr({class:"datePicker",width:u.width,height:u.height}),n=e.append("g").attr("class","picker");o=function(o){function c(e,t){var r=e.node().getBBox(),a=6,i=n.selectAll("#bkgnd"+t).data([0]);i.enter().insert("rect","text").attr({id:"bkgnd"+t}).style("fill","white"),i.exit().remove(),i.attr({transform:p(null,t),x:r.x-a,y:r.y-a,width:r.width+2*a,height:r.height+2*a})}function p(e,t){var r="translate(";return r+=t<1?0:y,r=r+","+(u.height-u.margin.bottom)/2+")"}function f(){n.selectAll(".selection_caption").style("opacity",.8),"function"==typeof d.brush.start&&d.brush.start()}function h(){d3.select(this.parentNode);if(r(),v(),"function"==typeof d.brush.move&&i){var e=i?i:[u.start_date,u.end_date];d.brush.move({range:e})}}function m(){if(n.selectAll(".selection_caption").style("opacity",0),"function"==typeof d.brush.end){var e=i?i:[u.start_date,u.end_date];d.brush.end({range:e})}}function v(){k.attr("display",function(){return i&&i[0].getTime()<=i[1].getTime()?null:"none"}).attr("transform",function(){return i&&"translate("+w(i[0])+",0)"}).select("text").text(i&&u.dateformat(i[0])+"  "+u.dateformat(i[1]))}if(u.display.sizeToFit||o&&o.sizeToFit){var g=a.node().getBoundingClientRect();u.width=Math.max(g.width,300)}e.attr({width:u.width,height:u.height});var y=u.width-u.margin.left-u.margin.right;n.attr({transform:"translate("+u.margin.left+","+u.margin.top+")"});var x=n.selectAll(".rangeLine").data([0]);x.enter().append("line"),x.exit().remove(),x.attr({class:"rangeLine","shape-rendering":"crispEdges",stroke:"#777","stroke-dasharray":"2,2",x2:y,y1:u.height/2,y2:u.height/2});var b=n.selectAll(".dateAnchor").data([u.start_date,u.end_date]);b.enter().append("text").attr({class:"dateAnchor",id:function(e,t){return"dA"+t},"text-anchor":function(e,t){return t<1?"start":"end"},"alignment-baseline":"middle"}),b.exit().remove(),b.attr({transform:p}).text(function(e){return e.toLocaleDateString("en-US",u.dateString)}).each(function(e,t){c(d3.select(this),t)});var w=d3.time.scale(),_=d3.scale.linear();w.domain([u.start_date,u.end_date]).rangeRound([0,y]),_.domain([0,1]).rangeRound([0,u.height]),n.selectAll(".selection_caption").remove();var k=n.append("g").attr({class:"selection_caption",display:"none"});k.append("rect").attr({height:14,width:90,fill:"#fff",rx:4,ry:4}).style({stroke:"black",opacity:.8,"stroke-width":.3}),k.append("text").attr({x:2,y:11}).style({"font-size":10,"font-family":"sans-serif"}),n.selectAll(".brush").remove(),s=d3.svg.brush().x(w).on("brushstart",f).on("brush",h).on("brushend",m),l=n.append("g").attr({class:"brush",stroke:"rgb(108, 122, 168)",fill:"rgb(68, 104, 168)","fill-opacity":.1,"shape-rendering":"crispEdges"}).call(s),l.selectAll("rect").attr({height:u.height}),l.selectAll(".resize").append("path").attr({fill:"#eee",stroke:"#666",d:t})}})}function t(e){var t=+("e"==e),r=t?1:-1,n=2*u.height/3,a=(u.height-n)/2;return"M"+.5*r+","+a+"A6,6 0 0 "+t+" "+6.5*r+","+(a+6)+"V"+(a+n-6)+"A6,6 0 0 "+t+" "+.5*r+","+(a+n)+"ZM"+2.5*r+","+(a+8)+"V"+(a+n-8)+"M"+4.5*r+","+(a+8)+"V"+(a+n-8)}function r(){var e=s.extent(),t=d3.time.day.round(e[0]),r=d3.time.day.round(e[1]);t.getTime()>r||t.valueOf()==r.valueOf()?i=null:(r.setHours(23,59,59,999),i=[t,r]),e=e.map(d3.time.day.round),l.call(s.extent(e.map(d3.time.day.round))).selectAll(".resize").style("display",i&&t.getTime()<=r.getTime()?null:"none")}function n(e,t){if(e&&t)for(var r=Object.keys(e),a=Object.keys(t),i=0;i<r.length;i++)if(a.indexOf(r[i])>=0){var o=t[r[i]],s=e[r[i]];"object"==typeof o&&"function"!=typeof s&&o.constructor!==Array?n(e[r[i]],t[r[i]]):t[r[i]]=e[r[i]]}}var a,i,o,s,l,c=(new Date).getFullYear(),u={width:890,height:30,start_date:new Date(c+"-01-01"),end_date:new Date,dateformat:d3.time.format("%m-%Y"),dateString:{year:"numeric",month:"long"},display:{transition_time:0,sizeToFit:!0},margin:{top:0,right:30,bottom:0,left:30}},d={update:{begin:null,end:null},brush:{start:null,move:null,end:null,clear:null}};return e.options=function(t){return arguments.length?(n(t,u),e):u},e.update=function(e){d.update.begin&&d.update.begin(),"function"==typeof o&&o(e),setTimeout(function(){d.update.end&&d.update.end()},u.display.transition_time)},e.events=function(t){return arguments.length?(n(t,d),e):d},e.data=function(t){if(!arguments.length)return[u.start_date,u.end_date];if(Array.isArray(t))return t[0]&&t[1]&&t[0].valueOf()>t[1].valueOf()&&t.reverse(),u.start_date=t[0]?t[0]:new Date(c+"-01-01"),u.end_date=t[1]?t[1]:new Date,e},e.set=function(e,t){s.extent([e,t]),s(d3.select(".brush").transition()),s.event(d3.select(".brush")),r()},e}!function(){function e(e,t,r,n){var r=r||"GET";if(["GET","POST"].indexOf(r)<0)return!1;if("function"!=typeof n)return!1;var a=new XMLHttpRequest;return a.open(r,e,!0),a.setRequestHeader("Content-Type","application/json"),a.onload=function(){n(a.responseText)},a.onerror=function(){n('{"error":"connection error"}')},a.send(t),!0}function t(e){if(!w.nolog){var t=new XMLHttpRequest;t.open("GET",location.origin+"/report/"+e,!0),t.send()}}function r(e,t){if(t&&"function"==typeof t){w.message="Making CORS Request";var r=w.server+"/api/player/bio/"+e;b(r,function(e){t&&t(null,e)})}}function n(e,t,r){if(r&&"function"==typeof r)if(""!=t){w.message="Making CORS Request";var n=w.server+"/api/matches/stats/org/"+e+"/"+t;b(n,function(e){r&&r(null,e)})}else s(e,"/api/matches/stats/org/",function(e,t){e||r(null,t)})}function a(e,t,r){if(r&&"function"==typeof r)if(""!=t){w.message="Making CORS Request";var n=w.server+"/api/player/stats/points_to_set/"+e+"/"+t;b(n,function(e){r&&r(null,e)})}else s(e,"/api/player/stats/points_to_set/",function(e,t){e||r(null,t)})}function i(e,t,r){if(r&&"function"==typeof r)if(""!=t){w.message="Making CORS Request";var n=w.server+"/api/player/stats/overview/"+e+"/"+t;b(n,function(e){r&&r(null,e)})}else s(e,"/api/player/stats/overview/",function(e,t){e||r(null,t)})}function o(e,t,r){if(r&&"function"==typeof r)if(""!=t){w.message="Making CORS Request";var n=w.server+"/api/player/stats/shots/"+e+"/"+t;b(n,function(e){r&&r(null,e)})}else s(e,"/api/player/stats/shots/",function(e,t){e||r(null,t)})}function s(e,t,r){if("function"==typeof e&&(r=e,e=void 0),"string"!=typeof e&&(e=void 0),"function"!=typeof r&&(r=void 0),e){w.message="Making CORS Request";var n=w.server+t+e;b(n,function(e){r&&r(null,e)})}}function l(e,t){var r=w.server+"/api/matches/stats/player/"+e;b(r,function(e){t&&t(null,e)})}function c(e,t,r,n){var a=w.server+"/api/codes/"+e+"/"+t+"/"+r;b(a,function(e){n&&n(null,e)})}function u(e,t,r){var n=w.server+"/api/matches/"+e;b(n,function(e){w.playerRecord=e,r&&r(null,w.playerRecord)})}function d(e,t,r){var n=w.server+"/api/matches/codes/"+e;b(n,function(e){w.playerRecord=e,r&&r(null,w.playerRecord)})}function p(e,t,r){var n=w.server+"/api/matches/codes/limit/"+e+"/"+t;b(n,function(e){w.playerRecord=e,r&&r(null,w.playerRecord)})}function f(e,t){if("function"==typeof e&&(t=e,e=void 0),"string"!=typeof e&&(e=void 0),"function"!=typeof t&&(t=void 0),e){w.message="Making CORS Request";var r=w.server+"/api/match/stats/"+e;b(r,function(e){w.matches=e,t&&t(null,w.matches)})}}function h(e,t){if("function"==typeof e&&(t=e,e=void 0),"string"!=typeof e&&(e=void 0),"function"!=typeof t&&(t=void 0),e){w.message="Making CORS Request";var r=w.server+"/api/player/stats/"+e;b(r,function(e){w.matches=e,t&&t(null,w.matches)})}}function m(e,t){var r={data:null,context:e,error:null};w.message="Making CORS Request";var n=w.server+"/api/match/"+e.type+"/"+e.identifier;b(n,function(e){e.error?r.error=e.error:r.data=e.data,t&&t(r)})}function v(e,t){if("function"==typeof e&&(t=e,e=void 0),"string"!=typeof e&&(e=void 0),"function"!=typeof t&&(t=void 0),e){w.message="Making CORS Request";var r=w.server+"/api/match/stats/"+e;b(r,function(e){w.stats=e,t&&t(null,w.stats)})}}function g(e,t){"function"!=typeof t&&(t=void 0);var r=w.server+"/api/match/save/"+e;x(r,function(e){w.result=e,t&&t(null,w.result)})}function y(e,t){var r=new XMLHttpRequest;return"withCredentials"in r?r.open(e,t,!0):"undefined"!=typeof XDomainRequest?(r=new XDomainRequest,r.open(e,t)):r=null,r}function x(e,t){var r=y("POST",e);return r?(r.onload=function(){var e=r.responseText,n=JSON.parse(e);w.message="JSON Received",t&&t(n)},r.onerror=function(){w.message="Request Unsuccessful"},void r.send()):void(w.message="CORS not supported")}function b(e,t){var r=y("GET",e);return r?(r.onload=function(){var e=r.responseText,n=JSON.parse(e);w.message="JSON Received",t&&t(n)},r.onerror=function(){w.message="Request Unsuccessful"},void r.send()):void(w.message="CORS not supported")}var w={desc:"Tennis AiP Cors Library",server:"http://tennisvisuals.com",version:"0.4",nolog:!1,message:"",match:{},playerRecord:{}};w.server=location.origin,"localhost"!=location.hostname&&location.hostname?(console.log("setting aip.server to",location.origin),w.server=location.origin):console.log("Using Local Server",location.origin);var _=function(){for(var e={},t=window.location.search.substring(1),r=t.split("&"),n=0;n<r.length;n++){var a=r[n].split("=");if("undefined"==typeof e[a[0]])e[a[0]]=a[1];else if("string"==typeof e[a[0]]){var i=[e[a[0]],a[1]];e[a[0]]=i}else e[a[0]].push(a[1])}return e}();w.QueryString=_;var k=Object.keys(_);w.okeys=k,w.report=function(e,t){urlRequest(location.origin+"/report/"+e,t)},w.shareFile=function(t,r,n,a,i){var o=JSON.stringify({data:t,action:"save",destination:r,filename:n,filetype:a});e("/api/match/push",o,"POST",i)},k.length&&k.indexOf("nolog")>=0&&(w.nolog=!0),w.requestUrl=function(t,r){var n=JSON.stringify({url:t});e("/api/match/request",n,"POST",r)},w.sendReport=t,w.playerBio=r,w.findOrgStats=n,w.playerStatsPointsToSet=a,w.playerStatsOverview=i,w.playerStatsShots=o,w.getPlayerStats=l,w.getPlayerTourneyMatches=c,w.findPlayerMatches=u,w.findPlayerCodes=d,w.limitPlayerCodes=p,w.matchStats=f,w.playerStats=h,w.loadMatch=m,w.loadStats=v,w.saveFile=g,"function"==typeof define&&define.amd?define(w):"object"==typeof module&&module.exports&&(module.exports=w),this.aip=w}(),!function(){function e(){function e(){}function t(e,r){if(e&&r)for(var n=Object.keys(e),a=Object.keys(r),i=0;i<n.length;i++)if(a.indexOf(n[i])>=0){var o=r[n[i]],s=e[n[i]];"object"==typeof o&&"function"!=typeof s&&o.constructor!==Array?t(e[n[i]],r[n[i]]):r[n[i]]=e[n[i]]}}function r(e){return m.indexOf(e)>=0||2==e.split("-").filter(function(e){return e.indexOf("T")>=0}).length}function n(){function t(t){if(g[t]){var r,n=g[t].score,i=e.teams();if(g[t].score.indexOf("T")>=0){var o=g[t].score.split("-").map(function(e){return parseInt(e.replace("T",""))});if(Math.max.apply(null,o)>=+v.set.tiebreak_to&&Math.abs(o[0]-o[1])>1){var s=x[g[t].game];n="",r=Number(Math.min.apply(null,o))}else var s=x[g[t].game-1]}else if(g[t].score.indexOf("G")>=0){var s=x[g[t].game];n=""}else var s=x[g[t].game-1];var l=void 0==s?void 0:s.score[0]>s.score[1]?0:s.score[1]>s.score[0]?1:void 0,c=void 0==s?"0-0":s.score[0]+"-"+s.score[1],d=void 0==l?a(u.players[0].name.split(" "))+"/"+a(u.players[1].name.split(" ")):i[l];void 0!=r&&(c=c+"("+r+")");var p=!1;if(s){var f=v.set.games/2;v.set.tiebreak?(s.score[0]!=f+1&&s.score[1]!=f+1||(p=!0),s.score[0]==f&&s.score[1]<f-1&&(p=!0),s.score[1]==f&&s.score[0]<f-1&&(p=!0)):(s.score[0]>=f||s.score[1]>=f)&&Math.abs(s.score[0]-s.score[1])>=2&&(p=!0)}else s={score:[0,0]};return v.set.tiebreak_only&&(s.score=o),{point_score:n,game_score:c,legend:d,leader:l,games:s.score,tiebreak:r,complete:p}}}function r(){var e=t(g.length-1),r=!!e&&(v.set.tiebreak&&e.games[0]==v.set.games/2&&e.games[1]==v.set.games/2);return!!r}function n(e){var t=g.length?g[g.length-1].score:"0-0";if(t=t.indexOf("G")>=0?"0-0":t,e.indexOf("T")>=0){var r=c(e);if(r&&"0-0"==t)return 1==r[0]?0:1;var n=c(t);return r[0]!=n[0]?0:1}return v.set.advantage||"40-40"!=t?w[t].indexOf(e):_[t].indexOf(e)}function i(e){function t(){"0-0"==r&&(r="0T-0T");var t=r.split("-");return t[e]=parseInt(t[e].replace("T",""))+1+"T",t.join("-")}var r=g.length?g[g.length-1].score:"0-0";r=r.indexOf("G")>=0?"0-0":r;var n=g.length?g.map(function(e){return e.score.indexOf("G")>=0?1:0}).reduce(function(e,t){return e+t}):0;return v.set.tiebreak_only?t():n<v.set.games||!v.set.tiebreak?o(r,e):t()}function o(e,t){return v.set.advantage||"40-40"!=e?w[e][t]:_[e][t]}function s(e){if(y[0].length&&(0==a(y[0]).pts||0==a(y[1]).pts))return{result:!1,status:"eos"};var t,r=h(),o=function(){var e=this.serves&&this.serves[0]?this.serves[0].indexOf("#")>0||this.serves[0].indexOf("*")>0:0,t=this.rally?this.rally.length:0;return t+=t>0||e?1:0},s={set:v.id,rallyLength:o};if("01SAQDRP".split("").indexOf(String(e))>=0)return t=e,["S","A","Q"].indexOf(e)>=0&&(t=r),["D","R","P"].indexOf(e)>=0&&(t=1-r),["Q","P"].indexOf(e)>=0&&(s.result="Penalty"),"A"==e&&(s.result="Ace"),"D"==e&&(s.result="Double Fault"),s.score=i(t),s.winner=parseInt(t),"01".indexOf(e)>=0?s.code=r==s.winner?"S":"R":s.code=e,g.push(s),{result:!0,point:s};if("object"==typeof e&&(e.score||"01SAQDRP".split("").indexOf(String(e.winner))>=0)){if(e.score){var c=l(e.score);if(!c)return{result:!1,error:"sequence",score:e.score};var u=n(c);if(e.winner&&e.winner!=u)return{result:!1,error:"winner mismatch"};e.winner=u,e.score=c}else["S","A","Q"].indexOf(e.winner)>=0&&(e.winner=r),["D","R","P"].indexOf(e.winner)>=0&&(e.winner=1-r),["Q","P"].indexOf(e.winner)>=0&&(s.result="Penalty"),"A"==e.winner&&(s.result="Ace"),"D"==e.winner&&(s.result="Double Fault"),e.score=i(e.winner),e.winner=parseInt(e.winner),void 0==e.code&&("01".indexOf(e.winner)>=0?e.code=r==e.winner?"S":"R":"SAQDRP".indexOf(e.winner)>=0&&(e.code=e.winner));return e.set=v.id,e.rallyLength=o,g.push(e),{result:!0,point:e}}var c=l(e);return c?(s.winner=n(c),s.score=c,g.push(s),{result:!0,point:s}):{result:!1,error:"invalid point",value:e}}function l(e){function t(e){if("0-0"==a&&["1T-0T","0T-1T"].indexOf(e)>=0)return!0;var t=c(e),r=c(a);if(!t||!r)return!1;var n=t.reduce(function(e,t){return e+t})==r.reduce(function(e,t){return e+t})+1;return n&&(t[0]==r[0]||t[1]==r[1])}if("object"==typeof e)return!1;e=e.replace(":","-").split("-").map(function(e){return e.trim()}).join("-");var n=g.length?g[g.length-1]:{score:"0-0"},a="object"==typeof n?n.score:n;a=a.indexOf("G")>=0?"0-0":a;var i=r(),o=w[a]&&w[a].indexOf(e)>=0;if(e.indexOf("T")>=0&&v.set.tiebreak&&b.games().length>=v.set.games)return!!t(e)&&e;if(i&&!o){if(e.indexOf("G")>=0){var s=e.split("-"),l=s.indexOf("G"),u=a.split("-")[l].replace("T","");s[l]=parseInt(u)+1,e=s.join("-")}var d=e.split("-").map(function(e){return e+"T"}).join("-");return!!t(d)&&d}return(void 0==a||a.indexOf("G")>=0||a.indexOf("T")>=0)&&(a="0-0"),!!o&&e}function c(e){var t=e.split("-").map(function(e){return"T"==e[e.length-1]?1:0}).reduce(function(e,t){return e+t});return 2==t&&e.split("T").join("").split("-").map(function(e){return parseInt(e)})}function d(){function e(){return v.set.advantage?new_game=Math.abs(l[0]-l[1])==f:new_game=s[0]==f||s[1]==f}if(x=[],g.length){for(var t=v.set.games/2*4,r=[{pts:t}],n=[{pts:t}],a=void 0,i=void 0,o=[0,0],s=[0,0],l=[0,0],c=0,u=0,d=[0,0],f=v.set.tiebreak_only?+v.set.tiebreak_to:4,h=v.set.tiebreak_only,m=0;m<g.length;m++){var a="object"==typeof g[m]?String(g[m].winner):String(g[m]);if(!(""==a||"01SAQDRP".split("").indexOf(a)<0)){var b={0:0,1:0};e()&&(i&&(d[i]+=1,o[i]+=f),x.push({range:[u,m-1],winner:i,score:d.slice(),tiebreak:h}),u=m,c+=1,d[0]==d[1]&&(d[0]==(v.set.games-2)/2?(o[0]-=f,o[1]-=f):d[0]==v.set.games/2&&v.set.tiebreak?(h=!0,f=+v.set.tiebreak_to,o[0]-=3,o[1]-=3):h=!1),d[0]+d[1]>=v.set.games&&!v.set.tiebreak&&d[0]==d[1]&&(o[0]-=f,o[1]-=f),s=[0,0],l=[0,0]);var w=(parseInt(v.set.first_service)+c)%2;if(h)var _=m-u,w=(_+1)%4<2?w:1-w;["S","A","Q"].indexOf(a)>=0&&(a=w),["D","R","P"].indexOf(a)>=0&&(a=1-w),i=a,s[a]+=1,v.set.advantage?Math.abs(s[0]+s[1]<2*f-2)?(l[0]=s[1]==f?0:s[0],l[1]=s[0]==f?0:s[1],s[0]==f-1?b[1]=1:s[0]==f-1&&(b[0]=1)):s[0]==s[1]?(l[0]=f-2,l[1]=f-2):s[0]>s[1]?s[0]==s[1]+2?(l[0]=f,l[1]=0):(l[0]=f-1,l[1]=f-3):s[1]==s[0]+2?(l[1]=f,l[0]=0):(l[1]=f-1,l[0]=f-3):(l[0]=s[1]==f?0:s[0],l[1]=s[0]==f?0:s[1]);var k=t-(o[0]+l[0]),S=t-(o[1]+l[1]);r.push({pts:k+b[0]}),n.push({pts:S+b[1]}),g[m].server=w,p(m),g[m].game=c}}e()&&(d[a]+=1),x.push({range:[u,m-1],winner:a,score:d.slice(),tiebreak:h}),y=[r,n]}}function p(e){var t=g[e].score,r=g[e].server;w[t]&&(w[t][0].indexOf("G")>=0?1==r?g[e].breakpoint=0:g[e].gamepoint=0:w[t][1].indexOf("G")>=0&&(0==r?g[e].breakpoint=1:g[e].gamepoint=1))}function f(){v.set.games%2!=0&&(v.set.games=12)}function h(){var e=a(b.points());if(e){var t=e.game;e.score.indexOf("G")>=0&&(t+=1)}else{if(!v.set.tiebreak_only)return v.set.first_service;e={game:0,score:"0T-0T"};var t=0}var r=!!(v.set.tiebreak_only||e.score.indexOf("T")>=0),n=(parseInt(v.set.first_service)+t)%2;if(r){var i=e.score.split("T").join("").split("-"),o=i.reduce(function(e,t){return parseInt(e)+parseInt(t)}),n=(o+1)%4<2?n:1-n;Math.abs(i[0]-i[1])>=2&&(i[0]>=+v.set.tiebreak_to||i[1]>=+v.set.tiebreak_to)&&(t=e.game+1,n=(parseInt(v.set.first_service)+t)%2)}return n}function m(){v={id:0,players:{0:"Player One",1:"Player Two"},set:{games:12,advantage:!0,tiebreak:!0,tiebreak_at:6,tiebreak_to:7,tiebreak_only:!1,first_service:void 0}}}var v,g=[],y=[[],[]],x=[];m();var b={};b.options=function(e){if(!arguments.length)return v;for(var t=Object.keys(e),r=Object.keys(v),n=0;n<t.length;n++)if(r.indexOf(t[n])>=0)if("object"==typeof v[t[n]])for(var a=Object.keys(e[t[n]]),i=Object.keys(v[t[n]]),o=0;o<a.length;o++)i.indexOf(a[o])>=0&&(v[t[n]][a[o]]=e[t[n]][a[o]]);else v[t[n]]=e[t[n]];return f(),b},b.nextService=h,b.events=function(e){if(!arguments.length)return events;for(var t=Object.keys(e),r=Object.keys(events),n=0;n<t.length;n++)r.indexOf(t[n])>=0&&(events[t[n]]=e[t[n]]);return b},b.points=function(e){return arguments.length?(g=[],y=[[],[]],x=[],b.push(e)):g},b.score=function(e){return arguments.length?e<g.length&&t(e):t(g.length-1)},b.games=function(){return x},b.player_data=function(){return y},b.push=function(e){if(!arguments.length)return console.log("no argument given"),!1;var t=JSON.parse(JSON.stringify(e));if(t.constructor===Array)for(var r=0;r<t.length;r++){var n=s(t[r]);if(d(),!n.result){n.remnant=t.slice(r);break}}else{var n=s(t);d()}return n},b.pop=function(){var e=g.pop();return g.length?d():b.reset(),e},b.reset=function(){g=[],y=[[],[]],x=[],d()},b.players=function(e,t){return arguments.length?("string"==typeof e&&(u.players[0].name=e),"string"==typeof t&&(u.players[1].name=t),b):[u.players[0].name,u.players[1].name]},b.decoratePoint=function(e,t){var r=0;if(t.score&&g[e].score&&t.score!=g[e].score)return!1;for(var n=Object.keys(t),a=0;a<n.length;a++)g[e][n[a]]=t[n[a]],r+=1;return r};var w={"0-0":["15-0","0-15"],"0-15":["15-15","0-30"],"0-30":["15-30","0-40"],"0-40":["15-40","0-G"],"15-0":["30-0","15-15"],"15-15":["30-15","15-30"],"15-30":["30-30","15-40"],"15-40":["30-40","15-G"],"30-0":["40-0","30-15"],"30-15":["40-15","30-30"],"30-30":["40-30","30-40"],"30-40":["40-40","30-G"],"40-0":["G-0","40-15"],"40-15":["G-15","40-30"],"40-30":["G-30","40-40"],"40-40":["A-40","40-A"],"A-40":["G-40","40-40"],"40-A":["40-40","40-G"]},_={"40-40":["G-40","40-G"]};return b}function i(){u={players:{0:{name:"Player One",puid:"",fh:"",seed:"",rank:"",age:"",entry:"",ioc:""},1:{name:"Player Two",puid:"",fh:"",seed:"",rank:"",age:"",entry:"",ioc:""},2:{name:"",puid:"",fh:"",seed:"",rank:"",age:"",entry:"",ioc:""},3:{name:"",puid:"",fh:"",seed:"",rank:"",age:"",entry:"",ioc:""}},tournament:{tuid:"",name:"",tour:"",rank:"",surface:"",draw:"",round:""},match:{date:"",year:"",category:"",court:"",start_time:"",end_time:"",duration:"",status:"",winner:"",in_out:"",umpire:""},charter:""}}function s(){l={id:0,match:{sets:3,description:void 0,final_set_tiebreak:!0,final_set_tiebreak_to:7,final_set_tiebreak_only:!1,first_service:0},set:{games:12,advantage:!0,lets:!0,tiebreak:!0,tiebreak_at:6,tiebreak_to:7}}}var l;s();var u;i();for(var d=[],p=[],f=0;f<5;f++){var h=n();h.options({id:f}),p.push(h)}p[0].options({set:{first_service:l.match.first_service}}),e.type="UMO",e.metadata=function(r){return arguments.length?(t(r,u),p.forEach(function(e){e.options({players:[u.players[0].name,u.players[1].name,u.players[2].name,u.players[3].name]})}),e):u},e.options=function(r){return arguments.length?(t(r,l),l.set.games%2!=0&&(l.set.games=12),l.match.first_service!=p[0].options().set.first_service&&p.forEach(function(e){var t=e.options().set.first_service;e.options({set:{first_service:1-t}})}),p.forEach(function(e,t){if(e.options({set:l.set,points:l.points}),t+1==l.match.sets&&(t+1)%2){var r={set:{tiebreak:l.match.final_set_tiebreak,tiebreak_to:l.match.final_set_tiebreak_to,tiebreak_only:l.match.final_set_tiebreak_only}};e.options(r)}else{var r={set:{tiebreak:l.set.tiebreak,tiebreak_to:l.set.tiebreak_to,tiebreak_only:!1}};e.options(r)}}),e):l},e.points=function(t){if(!arguments.length){for(var r=[],n=0;n<l.match.sets;n++)r=r.concat(p[n].points());return r}for(var a=0,i=l.match.first_service,n=0;n<5;n++)if(t.length){var o={set:{first_service:(i+a)%2}};p[n].options(o);var s=p[n].points(t),i=p[n].options().set.first_service,a=p[n].games();a=a?a.length:0,s.result?t=[]:s.remnant&&(t=s.remnant)}else p[n].reset();e.update()},e.winProgression=function(){var t=e.points(),r="";return t.forEach(function(e){r+=e.winner}),r},e.gameProgression=function(){var t=e.points(),r="";return t.forEach(function(e){if(e.score.indexOf("G")>=0&&(r+=e.winner),e.score.indexOf("T")){var t=e.score.split("T").join("").split("-");Math.abs(t[0]-t[0])>=2&&(t[0]>=l.set.tiebreak_to||t[1]>=l.set.tiebreak_to)&&(r+=e.winner)}}),r},e.push=function(t){for(var r=0,n=l.match.first_service,a=0;a<l.match.sets;a++){var i=p[a].push(t);if(i.error)return i;if(i.result){e.update();break}if(i.remnant&&(t=i.remnant),e.score().winner)break;if("eos"==i.status){n=p[a].options().set.first_service,r=p[a].games(),r=r?r.length:0;var o={set:{first_service:(n+r)%2}};p[a+1]&&p[a+1].options(o)}}return i},e.pop=function(){for(var t=void 0,r=l.match.sets-1;r>=0;r--)if(t=p[r].pop(),void 0!=t){d.push(t);break}return e.update(),t},e.redo=function(){if(!d.length)return!1;var t=d.pop(),r=e.push(t);return r},e.reset=function(){d=[],p.forEach(function(e){e.reset()}),s(),i(),e.update();
},e.update=function(){o.length&&o.forEach(function(e){"function"==typeof e&&e()})},e.callback=function(e){return arguments.length?void("function"==typeof e?o.push(e):"array"==typeof e&&e.foreach(c)(function(e){"function"==typeof e&&o.push(e)})):o},e.teams=function(){var e=[],t=[0,1,2,3].map(function(e){return u.players[e].name}).filter(function(e){return e?e.length:0});return t.length>2?(e.push(a(t[0].split(" "))+" / "+a(t[2].split(" "))),e.push(a(t[1].split(" "))+" / "+a(t[3].split(" ")))):e=[t[0],t[1]],e},e.players=function(t,r,n,a){return arguments.length?("string"==typeof t&&(u.players[0].name=t),"string"==typeof r&&(u.players[1].name=r),"string"==typeof n&&(u.players[2].name=r),"string"==typeof a&&(u.players[3].name=r),"string"==typeof t&&"string"==typeof r&&p.forEach(function(e){e.players(t,r)}),e.update(),e):[u.players[0].name,u.players[1].name]},e.score=function(){for(var e=[],t=[0,0],r=0;r<5;r++){var n=p[r].score();n&&(e.push(n),n.complete&&(t[n.leader]+=1))}var a="",i="",o="";if(t[0]>l.match.sets/2||t[1]>l.match.sets/2){var s=t[0]>t[1]?0:1;i=u.players[s].name,o=u.players[1-s].name}for(var r=0;r<e.length;r++)a+=e[r].game_score,r<e.length-1&&(a+=", ");var c=e.length?e[e.length-1].point_score:"";return{sets:e,match_score:a,winner:i,loser:o,score:t,point_score:c}},e.sets=function(){return p.slice(0,l.match.sets)},e.rr=function(){var t=e.points(),r=["Ace","Winner","Serve Winner","Forced Error","Unforced Error","Double Fault","Penalty"];t.forEach(function(e){var t=Math.floor(25*Math.random())+1;e.rally=new Array(t);var n=Math.floor(7*Math.random())+1;e.result=r[n-1]})},e.rallies=function(){return e.points().map(function(e){if(e.rally&&e.rally.length)return e.rally.length}).filter(function(e){return e})},e.nextService=function(){var t=e.score().sets.length;return 0==t?l.match.first_service:p[t-1].nextService()};var m=["0-15","0-30","0-40","0-G","15-0","15-15","15-30","15-40","15-G","30-0","30-15","30-30","30-40","30-G","40-0","G-0","40-15","G-15","40-30","G-30","40-40","40-A","40-G","A-40","G-40"];return e.decoratePoint=function(e,t){if(!t||"object"!=typeof t||!Object.keys(t).length)return!1;for(var r=0;r<p.length;r++){var n=p[r].points().length;if(!(e+1>n))break;e-=n}return r!=p.length&&p[r].decoratePoint(e,t)},e.pointIndex=function(t,n,a){if(t<0||t>l.match.sets||n<0)return!1;var i=e.points().map(function(e){return e.set==t?e:void 0}),o=i.map(function(e){return e&&e.game==n?e:void 0});if(a&&r(a))for(var s=o.map(function(e){return e&&e.score==a?e:void 0}),c=0;c<s.length;c++)if(void 0!=s[c])return c;if(!a)for(var c=0;c<o.length;c++)if(void 0!=o[c])return c;return!1},e.findPoint=function(e,t,n,a){if(e<0||e>l.match.sets||t<0||!n||!r(n))return!1;var i=p[e].points().filter(function(e){return e.game==t}),o=i.filter(function(e){return e.score==n});return!o.length&&a&&(o=i.filter(function(e){return e.score==n.split("-").reverse().join("-")})),!!o.length&&o[0]},e}function t(t){Array.isArray(t)&&(t=t.join("")),t.indexOf(",")>0&&(t=t.split(",").join("")),t.indexOf(";")>0&&(t=t.split(";").join(""));var r=e();return r.options({set:{first_service:0}}),r.points(t.split("")),a(r.points()).score.indexOf("G")>=0&&{wp:r.winProgression(),gp:r.gameProgression(),score:r.score().match_score}}function r(r){var a=[];if(r.indexOf(".")>=0)return a.push("More than one set submitted"),!1;var i=!0;if(r.indexOf(";")>0)for(var o=r.split(";"),s=0;s<o.length;s++)o[s].indexOf("/")<0?t(o[s])||(i=!1,a.push("Game "+s+" is invalid: "+o[s])):n(o[s])||(i=!1,a.push("Game "+s+" is an invalid tiebreak: "+o[s]));r=r.split("/").join(""),r=r.split(";").join(""),r=r.split(",").join("");try{var l=e();l.options({set:{first_service:0}}),l.points(r.split(""));var c=l.score();1==c.sets.length&&c.sets[0].complete||(i=!1)}catch(e){console.log("invalid characters in set string"),i=!1}return i?{wp:l.winProgression(),gp:l.gameProgression(),score:l.score().match_score}:{errors:a}}function n(t){var r=e();r.options({set:{first_service:0}}),r.push("000011110000111100001111000011110000111100001111".split("")),t=t.split("/").join(""),t=t.split(",").join(""),r.push(t.split(""));var n=r.score();return!(1!=n.sets.length||!n.sets[0].complete)}function a(e){return e[e.length-1]}var i={},o=[];i.matchObject=e,i.validGames=t,i.validSet=r,i.validTiebreak=n,"function"==typeof define&&define.amd?define(i):"object"==typeof module&&module.exports&&(module.exports=i),this.mo=i}(),!function(){function e(e){var n=[0,0];if(e.length>1&&!e[0]&&(e=[e[1]]),e[0])for(;"c"==e[0][0];)n[0]+=1,e[0]=e[0].slice(1);if(e[1])for(;"c"==e[1][0];)n[1]+=1,e[1]=e[1].slice(1);var a=(e.join("|"),r(e[0],1));return n[0]&&(a.lets=a.lets?a.lets+n[0]:n[0]),"S"!=a.winner&&e[1]?(s2result=r(e[1],2),n[1]&&(s2result.lets=s2result.lets?s2result.lets+n[1]:n[1]),s2result.serve=2,s2result.first_serve={serves:a.serves},a.lets&&(s2result.first_serve.lets=a.lets),a.error&&(s2result.first_serve.error=a.error),a.parse_notes&&(s2result.first_serve.parse_notes=a.parse_notes),s2result.code=t(e,s2result),s2result):(a.serve=1,a.code=t(e,a),a)}function t(e,t){var r=t.first_serve?t.first_serve.serves.join("")+"|":"";return r+=t.serves&&t.serves.length?t.serves.join(""):t.winner?t.winner:"",t.rally&&t.rally.length&&(r+=t.rally.join("")),r}function r(e,t){var r=a(e);if(!r)return"";var i=function(){var e=this.serves&&this.serves[0]?this.serves[0].indexOf("#")>0||this.serves[0].indexOf("*")>0:0,t=this.rally?this.rally.length:0;return t+=t>0||e?1:0};if(r.rallyLength=i,["A","Q","S"].indexOf(r.result)>=0)return r.winner="S",r;if(["D","P","R"].indexOf(r.result)>=0)return r.winner="R",r;if(!r.terminator&&!h(r.serves[0])&&r.serves.length>2)return r.winner="R",r;var o=r.serves.length+r.rally.length<1?"":(r.serves.length-r.lets+r.rally.length)%2==0?"R":"S",s=r.rally.length?r.rally[r.rally.length-1]:r.serves[r.serves.length-1];return s?r.rally.length?(s.indexOf("#")>=0?(r.result="Forced Error",r.error=n(s),h(r.serves[0])?r.winner="S":r.winner="R"==o?"S":"R"):s.indexOf("*")>=0?(r.result="Winner",r.winner=o):s.indexOf("@")>=0?(r.result="Unforced Error",r.error=n(s),h(r.serves[0])?r.winner="R":r.winner="R"==o?"S":"R"):h(r.serves[0])?1==r.rally.length&&h(s)&&(r.error=n(s),r.winner="R"==o?"S":"R"):r.serves.length&&r.rally.length?(r.parse_notes="no terminator: receiver wins point",r.result="Unknown",r.winner="R"):1==r.rally.length&&h(s)&&(r.error=n(s),r.winner="R"==o?"S":"R"),r):("*"==r.terminator?(r.result="Ace",r.winner="S"):"#"==r.terminator?(r.result="Serve Winner",r.winner="S"):h(r.serves[0])?(r.error=n(r.serves[0]),2==t&&(r.result="Double Fault",r.winner="R")):(r.parse_notes="treated as a fault",2==t&&(r.result="Double Fault",r.winner="R")),r):{continue:!0,lets:r.lets}}function n(e){var t={n:"Net",w:"Out Wide",d:"Out Long",x:"Out Wide and Long",g:"Foot Fault",e:"Unknown","!":"Shank"},r=h(e);if(r)return t[r]}function a(e){if(e){var t,r,n,a=e.split("c").length-1;e=e.split("c").join("");for(var i=y(e),o=i,s=i.length-1;s>=0;s--)if(r=v(i[s])){o=i.slice(0,s+1),n=i.slice(s+1),t=i[s];break}var l=g(o),c=l.length?o.slice(l.length):o;!r&&!l.length&&1==c.length&&["A","D","S","P","Q","R"].indexOf(c[0])>=0&&(t=c[0],c=[]);var u={serves:l,rally:c};return u.lets=a||0,r&&(u.terminator=r),t&&("A"==t?(u.result="Ace",u.terminator="*",u.serves=["0*"],u.winner="S"):"D"==t?(u.result="Double Fault",u.first_serve={serves:["0e"],lets:0},u.serves=["0e"],u.winner="R"):u.result=t),n&&n.length&&(u.ignored=n),u}}function i(e){if(!e)return!1;if(e.serves&&e.rally){if(e.code)var t=e.code.split("|").join("");else if(e.serves.length||e.rally.length)var t=e.serves.join("")+e.rally.join("")}else{if(!e.code)return!1;var t=e.code.split("|").join("")}return s(t,e.score)}function o(e,t){var r=["Ace","Winner","Serve Winner"],n=["Forced Error","Unforced Error","Double Fault","Penalty"],a="";if(void 0!=t&&e.result){if(r.indexOf(e.result)>=0){var i="Ace"==e.result?"an":"a";a+=t[e.winner]+" won the point with "+i+" "+e.result}else n.indexOf(e.result)>=0?a+=t[1-e.winner]+" lost the point with a "+e.result:e.parse_notes&&(a+="Point assigned to "+t[e.winner]+" ("+e.parse_notes+")");return"function"==typeof e.rallyLength&&(a+=". Rally: "+e.rallyLength()),a}return void 0!=e.winner?a+=t[e.winner]+" won the point":e.code?M.describePoint(e):"&nbsp;"}function s(e,t){var r=[],n=y(e),a=0,i=0;return t&&(E.indexOf(t)>=0?(a=1,i=1):C.indexOf(t)>=0&&(a=3,i=3)),n.forEach(function(e){var n=c(e,t,i,a);r.push(n.sequence),i=n.direction}),r}function l(e,t){var r=[],n=y(e),a=0,i=0;return t&&(E.indexOf(t)>=0?(a=1,i=1):C.indexOf(t)>=0&&(a=3,i=3)),n.forEach(function(e){var n=c(e,t,i,a);r.push(n.attributes),i=n.direction}),r}function c(e,t,r,n){var a={S:"Server won the point",P:"Penalty against Server",Q:"Penalty against Receiver",R:"Receiver won the point",A:"Server won the point with an Ace",D:"Server lost the point with a Double Fault"},i={n:"Netted",w:"Out Wide",d:"Out Long",x:"Out Wide and Long",g:"Foot Fault",e:"Unknown Error","!":"Shank"},o={0:"Unknown Serve",4:"Wide Serve",5:"Body Serve",6:"T Serve"},s={f:"Forehand",r:"Forehand Slice",v:"Forehand Volley",o:"Overhead Smash",u:"Forehand Drop Shot",l:"Forehand Lob",h:"Forehand Half-volley",j:"Forehand Drive Volley"},l={b:"Backhand",s:"Backhand Slice",z:"Backhand Volley",p:"Backhand Overhead Smash",y:"Backhand Drop Shot",m:"Backhand Lob",i:"Backhand Half-volley",k:"Backhand Drive Volley"},c={t:"Trick Shot",q:"Unknown Shot"},m={1:"to Right Hander Forehand",2:"Down the Middle",3:"to Right Hander Backhand"},g={7:"(shallow)",8:"(deep)",9:"(very deep)"},y={"*":"Winner","#":"Forced Error","@":"Unforced Error"},x={"+":"approach shot","-":"at the Net","=":"at the Baseline"},b={";":"(net cord)",c:"(Let)"},w={};Object.keys(s).forEach(function(e){w[e]=s[e]}),Object.keys(l).forEach(function(e){w[e]=l[e]}),Object.keys(c).forEach(function(e){w[e]=c[e]});var _={};Object.keys(i).forEach(function(e){_[e]=i[e]}),Object.keys(o).forEach(function(e){_[e]=o[e]}),Object.keys(w).forEach(function(e){_[e]=w[e]}),Object.keys(m).forEach(function(e){_[e]=m[e]}),Object.keys(g).forEach(function(e){_[e]=g[e]}),Object.keys(y).forEach(function(e){_[e]=y[e]}),Object.keys(x).forEach(function(e){_[e]=x[e]}),Object.keys(b).forEach(function(e){_[e]=b[e]});var k=e.split("").map(function(e){return _[e]?_[e]+", ":""}).join("");k=k.length>2?k.slice(0,k.length-2):"";var S,O,A=e[0],T={Stroke:"Unknown","Stroke Type":"Unknown","End Point":"In",Result:"In",Trajectory:"Unknown"};if(a[A])S=a[A];else if(o[A]){T.Stroke="Serve",S=o[A],e.indexOf("+")>0&&(S+="; net approach");var P=h(e);P&&(T.Result=i[P],S+="; "+i[P]);var R=v(e);R&&("*"==R&&(T.Result="Ace",S+="; Ace"),"#"==R&&(T.Result="Serve Winner",S+="; Serve Winner")),t?6==A?(T.Trajectory="Centerline",O=2):E.indexOf(t)>=0?(T.Trajectory="Left",O=1):C.indexOf(t)>=0&&(T.Trajectory="Right",O=3):O=0}else if(w[A]){var M;if(s[A]){T.Stroke="Forehand";var j=s[A].replace("Forehand","").trim();T["Stroke Type"]=j||"Drive",M="forehand"}if(l[A]){T.Stroke="Backhand";var j=l[A].replace("Backhand","").trim();T["Stroke Type"]=j||"Drive",M="backhand"}S=w[A];var F=d(e);F&&(S+=" "+x[F]);var W=u(e);W&&(S+=" "+b[W]);var O=f(e);O&&(1==O&&1==r||3==O&&3==r?(T.Trajectory="Crosscourt",S+=" crosscourt"):3==O&&1==r||1==O&&3==r?(T.Trajectory="Line",S+=" down the line"):2==O&&2==r?(T.Trajectory="Centerline",S+=" down the middle"):2==O?(T.Trajectory="Middle",S+=" to the middle"):3==O?(T.Trajectory="Right",S+=" to the right side"):1==O&&(T.Trajectory="Left",S+=" to the left side"));var z=p(e),N=z?g[z]:"";N&&(T["End Point"]=N,S+="; "+N);var P=h(e);P&&(T["End Point"]=i[P],S+="; "+i[P]);var R=v(e);R&&(T.Result=y[R],S+="; "+y[R])}else{var P=h(e);P&&(S=i[P])}return{sequence:S,full_sequence:k,direction:O,attributes:T}}function u(e){if(!e)return!1;for(var t=";".split(""),r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return t[r];return!1}function d(e){if(!e)return!1;for(var t="+-=".split(""),r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return t[r];return!1}function p(e){if(!e)return!1;for(var t="789".split(""),r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return t[r];return!1}function f(e){if(!e)return!1;for(var t="123".split(""),r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return t[r];return!1}function h(e){if(!e)return!1;for(var t="nwdxge!".split(""),r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return t[r];return!1}function m(e){if(!e)return!1;for(var t="0456fbrsvzopuylmhijktq".split(""),r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return t[r];return!1}function v(e,t){if(!e)return!1;for(var t=t||["c","#","@","*"],r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return t[r];return!1}function g(e){if(!e)return[];for(var t=[],r="0456cg".split(""),n=0;n<e.length;n++)e[n].length&&r.indexOf(e[n][0])>=0&&t.push(e[n]);return t}function y(e){for(var t="ADSPQRfbrsvzopuylmhijktq",r=t.split(""),n=[],a=!0;a;)e&&"+-=".indexOf(e[0])>=0?e=e.slice(1):a=!1;for(var i,o=e.slice(),s=!1;o.length;){for(var l=1;l<o.length;l++)if("([{".indexOf(o[l])>=0&&(s=!0),")]}".indexOf(o[l])>=0&&(s=!1),!s&&r.indexOf(o[l])>=0){n.push(o.slice(0,l)),i=o.slice(l);break}l==o.length&&(n.push(o.slice(0,l)),i=o.slice(l)),o=i}return n}function x(e,t,r){function n(e,t){var r=!0;return m(t)&&m(e)!=m(t)&&(r=!1),v(t)&&v(e)!=v(t)&&(r=!1),f(t)&&f(e)!=f(t)&&(r=!1),p(t)&&p(e)!=p(t)&&(r=!1),d(t)&&d(e)!=d(t)&&(r=!1),h(t)&&h(e)!=h(t)&&(r=!1),r}for(var a=[],i=0;i<e.length;i++){var o=e[i],s=[];if(o.serves&&s.push(o.serves[o.serves.length-1]),o.rally&&o.rally.length&&o.rally.forEach(function(e){s.push(e)}),!(t.length>s.length)){for(var l=!1,c=0;c<t.length;c++){var u=r?s.length-1-c:c,g=r?t.length-1-c:c,y=s[u],x=t[g];n(y,x)||(l=!0)}l||a.push(o)}}return a}function b(e){if(!e)return{valid:!0,complete:!0,message:""};var t=k(e);return S(e)?t.shots.length&&P(t.shots)?{valid:!1,complete:t.complete,message:"Duplicate Characters"}:t.shots.length&&!O(t.shots,t.lets)?{valid:!1,complete:t.complete,message:"Invalid Service"}:t.shots.length&&T(t.shots)?{valid:!1,complete:t.complete,message:"Terminator Misplaced"}:t.shots.length&&A(t.shots)?{valid:!1,complete:t.complete,message:"Contradictory Terminator"}:{valid:!0,complete:t.complete,lets:t.lets,fault:t.fault,message:t.message}:{valid:!1,complete:t.complete,message:"Invalid Characters"}}function w(e){if(e&&"string"==typeof e)return e.split("").filter(function(e,t,r){return r.lastIndexOf(e)==t}).join("")}function _(e){if(!e)return!1;var t=e?(e.match(/c/g)||[]).length:0;return e.indexOf("c")>=0&&t}function k(e){for(var t=0,r=M.shotSplitter(e);"c"==w(r[0]);)t+=r[0].length,r=r.slice(1);for(;_(r[0]);)t+=1,r=r.slice(1);return r.length>1&&!v(e,["c","@","#","*"])?{shots:r,lets:t,complete:!1,message:"No Terminator"}:1==r.length&&1==r[0].length&&["A","D","S","P","Q","R"].indexOf(r[0])>=0?{shots:r,lets:t,complete:!0,message:""}:v(e,["#","*"])?{shots:r,lets:t,complete:!0,message:""}:r.length>1&&v(e,["@"])?{shots:r,lets:t,complete:!0,message:""}:1!=r.length||v(e,["#","*"])?{shots:r,lets:t,complete:!1,message:""}:{shots:r,lets:t,complete:!0,fault:!0,message:"Service Fault"}}function S(e){for(var t="cADSPQRnwdxge!0456frvoulhjbszpymiktq123789*#@+-=;",r=e.split(""),n=0;n<r.length;n++)if(t.indexOf(r[n])<0)return!1;return!0}function O(e,t){var r=e[0];if("ADSPQR".indexOf(r)>=0&&1==r.length&&1==e.length)return!0;if(!M.findServes(r).length&&!t)return!1;for(var n=1;n<r.length;n++)if("123789".indexOf(r[n])>=0)return!1;for(var a=1;a<e.length;a++){if(M.findServes(e[a]).length)return!1;if(e[a].indexOf("c")>=0)return!1}return!0}function A(e){var t=e[e.length-1];return!!(t.indexOf("*")>=0&&M.shotFault(t))||!!(t.indexOf("c")>=0&&M.shotFault(t))}function T(e){if(e.length<2)return!1;for(var t=0;t<e.length-1;t++){if(M.shotFault(e[t]))return!0;if(M.containsTerminator(e[t]))return!0}return!1}function P(e){for(var t=0;t<e.length;t++){var r=e[t].split("c").join("");if(R(r))return!0}return!1}function R(e){return new Set(e).size!==e.length}var M={};M.stripNonMCP=function(e){return e?(e=e.replace(/ *\([^)]*\) */g,""),e=e.replace(/ *\[[^]]*\] */g,""),e=e.replace(/ *\{[^}]*\} */g,"")):""},M.pointParser=e,M.shotParser=r,M.analyzeSequence=a,M.describePoint=i,M.describeOutcome=o,M.describeSequence=s,M.decipherSequence=l,M.decipherShot=c,M.shotFault=h,M.containsTerminator=v,M.findServes=g,M.shotSplitter=y;var E=["0-15","15-0","15-30","30-15","30-40","40-30","15-G","G-15"],C=["15-15","0-30","30-30","40-40","15-40","40-15","A-40","40-A"];M.findShotPattern=x,M.validator=b,"function"==typeof define&&define.amd?define(M):"object"==typeof module&&module.exports&&(module.exports=M),this.sequences=M}(),!function(){function e(e,t){if(!t)return e;var r=[],n={};if(n["Deuce Court"]=["0-15","15-0","15-30","30-15","30-40","40-30","15-G","G-15"],n["Ad Court"]=["15-15","0-30","30-30","40-40","15-40","40-15","A-40","40-A"],t.scores)if("string"==typeof t.scores&&Object.keys(n).indexOf(t.scores)>=0)var a=n[t.scores];else var a=t.scores;for(var i=("object"==typeof t?Object.keys(t):void 0,0);i<e.length;i++){var o=e[i];a&&a.indexOf(o.score)<0||void 0!=t.server&&o.server!=t.server||void 0!=t.breakpoint&&o.breakpoint!=t.breakpoint||void 0!=t.gamepoint&&o.gamepoint!=t.gamepoint||void 0!=t.game&&o.game!=t.game||void 0!=t.set&&o.set!=t.set||void 0!=t.winner&&o.winner!=t.winner||void 0!=t.result&&o.result!=t.result||void 0!=t.error&&o.error!=t.error||void 0!=t.score&&o.score!=t.score||r.push(e[i])}return r}function t(e){function t(e,t){a[e]?a[e][t]?a[e][t]+=1:a[e][t]=1:(a[e]=[],a[e][t]=1)}for(var r,n,a={TotalPoints:e.length,Breakpoints:[0,0],BreakpointsConverted:[0,0],ServesAce:[0,0],ServesWinners:[0,0],DoubleFaults:[0,0],ServedPoints:[0,0],Serves2nd:[0,0],ServedGames:[0,0],GamepointsConverted:[0,0],ReceivedPoints:[0,0],ReceivedPoints1st:[0,0],ReceivedPoints2nd:[0,0],PointsWonReturn:[0,0],PointsWonReturn1st:[0,0],PointsWonReturn2nd:[0,0],MaxPointsInRow:[0,0],MaxGamesInRow:[0,0],MaxPointsInRow:[0,0],MaxShotsInRally:[0,0],NetPoints:[0,0],NetPointsWon:[0,0]},i={NetPoints:[[],[]]},o=0,u=0,d=0,f=0;f<e.length;f++){var h=e[f],m=s(h),v=l(h);c(h);t("ServedPoints",h.server),t("ReceivedPoints",1-h.server),h.first_serve?(t("Serves2nd",h.server),t("ReceivedPoints2nd",1-h.server)):t("ReceivedPoints1st",1-h.server),t("PointsWon",h.winner),h.server==h.winner&&t("PointsWonServes",h.server),h.server!=h.winner||h.first_serve||t("PointsWonServes1st",h.server),h.server==h.winner&&h.first_serve&&t("PointsWonServes2nd",h.server),h.server==h.winner&&(!h.rally||h.rally&&h.rally.length<=2)&&t("PointsWonServe3Rally",h.server),h.server!=h.winner&&t("PointsWonReturn",1-h.server),h.server==h.winner||h.first_serve||t("PointsWonReturn1st",1-h.server),h.server!=h.winner&&h.first_serve&&t("PointsWonReturn2nd",1-h.server),"Ace"==h.result&&t("ServesAce",h.server),"Serve Winner"==h.result&&t("ServeWinners",h.server),"Double Fault"==h.result&&t("DoubleFaults",h.server),"Forced Error"==h.result&&h.rally&&1==h.rally.length&&t("ServeForcedErrors",h.server),"Winner"==h.result&&t("Winners",h.winner),"Winner"==h.result&&"Forehand"==m&&t("WinnersForehand",h.winner),"Winner"==h.result&&"Backhand"==m&&t("WinnersBackhand",h.winner),"Forced Error"==h.result&&t("ForcedErrors",1-h.winner),"Forced Error"==h.result&&"Forehand"==m&&t("ForcedErrorsForehand",1-h.winner),"Forced Error"==h.result&&"Backhand"==m&&t("ForcedErrorsBackhand",1-h.winner),"Unforced Error"==h.result&&t("UnforcedErrors",1-h.winner),"Unforced Error"==h.result&&"Forehand"==m&&t("UnforcedErrorsForehand",1-h.winner),"Unforced Error"==h.result&&"Backhand"==m&&t("UnforcedErrorsBackhand",1-h.winner),h.first_serve?("Wide"==v.second&&t("ServesWide2nd",h.server),"Body"==v.second&&t("ServesBody2nd",h.server),"T"==v.second&&t("ServesT2nd",h.server),"Ace"==h.result&&t("ServesAce2nd",h.server),"Serve Winner"==h.result&&t("ServeWinners2nd",h.server),"Forced Error"==h.result&&h.rally&&1==h.rally.length&&t("ServeForcedErrors2nd",h.server),h.server==h.winner&&(!h.rally||h.rally&&h.rally.length<=2)&&t("PointsWonServe3Rally2nd",h.server)):("Wide"==v.first&&t("ServesWide1st",h.server),"Body"==v.first&&t("ServesBody1st",h.server),"T"==v.first&&t("ServesT1st",h.server),"Ace"==h.result&&t("ServesAce1st",h.server),"Serve Winner"==h.result&&t("ServeWinners1st",h.server),"Forced Error"==h.result&&h.rally&&1==h.rally.length&&t("ServeForcedErrors1st",h.server),h.server==h.winner&&(!h.rally||h.rally&&h.rally.length<=2)&&t("PointsWonServe3Rally1st",h.server)),h.rally&&h.rally.length&&(1==h.rally.length&&"Unforced Error"!=h.result&&"Forced Error"!=h.result||h.rally.length>1)&&(t("ReturnsInPlay",1-h.server),h.first_serve?t("ReturnsInPlay2nd",1-h.server):t("ReturnsInPlay1st",1-h.server)),void 0!=h.breakpoint&&t("Breakpoints",h.breakpoint),void 0!=h.gamepoint&&t("Gamepoints",h.gamepoint),h.score.indexOf("G")>=0&&h.winner!=h.server&&t("BreakpointsConverted",1-h.server),h.score.indexOf("G")>=0&&h.winner==h.server&&t("GamepointsConverted",h.server),h.score.indexOf("G")>=0&&t("Games",h.winner),h.score.indexOf("G")>=0&&t("ServedGames",h.server),h.score.indexOf("G")>=0&&(h.winner==n||void 0==n?(d+=1,d>a.MaxGamesInRow[h.winner]&&(a.MaxGamesInRow[h.winner]=d)):(d=1,d>a.MaxGamesInRow[h.winner]&&(a.MaxGamesInRow[h.winner]=d)),n=h.winner),h.winner==r||void 0==r?(u+=1,u>a.MaxPointsInRow[h.winner]&&(a.MaxPointsInRow[h.winner]=u)):(u=1,u>a.MaxPointsInRow[h.winner]&&(a.MaxPointsInRow[h.winner]=u)),r=h.winner,h.rally&&h.rally.length&&h.rally.length>o&&(o=h.rally.length,a.MaxShotsInRally[0]=o,a.MaxShotsInRally[1]=o);var g=p(h);g.server&&(a.NetPoints[h.server]+=1,i.NetPoints[h.server].push(h)),g.receiver&&(a.NetPoints[1-h.server]+=1,i.NetPoints[1-h.server].push(h)),g.server&&h.winner==h.server&&(a.NetPointsWon[h.server]+=1),g.receiver&&h.winner!=h.server&&(a.NetPointsWon[1-h.server]+=1)}return a}function r(e){for(var t={0:{},1:{}},r=0;r<2;r++){var n=a(e.ServedPoints,r),s=a(e.Serves2nd,r),l=n-s,c=a(e.ServedPoints,1-r),u=a(e.Serves2nd,1-r),d=n+c;t[r].CombinedServiceTotal=d,t[r].PctPointsWon=o(a(e.PointsWon,r),d),t[r].PctPointsWonService=o(a(e.PointsWonServes,r),a(e.ServedPoints,r)),t[r].PctPointsWonReturn=i(e.PointsWonReturn,e.ReceivedPoints,r),t[r].FirstServesIn=l,t[r].PctServe1stIn=o(l,n),t[r].PctPointsWon1st=o(a(e.PointsWonServes1st,r),l),t[r].PctPointsWonReturn1st=i(e.PointsWonReturn1st,e.ReceivedPoints1st,r),t[r].PctAces=i(e.ServesAce,e.ServedPoints,r),t[r].PctDoubleFaults=i(e.DoubleFaults,e.ServedPoints,r),t[r].PctPointsWon2nd=i(e.PointsWonServes2nd,e.Serves2nd,r),t[r].PctPointsWonReturn2nd=i(e.PointsWonReturn2nd,e.ReceivedPoints2nd,r);var p=a(e.Breakpoints,1-r),f=a(e.BreakpointsConverted,1-r);t[r].BreakpointsSaved=p-f,t[r].BreakpointsFaced=p,t[r].PctBreakpointsSaved=o(p-f,p);var h=a(e.Breakpoints,r),m=a(e.BreakpointsConverted,r);t[r].Breakpoints=h,t[r].BreakpointsConverted=m,t[r].PctBreakpointsConverted=o(m,h);var v=a(e.Winners,r),g=a(e.ServesAce,r),y=a(e.ServeWinners,r);t[r].Winners=v;var x=a(e.UnforcedErrors,r),b=a(e.DoubleFaults,r),w=s-b;t[r].SecondServesIn=w,t[r].PctServe2ndIn=o(w,s),t[r].UnforcedErrors=x+b;var _=a(e.ReturnsInPlay1st,r),k=a(e.ReturnsInPlay2nd,r),S=a(e.DoubleFaults,1-r),O=u-S,A=c-u;t[r].PctReturnsInPlay=o(_+k,A+O),t[r].PctReturnsInPlay1st=o(_,A),t[r].PctReturnsInPlay2nd=o(k,O);var T=a(e.ForcedErrors,1-r),P=g+y+v+T-(b+x),R=o(P,e.TotalPoints);t[r].AggressiveMargin=P,t[r].PctAggressiveMargin=R}return t}function n(e){for(var t={0:{},1:{}},r=0;r<2;r++){t[r].PctServePointsWon=i(e.PointsWonServes,e.ServedPoints,r);var n=a(e.ServedPoints,r),s=a(e.Serves2nd,r),l=n-s;t[r].PctServeAce=o(a(e.ServesAce,r),n),t[r].PctServeAce1st=o(a(e.ServesAce1st,r),l),t[r].PctServeAce2nd=o(a(e.ServesAce2nd,r),s),t[r].PctServeWinners=o(a(e.ServeWinners,r),n),t[r].PctServeWinners1st=o(a(e.ServeWinners1st,r),l),t[r].PctServeWinners2nd=o(a(e.ServeWinners2nd,r),s),t[r].PctServeForcedErrors=o(a(e.ServeForcedErrors,r),n),t[r].PctServeForcedErrors1st=o(a(e.ServeForcedErrors1st,r),l),t[r].PctServeForcedErrors2nd=o(a(e.ServeForcedErrors2nd,r),s),t[r].PctServeWon3Rally=o(a(e.PointsWonServe3Rally,r),n),t[r].PctServeWon3Rally1st=o(a(e.PointsWonServe3Rally1st,r),l),t[r].PctServeWon3Rally2nd=o(a(e.PointsWonServe3Rally2nd,r),s);var c=a(e.ServesWide1st,r),u=a(e.ServesWide2nd,r),d=c+u;t[r].PctServeWide=o(d,n),t[r].PctServeWide1st=o(c,l),t[r].PctServeWide2nd=o(u,s);var p=a(e.ServesBody1st,r),f=a(e.ServesBody2nd,r),h=p+f;t[r].PctServeBody=o(h,n),t[r].PctServeBody1st=o(p,l),t[r].PctServeBody2nd=o(f,s);var m=a(e.ServesT1st,r),v=a(e.ServesT2nd,r),g=m+v;t[r].PctServeT=o(g,n),t[r].PctServeT1st=o(m,l),t[r].PctServeT2nd=o(v,s)}return t}function a(e,t){return e&&e[t]?e[t]:0}function i(e,t,r,n){return e&&t?o(e[r],t[void 0!=n?n:r]):void 0}function o(e,t){return t&&e?parseFloat((e/t*100).toFixed(2)):0}function s(e){function t(e){if(!e)return!1;for(var t="frvoulhj".split(""),r="bszpymik".split(""),n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return"Forehand";for(var n=0;n<r.length;n++)if(e.indexOf(r[n])>=0)return"Backhand";return"Unknown"}if(e)return e.rally?t(e.rally[e.rally.length-1]):"Serve"}function l(e){function t(e){if(!e)return!1;for(var t="0456".split(""),r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return t[r];return 0}if(!e)return!1;var r,n="Unknown",a={0:"Unknown",4:"Wide",5:"Body",6:"T"};if(e.serves&&e.serves.length){var i=t(e.serves[e.serves.length-1]);i&&!e.first_serve?n=a[i]:r=a[i]}if(e.first_serve&&e.first_serve.serves&&e.first_serve.serves.length){var i=t(e.first_serve.serves[e.first_serve.serves.length-1]);i&&(n=a[i])}var o={first:n};return r&&(o.second=r),o}function c(e){}function u(e){var t=f.counters(e),r=f.baseStats(t);return[{M:""},{A:t.ServesAce},{DF:t.DoubleFaults},{SP:t.ServedPoints},{S1In:[t.ServedPoints[0]-t.Serves2nd[0],t.ServedPoints[1]-t.Serves2nd[1]]},{S1PW:t.PointsWonServes1st},{S2PW:t.PointsWonServes2nd},{SG:t.ServedGames},{bpS:[r[0].BreakpointsSaved,r[1].BreakpointsSaved]},{bpF:[r[0].BreakpointsFaced,r[1].BreakpointsFaced]}]}function d(e){var t=[],r=f.counters(e),n=f.baseStats(r);return t.push({name:"Aces",numerator:r.ServesAce,default:"numerator"}),t.push({name:"Double Faults",numerator:r.DoubleFaults,default:"numerator"}),r.PointsWonServes&&r.PointsWonServes1st&&r.PointsWonServes.toString()!=r.PointsWonServes1st.toString()&&(t.push({name:"1st Serve In",numerator:[n[0].FirstServesIn,n[1].FirstServesIn],denominator:r.ServedPoints,pct:[n[0].PctServe1stIn,n[1].PctServe1stIn]}),t.push({name:"1st Serve Points Won",numerator:r.PointsWonServes1st,denominator:[r.ServedPoints[0]-r.Serves2nd[0],r.ServedPoints[1]-r.Serves2nd[1]],pct:[n[0].PctPointsWon1st,n[1].PctPointsWon1st]}),t.push({name:"2nd Serve In",numerator:[n[0].SecondServesIn,n[1].SecondServesIn],denominator:r.Serves2nd,pct:[n[0].PctServe2ndIn,n[1].PctServe2ndIn]}),t.push({name:"2nd Serve Points Won",numerator:r.PointsWonServes2nd,denominator:r.Serves2nd,pct:[n[0].PctPointsWon2nd,n[1].PctPointsWon2nd]})),t.push({name:"Total Points Won",numerator:r.PointsWon,default:"numerator"}),t.push({name:"Returns In Play",numerator:r.ReturnsInPlay,denominator:[r.ServedPoints[1],r.ServedPoints[0]],pct:[n[0].PctReturnsInPlay,n[1].PctReturnsInPlay]}),t.push({name:"Receiving Points Won",numerator:r.PointsWonReturn,denominator:[r.ServedPoints[1],r.ServedPoints[0]],pct:[n[0].PctPointsWonReturn,n[1].PctPointsWonReturn]}),r.PointsWonReturn&&r.PointsWonReturn1st&&r.PointsWonReturn.toString()!=r.PointsWonReturn1st.toString()&&(t.push({name:"Receiving Points Won 1st",numerator:r.PointsWonReturn1st,denominator:r.ReceivedPoints1st,pct:[n[0].PctPointsWonReturn1st,n[1].PctPointsWonReturn1st]}),t.push({name:"Receiving Points Won 2nd",numerator:r.PointsWonReturn2nd,denominator:r.ReceivedPoints2nd,pct:[n[0].PctPointsWonReturn2nd,n[1].PctPointsWonReturn2nd]})),t.push({name:"Break Points Won",numerator:r.BreakpointsConverted,denominator:r.Breakpoints,pct:[n[0].PctBreakpointsConverted,n[1].PctBreakpointsConverted]}),t.push({name:"Break Points Saved",numerator:[n[0].BreakpointsSaved,n[1].BreakpointsSaved],denominator:[n[0].BreakpointsFaced,n[1].BreakpointsFaced],pct:[n[0].PctBreakpointsSaved,n[1].PctBreakpointsSaved]}),t.push({name:"Winners",numerator:[n[0].Winners,n[1].Winners],default:"numerator"}),t.push({name:"Unforced Errors",numerator:r.UnforcedErrors,default:"numerator"}),t.push({name:"Forced Errors",numerator:r.ForcedErrors,default:"numerator"}),t.push({name:"Aggressive Margin",numerator:[n[0].AggressiveMargin,n[1].AggressiveMargin],denominator:[n[0].CombinedServiceTotal,n[1].CombinedServiceTotal],pct:[n[0].PctAggressiveMargin,n[1].PctAggressiveMargin]}),t.push({name:"Service Games Won",numerator:r.GamepointsConverted,denominator:r.ServedGames}),t.push({name:"Service Points Won",numerator:r.PointsWonServes,denominator:r.ServedPoints,pct:[n[0].PctPointsWonService,n[1].PctPointsWonService]}),t.push({name:"Games Won",numerator:r.Games}),t.push({name:"Most Consecutive Points Won",numerator:r.MaxPointsInRow}),t.push({name:"Most Consecutive Games Won",numerator:r.MaxGamesInRow}),t.push({name:"Longest Rally",numerator:r.MaxShotsInRally}),t.push({name:"Net Points Won",numerator:r.NetPointsWon,denominator:r.NetPoints}),t}function p(e){function t(e,t){if(e.indexOf(t)>=0){if(n.indexOf("*")>=0||n.indexOf("@")>=0)var r=n.slice(u-2);if(n.indexOf("#")>=0)var r=n.slice(u-3);if(r&&r.indexOf(t)>=0)return!0}}serverNet=0,receiverNet=0;var r=e.serves;if(r&&r.length&&r[r.length-1].indexOf("+")>=0&&(serverNet=1),!e.rally||!e.rally.length)return{server:serverNet,receiver:receiverNet};var n=e.rally.join(""),a=["c",";","0","1","2","3","4","5","6","7","8","9","d","x","n","w"],i=["o","p","v","z","j","k","h","i"],o=["f","b","r","s","l","m","t","q"],s=["u","y"];a.forEach(function(e){n=n.replace(new RegExp(e,"g"),"")}),i.forEach(function(e){n=n.replace(new RegExp(e+"=","g"),"B"),n=n.replace(new RegExp(e,"g"),"N")}),o.forEach(function(e){n=n.replace(new RegExp(e+"-","g"),"N"),n=n.replace(new RegExp(e+"\\+","g"),"A"),n=n.replace(new RegExp(e,"g"),"B")}),s.forEach(function(e){n=n.replace(new RegExp(e+"-","g"),"E"),n=n.replace(new RegExp(e,"g"),"D")});var l=[],c=[];n.split("").forEach(function(e,t){["*","#","@"].indexOf(e)<0&&(t%2?l.push(e):c.push(e))}),(l.indexOf("N")>=0||l.indexOf("E")>=0)&&(serverNet=1),(c.indexOf("N")>=0||c.indexOf("E")>=0)&&(receiverNet=1);var u=n.length;return t(l,"D")&&(receiverNet=1),t(c,"D")&&(serverNet=1),t(l,"A")&&(serverNet=1),t(c,"A")&&(receiverNet=1),{server:serverNet,receiver:receiverNet}}var f={};f.selectPoints=e,f.counters=t,f.baseStats=r,f.serveStats=n,f.raw=u,f.statObjects=d,f.isNetPoint=p,"function"==typeof define&&define.amd?define(f):"object"==typeof module&&module.exports&&(module.exports=f),this.statistics=f}(),!function(){function e(){f.meta={bestof:3},f.meta.players={0:"Player One",1:"Player Two",2:"",3:""}}function t(e){var t=e.yyyymmdd();return r(t)}function r(e){e=e.toString();var t=e.slice(0,4)+"-"+e.slice(4,6)+"-"+e.slice(6);return t}function a(){f.umo&&(f.umo.options({match:{desc:f.meta.match_desc||"",sets:+f.meta.bestof||3,final_set_tiebreak:void 0==f.meta.final_set_tiebreak||f.meta.final_set_tiebreak,final_set_tiebreak_only:f.meta.final_set_tiebreak_only||!1,final_set_tiebreak_to:+f.meta.final_set_tiebreak_to||7,first_service:f.meta.first_service||0},set:{games:void 0==f.meta.setgames?12:+f.meta.setgames,tiebreak:void 0==f.meta.tiebreak||f.meta.tiebreak,tiebreak_at:f.meta.tiebreak_at?+f.meta.tiebreak_at:f.meta.setgames?+f.meta.setgames/2:6,tiebreak_to:+f.meta.tiebreak_to||7,advantage:0!=f.meta.advantages,lets:0!=f.meta.lets}}),f.umo.metadata({players:{0:{name:f.meta.players[0]||"",fname:"",lname:"",fh:f.meta.p1hand||""},1:{name:f.meta.players[1]||"",fname:"",lname:"",fh:f.meta.p2hand||""},2:{name:f.meta.players[2]||"",fname:"",lname:"",fh:f.meta.p3hand||""},3:{name:f.meta.players[3]||"",fname:"",lname:"",fh:f.meta.p4hand||""}},tournament:{name:f.meta.tournament||"",surface:f.meta.surface||"",round:f.meta.round||""},match:{date:f.meta.matchdate?f.meta.matchdate:"",category:f.meta.category||"",court:f.meta.court||"",umpire:f.meta.umpire||""},charter:f.meta.charter||""}))}function i(e){return f.umo.push(e)}function o(e){function t(e){var t={},r=e.A7.v.trim().split("("),n=e.F7.v.trim().split("("),a=r.length>1?+r[1].split(")")[0]:"",i=n.length>1?+n[1].split(")")[0]:"";return t[0]={name:l(r[0]),rank:a},t[1]={name:l(n[0]),
rank:i},t}function r(e){var t={},r=e.B5.v.trim().split(":"),n=e.N4.v.trim().split(":"),a=e.N5.v.trim().split(":");t.name=r.length>1?r[1].trim():r,t.surface=a.length>1?a[1].trim():r;var i=n.length>1?n[1].trim():n.trim(),o=i.substr(6)+"-"+i.substr(3,2)+"-"+i.slice(0,2);return d(o)&&(t.date=o),t}function n(e){function t(t){function r(e){var t=Object.keys(e),r="";t.forEach(function(t){e[t]&&e[t].length&&(r=r+t+": "+e[t]+" / ")}),r.length&&console.log(r)}function n(e){if(e){var t=[1,6],r=[2,5],n=[3,4],e=(e+"").replace(/\D/g,"").substr(-1);return[1,2,3].indexOf(+e)>=0?l.service_court="deuce":l.service_court="ad",e=t.indexOf(+e)>=0?4:r.indexOf(+e)>=0?5:n.indexOf(+e)>=0?6:0}}function a(e,t,r,n){e+="";var a,o,s,l,c=e,u={2:"3-4",3:"5-8",4:">8"},d=[],p=[],f=[],h=/SV/,m=h.test(c),v=/^S/;c=c.replace(v,"");var g=/^T2/;g.test(c)&&(c=c.replace(g,""),f.push("Twice"));var y=/[DVSRN](\d)$/;if(y.test(c)){var s=u[y.exec(c)[1]];c=c.replace(y,"")}var x=/^\d[VPTMD]/,b=t==r&&["Provoked","Winner"].indexOf(n)>=0&&x.test(c);x.test(c)&&("V"==c[1]&&f.push("Accuracy"),"P"==c[1]&&f.push("Power"),"T"==c[1]&&f.push("Touch"),"M"==c[1]&&f.push("Nice"),"D"==c[1]&&f.push("Twice"),c="");var w=/^\d/,_=!b&&t==r&&["Provoked","Winner"].indexOf(n)>=0&&(w.test(c)||"A"==c[0]),k=/^\d$/,S=t==r&&"Error"==n&&k.test(c),O=/^\d+/;if(O.test(c)){s=3;var c=c.replace(O,"")}var A=/(\d+)$/;c=c.replace(A,"");var T=/RRV/,P=/RCD/;c=c.replace(T,"G"),c=c.replace(P,"H"),["V","VS","VR"].indexOf(c)>=0?(p.push("approach"),c=""):"V"==c[0]&&(o="volley",c=c.substr(1));var R=/V$/;R.test(c)&&(p.push("approach"),c=c.replace(R,""));var y=/[DVSRN](\d)$/;if(y.test(c)){var s=u[y.exec(c)[1]];c=c.replace(y,"")}var M=/E$/;M.test(c)&&(["RE","DE","CE","RPE","CPE"].indexOf(c)<0?p.push("approach"):d.push("center"),c=c.replace(M,"")),c.indexOf("L")>=0&&c.indexOf("TL")<0&&(d.push("down the line"),l=!0),c.indexOf("TL")>=0?o="lob":c.indexOf("T")>=0&&p.push("touch"),"DL"==c&&(d.push("inside in"),c="C"),(c.substr(1).indexOf("D")>=0||"DC"==c)&&(d.push("inside out"),"DC"==c&&(c="D"));var E=/CCC/,C=/CCL/;(E.test(c)||C.test(c))&&(p.push("short ball"),c=c.replace(E,"CC"),c=c.replace(C,"CL")),c.substr(1).indexOf("C")>=0&&!l&&d.push("cross court"),["VRP","VCP"].indexOf(c)>=0&&(o="drive volley"),c.indexOf("A")>=0&&(o="drop"),"SM"==c&&(a="forehand",o="smash");var j=/D$/;j.test(c)&&(o="half-volley");var F=/^P/;F.test(c)&&(p.push("passing"),c.replace(F,""));var W=/^[GH]/,z=/^[CDR]/,N=/P/;N.test(c)&&(z.test(c)?p.push("passing"):W.test(c)&&d.push("inside in"));var B=/^[HCD]/,D=/^[GR]/;B.test(c)?a="forehand":D.test(c)&&(a="backhand");var L=c.length||p.length?i(a,o):"";return console.log("----------------"),console.log(e,c),{shot_code:L,serve_volley:m,serve_attributes:f,shot_attributes:p,trajectory:d,rally_range:s,ace:_,sw:b,df:S}}function i(e,t){return"backhand"==e?"volley"==t?"z":"half-volley"==t?"i":"smash"==t?"p":"lob"==t?"m":"drive volley"==t?"k":"drop"==t?"y":"b":"volley"==t?"v":"half-volley"==t?"h":"smash"==t?"o":"lob"==t?"l":"drive volley"==t?"j":"drop"==t?"u":e?"f":"q"}var o={};columns_keys={A:"first_serve",B:"second_serve",I:"second_serve",J:"first_serve",K:"progression",L:"rally",N:"set_score",C:"Winner",D:"Provoked",E:"Error",F:"Error",G:"Provoked",H:"Winner",O:"Return",P:"ThirdShot",Q:"Rally1st",R:"Rally2nd",S:"Rally3rd",T:"Return",U:"ThirdShot",V:"Rally1st",W:"Rally2nd",X:"Rally3rd"};var s=t.map(function(e){return e[0]});o.server=s.indexOf("A")>=0?0:1;var l={};l.p0={},l.p1={},l.n0={},l.n1={},l.c0={},l.c1={},t.forEach(function(t){var n=columns_keys[t[0]];"CDF".split("").indexOf(t[0])>=0?(l.p0[n]=e[t].v,l.c0=a(l.p0[n],o.server,0,n),r(l.c0)):"OPQRS".split("").indexOf(t[0])>=0?l.n0[n]=e[t].v:"EGH".split("").indexOf(t[0])>=0?(l.p1[n]=e[t].v,l.c1=a(l.p1[n],o.server,1,n),r(l.c1)):"TUVWX".split("").indexOf(t[0])>=0?l.n1[n]=e[t].v:n&&(l[n]=e[t].v)}),l.rally&&(l.rally=new Array(l.rally)),sw=l.c0.sw||l.c1.sw,sw&&console.log("SERVE WINNER"),ace=l.c0.ace||l.c1.ace,ace&&console.log("ACE"),df=l.c0.df||l.c1.df,df&&console.log("DOUBLE FAULT");var c=[],u=[];l.c0.serve_attributes&&l.c0.serve_attributes.forEach(function(e){u.push(e)}),l.c1.serve_attributes&&l.c1.serve_attributes.forEach(function(e){u.push(e)}),u.forEach(function(e){"Power"==e&&c.push("p"),"Accuracy"==e&&c.push("a"),"Touch"==e&&c.push("t"),"Nice"==e&&c.push("n")}),l.first_serve=n(l.first_serve),l.second_serve=n(l.second_serve),l.second_serve?(l.first_serve=l.first_serve+"e",ace&&(l.second_serve=l.second_serve+"*"),sw&&(l.second_serve=l.second_serve+"#"),df&&(l.second_serve=l.second_serve+"e"),l.second_serve+=c):(ace&&(l.first_serve=l.first_serve+"*"),sw&&(l.first_serve=l.first_serve+"#"),l.first_serve+=c);var d=[l.p0.Provoked,l.p0.Winner].filter(function(e){return e}).join(","),p=[l.p1.Provoked,l.p1.Winner].filter(function(e){return e}).join(",");return d.length||p.length?o.winner=d.length?0:1:l.p0.Error&&l.p1.Error?o.winner=l.p0.Error.indexOf("V")>=0?0:1:l.p0.Error||l.p1.Error?o.winner=l.p0.Error?1:0:console.log("ERROR: Winner cannot be determined",l),o.code=l,o}var r=[],n=Object.keys(e),a=/^[A-Z]/,i=/^Y/,o=n.filter(function(e){return a.test(e)}),s=o.filter(function(e){return i.test(e)}).map(function(e){return e.substring(1)});return s.forEach(function(e){var n=new RegExp("^[A-Z]"+e+"$"),a=o.filter(function(e){return n.test(e)}),i=t(a);r.push(i)}),r}var a=n(e);foo=a;var i=t(e),o=r(e);return{players:i,tournament:o,points:a}}function s(e){return e<=9&&(e=("0"+e).slice(-2)),e}function l(e){if(e){var t=e.trim().split(" ").map(function(e){return e.toLowerCase()}).map(function(e){return e[0].toUpperCase()+e.substr(1)}),r=t.map(function(e,r){return(0==r||r==t.length-1||R.indexOf(e)<0)&&(e=e[0].toUpperCase()+e.slice(1)),e}).join(" ");return r}}function c(e){var t=e.split("-");return t[0]+"-"+(t[1][1]?t[1]:"0"+t[1][0])+"-"+(t[2][1]?t[2]:"0"+t[2][0])}function u(e){var t=e.getFullYear().toString(),r=(e.getMonth()+1).toString(),n=e.getDate().toString();return c([t,r,n].join("-"))}function d(e){function t(e){var t=/[0-9]+-[0-9]+-[0-9]+/;return t.test(e)}if(!t(e))return!1;e=c(e);try{var r=new Date(e),n=u(r);return e==n}catch(e){return!1}}function p(e){return e[e.length-1]}var f={},h={};h.file_format="text",f.CSV=h,h.parse=function(t){return e(),S.parse(t)};var m={};m.file_format="text",f.HTML=m;var v={};v.file_format="text",f.TXT=v,m.parse=v.parse=function(e){var t=/Game Log/,r=/to serve/,n=/won the game/,a=/e-Scorer Match Record/,i=/PLAYERS/,o=/FORMAT/,s=/Point History/,l=/Tennis Score Tracker/,c=/GrupoXCell/,u=/The TSP team/,d=/MyTennisStatsApp/;return t.test(e)&&r.test(e)&&n.test(e)?k.parse(e):a.test(e)&&i.test(e)&&o.test(e)?_.parse(e):s.test(e)&&l.test(e)?b.parse(e):c.test(e)&&u.test(e)?y.parse(e):d.test(e)?g.parse(e):void 0};var g={};g.file_format="text",f.MTS=g,g.parse=function(r){e(),d3.select("body").append("div").attr("id","parser").style("display","none"),d3.select("#parser").html(r);var n=document.querySelector("#parser"),o=n.getElementsByTagName("a"),s=Object.keys(o),l=s.filter(function(e){return e.indexOf("game")>=0}),c=o.top,u=c.children[0].children[0].children,d=u[1].textContent;d.indexOf("Event:")>=0&&(f.meta.match_desc=d.split("Event:")[1].trim(),f.meta.tournament=f.meta.match_desc);var p=u[2].textContent;p.indexOf("Date:")>=0&&(f.meta.matchdate=t(new Date(p.split("Date:")[1].trim())));var h=u[3].children[0].textContent.trim().split("/"),m=u[4].children[0].textContent.trim().split("/"),v=h[0].trim(),g=m[0].trim(),y=h.length>1?h[1].trim():"",x=m.length>1?m[1].trim():"",b=[v,g,y,x];f.meta.players=b;var w,_,k=[],S=4,O=!1,A=[0,0],T=7,P=7,R=0,M=[0,0];f.meta.advantages=!1,f.meta.tiebreak=!1;var E=/\(([^)]+)\)/;l.forEach(function(e){for(var t=o[e].children[0].children[0].children,r=0;r<t.length;r++){var n,a={},i=t[r].children[0];if(i.textContent.indexOf("in Set")>=0)R=0;else if(i.textContent.indexOf("Game Winner")>=0){O&&Math.max.apply(null,A)>9&&0==R&&(f.meta.final_set_tiebreak_to=10),O=!1,R+=1;var s=E.exec(i.textContent);if(s.length>1){var l=s[1].split("-").map(function(e){return+e});l[0]<M[0]||l[1]<M[1]?_=M[0]>M[1]+1?M[0]:M[1]>M[0]+1?M[1]:Math.max(M[0],M[1]):(l[0]>M[0]||l[1]>M[1])&&(l[0]>S&&(S=l[0]),l[1]>S&&(S=l[1])),M=l}}else if(!i.attributes.length&&"Score"!=i.textContent){a.score=i.textContent.trim(),a.score.split("-").indexOf("1")>=0&&(O=!0,f.meta.tiebreak=!0,0==R&&(f.meta.final_set_tiebreak_only=!0)),O&&(A=a.score.split("-").map(function(e){return+e})),a.score.indexOf("A")>=0&&(f.meta.advantages=!0);var c=t[r].children[1].textContent.trim(),u=t[r].children[6].textContent.trim();a.server=b.indexOf(c)%2,void 0==w&&(w=a.server),a.player=b.indexOf(u)%2,a.result=t[r].children[7].textContent.trim(),a.stroke=t[r].children[10].textContent.trim(),a.stroke_type=t[r].children[9].textContent.trim(),t[r].children.length>12&&(a.rally=t[r].children[12].textContent.trim()),["Winner","Ace","Service Winner","Won Point","Forced Error"].indexOf(a.result)>=0?(n=a.server==a.player?"S":"R",a.winner=a.server==a.player?"S":"R"):["Double Fault","Unforced Error","No Return"].indexOf(a.result)>=0?(n=a.server==a.player?"R":"S",a.winner=a.server==a.player?"R":"S"):console.log("Point Assignment Error");+t[r].children[2].textContent,+t[r].children[3].textContent,+t[r].children[4].textContent,+t[r].children[5].textContent;k.push(a)}}}),_||(_=S),f.meta.setgames=2*_,f.meta.tiebrek_to=T,f.meta.final_sset_tiebreak_to=P,f.meta.first_service=w,f.umo.options({match:{first_service:w}}),a(),k.forEach(function(e){i(e.winner)})};var y={};y.file_format="text",f.TSP=y,y.parse=function(t){function r(){if(u.surface&&(f.meta.surface=u.surface),u.date){var e=u.date.split("-");f.meta.matchdate=e[2]+e[0]+e[1]}}function n(){if(d.service)if("Double Fault"==d.service)c.code="0e|0e";else{d.service.indexOf("2nd")>=0?c.code="0e|":c.code="";var e=o();if(e){var t="0";c.server==c.winner&&(t+="q"),t+=e}else var t=c.server==c.winner?"S":"R";c.code+=t}i(c)}function o(){var e;return"Forehand"==d.shot?(e="f*","Unforced Error"==d.shotType?e="qf@":"Slice"==d.shotType?e="r*":"Lob"==d.shotType?e="l*":"Smash"==d.shotType?e="o*":"Drop"==d.shotType?e="u*":"Volley"==d.shotType&&(e="v*")):"Backhand"==d.shot&&(e="b*","Unforced Error"==d.shotType?e="qb@":"Slice"==d.shotType?e="s*":"Lob"==d.shotType?e="m*":"Smash"==d.shotType?e="p*":"Drop"==d.shotType?e="y*":"Volley"==d.shotType&&(e="z*")),e}e();var s,l,c={},u={start_time:void 0,surface:void 0,date:void 0},d={},p=t.split("\n"),h=/([\w\s]+)\svs\s([\w\s]+)/,m=/Point\s\#\s\d+\sTime\:\s(.*)\sWinner\:\s([\w\s]+)/,v=/Winner\:([\w\s]+)\sService\:\s([\w\s]+)\s/,g=/Service\:\s([\w\s]+)\sService/,y=/Service\:\sDouble\sFault/,x=/\s+Type\:\s([\w\s]+)/,b=/\s+Effect\:\s([\w\s]+)/,w=/\s+Direction\:\s([\w\s]+)/,_=/\s+Shot\:\s([\w\s]+)/,k=/\s+Zone\sfrom\:\s([\w\s]+)/,S=/\s+Zone\sto\:\s([\w\s]+)/,O=/\-\s(.*)\s\-\s(\d\d-\d\d-\d\d\d\d)/;f.umo.options({match:{first_service:0,sets:3}}),p.forEach(function(e){if(h.test(e)){var t=h.exec(e);f.meta.players=[t[1],t[2]]}else if(v.test(e)){var r=v.exec(e)[2];s=f.meta.players.indexOf(r),void 0==l&&(f.meta.first_service=l,l=s),f.umo.options({match:{first_service:l,sets:5}})}else if(O.test(e)){var a=O.exec(e);u.surface=a[1],u.date=a[2]}else if(m.test(e)){var i=m.exec(e),o=i[1];void 0==u.start_time&&(u.start_time=o);var p=i[2];void 0!=c.winner&&(n(),c={},d={}),c.server=s,c.winner=f.meta.players.indexOf(p)}else g.test(e)?d.service=g.exec(e)[1]:y.test(e)?d.service="Double Fault":x.test(e)?d.shotType=x.exec(e)[1]:_.test(e)?d.shot=_.exec(e)[1]:w.test(e)?d.shotDirection=w.exec(e)[1]:b.test(e)?d.shotEffect=b.exec(e)[1]:k.test(e)?d.zoneFrom=k.exec(e)[1]:S.test(e)&&(d.zoneTo=S.exec(e)[1])}),void 0!=c.winner&&n(),r(),a()};var x={};x.file_format="text",f.SMT=x,x.parse=function(t){function n(e,t,r){console.log("sets change for player:",e)}function o(e,t){var r=f.umo.sets();if(r.length&&r[S].score())var n=r[S].score().games;else var n=[0,0];t>n[e]&&(i(e),o(0,t))}function l(e,t,r){console.log("points change for player:",e)}function c(e){var t=536870912;return e&t?1:0}function u(e){var t=15728640,r=[1048576,2097152,3145728,4194304,5242880,6291456,7340032,8388608],n=["Serve","Drive","Volley","Lob","Overhead","Drop Shot","Passing Shot","Approach Shot"],a=e&t,i=r.indexOf(a);return i>=0&&n[i]}function d(e){var t=28672,r=[4096,8192,12288],n=["Lost","Won","Let"],a=e&t,i=r.indexOf(a);return i>=0&&n[i]}function p(e){var t=196608,r=[65536,131072,196608],n=["Winner","Forced Error","Unforced Error"],a=e&t,i=r.indexOf(a);return i>=0&&n[i]}function h(e){var t=251658240,r=[16777216,33554432,50331648,67108864,83886080],n=["top spin","slice","flat","kick","twist"],a=e&t,i=r.indexOf(a);return i>=0&&n[i]}e(),xmlc=P(t);var m=xmlc.getElementsByTagName("info")[0];f.meta.players=[m.getAttribute("player1"),m.getAttribute("player2")],f.meta.p1hand="false"==m.getAttribute("lefty1")?"R":"L",f.meta.p2hand="false"==m.getAttribute("lefty2")?"R":"L";var v=m.getAttribute("date"),g=new Date(v),y=g.getFullYear().toString(),x=s(g.getDate()).toString(),b=s(g.getMonth()+1).toString();f.meta.matchdate=r(y+b+x),a(),RETURN_SHOT="1000000000000000000000000000000",PLAYER="0100000000000000000000000000000",BACKHAND="0010000000000000000000000000000",SHOT_STYLES="0001111000000000000000000000000",SHOT_TYPE="0000000111100000000000000000000",UNKNOWN="0000000000011000000000000000000",SHOT_MODE="0000000000000110000000000000000",SHOT_SCORE="0000000000000000111000000000000",AREA="0000000000000000000110111111111",COURT={SIZE_X:78,SIZE_Y:36,START_X:0,MID_X:18,SERV_X:26,END_X:39,START_Y_DOUBLES:0,START_Y:4.5,SERV1_Y:11.25,CENTER1_Y:13.5,MID_Y:18,CENTER2_Y:22.5,SERV2_Y:24.75,END_Y:31.5,END_Y_DOUBLES:36},games=[];for(var w=[],_=xmlc.getElementsByTagName("Match")[0].children,k=0;k<_.length;k++){if("score"==_[k].tagName){var S=0,O={15:1,30:2,40:3,A:4},A=f.umo.score(),T=[_[k].getAttribute("sets1"),_[k].getAttribute("sets2")],R=A.score;R[0]!=T[0]&&n(0,R[0],T[0]),R[1]!=T[1]&&n(1,R[1],T[1]);var M=[_[k].getAttribute("games1"),_[k].getAttribute("game2")];o(0,M[0]),o(1,M[1]);var E=[_[k].getAttribute("pts1"),_[k].getAttribute("pts2")],C=f.umo.points();if(C.length){S=C[C.length-1].set;var j=C[C.length-1].score.split("-"),F=[O[j[0]],O[j[1]]]}else var F=[0,0];F[0]!=E[0]&&l(0,F[0],E[0]),F[1]!=E[1]&&l(1,F[1],E[1])}if("game"==_[k].tagName&&w.length&&(games.push({shots:w}),w=[]),"shot"==_[k].tagName){var W=_[k].getAttribute("fromType"),z=(_[k].getAttribute("toType"),_[k].getAttribute("x1")),N=_[k].getAttribute("y1"),B=_[k].getAttribute("x2"),D=_[k].getAttribute("y3"),L=(_[k].getAttribute("time"),u(W)),I=d(W),G=p(W),H=h(W),q=c(W);if("Let"==I)continue;var U=0==q&&"Won"==I||1==q&&"Lost"==I?0:1;i(U),w.push({player:q,type:L,outcome:I,result:G,style:H,x1:z,y1:N,x2:B,y2:D})}}AREA_LEFT=1,AREA_CENTER=2,AREA_RIGHT=4,AREA_BASE=8,AREA_VOLLEY=16,AREA_WIDE=32,AREA_LONG=64,AREA_SERV1=128,AREA_SERV2=256,AREA_QUAD=1024,AREA_ISLE=2048,AREA_MASK=3583,AREA_SIDE2=512,FORMAT_NO_SCORING=0,FORMAT_2_OF_3=1,FORMAT_2_OF_3_8=2,FORMAT_2_OF_3_10=3,FORMAT_3_OF_5=4,FORMAT_8_GAMES=5,FORMAT_10_GAMES=6,FORMAT_POINTS_ONLY=7,FORMAT_SETS_MASK=255,FORMAT_NO_AD=256};var b={};b.file_format="text",f.TST=b,b.parse=function(t){e(),t=t.replace(/<base/i,"<foo"),t=t.replace(/<meta/i,"<foo"),t=t.replace(/<body/i,"<foo"),t=t.replace(/<style/i,"<foo"),d3.select("body").append("div").attr("id","parser").style("display","none"),d3.select("#parser").html(t);var o=document.querySelector("#parser");f.meta.players=[o.querySelector("#team_one_background").textContent,o.querySelector("#team_two_background").textContent];var l=o.querySelector("#date").textContent,c=new Date(l.replace("at","")),u=c.getFullYear().toString(),d=s(c.getDate()).toString(),p=s(c.getMonth()+1).toString();f.meta.matchdate=r(u+p+d);var h,m,v=o.querySelector("#container").childNodes,g={},y=[],x=[],b=!1,w=!1,_=["0","0"],k=/\(([^)]+)\)/,S=4,O=[0,0];for(n=0;n<v.length;n++){var A=v[n].getAttribute("class");if("event"==A){void 0!=g.winner&&(y.push(g),g={});var T=v[n].querySelector(".event_score").textContent,P=T.split("(")[0].trim().split("-").map(function(e){return+e});P[0]<O[0]||P[1]<O[1]?m=O[0]>O[1]+1?O[0]:O[1]>O[0]+1?O[1]:Math.max(O[0],O[1]):(P[0]>O[0]||P[1]>O[1])&&(P[0]>S&&(S=P[0]),P[1]>S&&(S=P[1])),O=P;var R=k.exec(T)[1];0==R.indexOf("---")&&(R="40-"+R.slice(3)),R.indexOf("---")>0&&(R=R.split("-")[0]+"-40"),R.indexOf("AD")>=0&&(w=!0);var x=R.split("-");"1"!=x[0]&&"1"!=x[1]||(tiebreak=b=!0),"0"==x[0]&&"0"==x[1]?h="AD"==_[0]||"AD"==_[1]?"AD"==_[0]?0:1:+_[0]>+_[1]?0:1:"AD"==_[0]||"AD"==_[1]?"AD"==_[1]&&"40"==x[1]?h=0:"AD"==_[0]&&"40"==x[0]&&(h=1):_[0]!=x[0]&&_[1]==x[1]?h=0:_[1]!=x[1]&&_[0]==x[0]&&(h=1),_=x,void 0!=h&&(g.winner=h,h=void 0)}}m||(m=S),void 0!=g.winner&&(y.push(g),g={}),f.meta.setgames=2*m,f.meta.advantages=w,a(),y.forEach(function(e){i(e)})};var w={};w.file_format="text",f.TTM=w,w.parse=function(t){e();var r,n=[],o=JSON.parse(t),s={WINNER:"Winner",UNFORCED_ERROR:"Unforced Error",FORCED_ERROR:"Forced Error",ACE:"Ace",DOUBLE:"Double Fault"},l={FOREHAND:"f",BACKHAND:"b",VOLLEY_FH:"v",VOLLEY_BH:"z",SMASH:"o",UNKNOWN:"q"};f.meta.players=[o.player1,o.player2],a(),o.sets.forEach(function(e){e.games.forEach(function(e){var t="PLAYER1"==e.defaultServer?0:1;e.rallies.forEach(function(e){var a={};void 0==r&&(r=t,f.meta.first_service=r,f.umo.options({match:{first_service:t}}));var i="UNKNOWN"==e.player1action?1:0;"UNKNOWN"==e.player1action&&"UNKNOWN"==e.player2action&&(i=void 0);var o=0==i?s[e.player1action]:s[e.player2action];l[e.shotType];if("SECOND"==e.service&&(a.first_serve={error:"Unknown",serves:["0e"]}),"Ace"==o?a.serves=["0*"]:"Double Fault"==o?(a.first_serve={error:"Unknown",serves:["0e"]},a.serves=["0e"]):a.serves=["0"],"Winner"==o?a.rally=t==i?["q","q*"]:["q*"]:"Forced Error"==o?a.rally=t==i?["q","q#"]:["q#"]:"Unforced Error"==o&&(a.rally=t==i?["q","q@"]:["q@"]),a.first_serve)var c=a.rally?a.serves.join("")+a.rally.join(""):a.serves.join(""),u=sequences.pointParser([a.first_serve.serves[0],c]);else var d=a.rally?a.serves.join("")+a.rally.join(""):a.serves.join(""),u=sequences.pointParser([d]);void 0!=i&&n.push(u)})})}),n.forEach(function(e){i(e)})};var _={};_.file_format="text",f.ESC=_,_.parse=function(t){function r(e,t){e.indexOf("Tie Break")>=0?(f.meta.bestof=1,f.meta.final_set_tiebreak=!0,f.meta.final_set_tiebreak_only=!0,f.meta.final_set_tiebreak_to=+e.trim().split(" ")[0]||7):f.meta.bestof=+e.trim().split(" ")[0]||3,f.meta.setgames=2*+t.trim().split(" ")[0]||12,f.meta.tiebreak=t.indexOf("Tie Break")>=0,t.indexOf("/")>0&&(f.meta.tiebreak_at=+t.split("-")[1][0])}function n(e,t,r){if(v.test(e)){l=0,void 0==s&&(s=0,f.meta.first_service=s,f.umo.options({match:{first_service:0,sets:5}}));var n=v.exec(e),a=g.exec(t),i=g.exec(r)}else{l=1,void 0==s&&(s=1,f.meta.first_service=s,f.umo.options({match:{first_service:1,sets:5}}));var n=v.exec(r),a=g.exec(t),i=g.exec(e)}n=n?n[1]:"",a=a?a[1]:"",i=i?i[1]:"";for(var c=Math.max(n.length,a.length,i.length),d=0;d<c;d++)(u.indexOf(n[d])>=0||u.indexOf(a[d])>=0||u.indexOf(i[d])>=0)&&o(n[d],a[d],i[d])}function o(e,t,r){if(f.umo.nextService()!=l){var n=t;t=r,r=n}var a={};if("f"==e&&(a.first_serve={error:"Unknown",serves:["0e"]}),"S"==t||"S"==r?a.serves=["0*"]:"d"==t||"d"==r?(a.first_serve={error:"Unknown",serves:["0e"]},a.serves=["0e"]):a.serves=["0"],"B"==t&&(a.rally=["q","q*"]),"B"==r&&(a.rally=["q","q","q*"]),"N"==t&&(a.rally=["q","q-*"]),"N"==r&&(a.rally=["q","q","q-*"]),"R"==r&&(a.rally=["q*"]),"R"==t&&(a.rally=["q*"]),"b"==t&&(a.rally=["q","q@"]),"b"==r&&(a.rally=["q","q","q@"]),"n"==t&&(a.rally=["q","q-@"]),"n"==r&&(a.rally=["q","q","q-@"]),"r"==r&&(a.rally=["q@"]),"r"==t&&(a.rally=["q@"]),"O"==t&&"."==r&&(a.serves=["S"]),"."==t&&"O"==r&&(a.serves=["R"]),a.first_serve)var i=a.rally?a.serves.join("")+a.rally.join(""):a.serves.join(""),o=sequences.pointParser([a.first_serve.serves[0],i]);else var e=a.rally?a.serves.join("")+a.rally.join(""):a.serves.join(""),o=sequences.pointParser([e]);c.push(o)}e();for(var s,l,c=[],u="O.SRrBbNnd".split(""),d=/GAME\#/i,p=/FORMAT/,h=/NO\ Advantage/,m=/SEMI\ Advantage/,v=/s\>([\w\s]*)/,g=/[AB]\s([\w\.\s]+)/,y=/A\:\s([\w\s]+)/,x=/B\:\s([\w\s]+)/,b=t.split("\n").reverse();b.length;){var w=b.pop();d.test(w)?n(b.pop(),b.pop(),b.pop()):p.test(w)&&r(b.pop(),b.pop())}f.meta.players=[y.exec(t)[1],x.exec(t)[1]],h.test(t)&&(f.meta.advantages=!1),m.test(t)&&(f.meta.advantages=!0),a(),c.forEach(function(e){i(e)})};var k={};k.file_format="text",f.TSS=k,k.parse=function(t){function r(e){var t=/an unforced error/,r=/a forced error/,n=/a winner/,a=/a service winner/,i=/an ace/,o=/a double fault/;return t.test(e)?"Unforced Error":r.test(e)?"Forced Error":n.test(e)?"Winner":a.test(e)?"Serve Winner":i.test(e)?"Ace":o.test(e)?"Double Fault":void 0}e();var n,o,s;t=t.replace(/\*/g,"");var l=t.split("\n"),c=/Best of (\d)/,u=/to serve/,d=/([\d\w]+)-([\d\w]+):/,p=/Done:/,h=/has won the game/,m=/Tiebreaker/;l.forEach(function(e){function t(e){var t=i(e),r=f.umo.points().length,n=t.point.winner==t.point.server?"S":"R",t=f.umo.decoratePoint(r-1,{code:n})}var l={};if(e.indexOf("vs.")>0&&(f.meta.players=e.split(" vs. "),p1=new RegExp(f.meta.players[0]),p2=new RegExp(f.meta.players[1]),a()),c.test(e)&&(f.meta.bestof=c.exec(e)[1],f.umo.options({match:{sets:f.meta.bestof||5}})),u.test(e))p1&&p1.test(e)&&(n=!1,void 0==o&&(o=0,f.meta.first_service=o,f.umo.options({match:{first_service:0}}))),p2&&p2.test(e)&&(n=!0,void 0==o&&(o=1,f.meta.first_service=o,f.umo.options({match:{first_service:1}})));else if(p.test(e)){var v=p1.test(e)?0:1;l.result=r(e),l.winner=["Winner","Serve Winner","Ace"].indexOf(l.result)>=0?v:1-v,t(l)}else if(d.test(e)){var g=d.exec(e);"AD"==g[1]&&(g[1]="A"),"AD"==g[2]&&(g[2]="A"),l.score=n?g[2]+"-"+g[1]:g[1]+"-"+g[2],s&&(l.score=l.score.split("-").map(function(e){return e+"T"}).join("-"));var v=p1.test(e)?0:1;l.result=r(e),t(l)}else m.test(e)?s=!0:h.test(e)&&(s=!1)})};var S={};S.file_format="text",f.MCP=S,S.parse=function(t){e();var r=[],n=[],o=0;d3.csv.parse(t,function(e){if(e.meta&&(r[o]=e.meta),e.match_id&&(f.match_details=e.match_id),e["1st"]){var t=sequences.pointParser([e["1st"],e["2nd"]]);n.push(t)}o+=1}),[f.meta.players[0],f.meta.players[1],f.meta.p1hand,f.meta.p2hand,f.meta.category,f.meta.matchdate,f.meta.tournament,f.meta.round,f.meta.time,f.meta.court,f.meta.surface,foo,f.meta.umpire,f.meta.bestof,f.meta.final_set_tiebreak,f.meta.charter]=r,a(),n.forEach(function(e){i(e)})};var O={};O.file_format="binary",f.XLS=O,f.XLSM=O,f.XLSX=O,O.workbook=void 0,O.parse=function(t){if(e(),XLSX&&t){var n=[],s=XLSX.read(t,{type:"binary"});if(s.Sheets.STATS){var l=o(s.Sheets.STATS);return f.meta.players[0]=l.players[0].name,f.meta.players[1]=l.players[1].name,f.meta.matchdate=l.tournament.date,f.meta.surface=l.tournament.surface?l.tournament.surface[0]:"",a(),void l.points.forEach(function(e){i(e.winner)})}if(s.Sheets.MATCH){s.Sheets.MATCH.B1&&(f.meta.players[0]=s.Sheets.MATCH.B1.v),s.Sheets.MATCH.B2&&(f.meta.players[1]=s.Sheets.MATCH.B2.v),s.Sheets.MATCH.B3&&(f.meta.p1hand=s.Sheets.MATCH.B3.v),s.Sheets.MATCH.B4&&(f.meta.p2hand=s.Sheets.MATCH.B4.v),s.Sheets.MATCH.B5&&(f.meta.category=s.Sheets.MATCH.B5.v),s.Sheets.MATCH.B6&&(f.meta.matchdate=r(s.Sheets.MATCH.B6.v)),s.Sheets.MATCH.B7&&(f.meta.tournament=s.Sheets.MATCH.B7.v),s.Sheets.MATCH.B8&&(f.meta.round=s.Sheets.MATCH.B8.v),s.Sheets.MATCH.B9&&(f.meta.time=s.Sheets.MATCH.B9.v),s.Sheets.MATCH.B10&&(f.meta.court=s.Sheets.MATCH.B10.v),s.Sheets.MATCH.B11&&(f.meta.surface=s.Sheets.MATCH.B11.v),s.Sheets.MATCH.B12&&(f.meta.umpire=s.Sheets.MATCH.B12.v),s.Sheets.MATCH.B13&&(f.meta.bestof=s.Sheets.MATCH.B13.v),s.Sheets.MATCH.B14&&(f.meta.final_set_tiebreak=s.Sheets.MATCH.B14.v),s.Sheets.MATCH.B15&&(f.meta.charter=s.Sheets.MATCH.B15.v),a();for(var c=18;c<500;c++){var u=s.Sheets.MATCH["N"+c];if(!u)break;var d=s.Sheets.MATCH["O"+c],p=u.v,h=d?d.v:"",m=sequences.pointParser([p,h]);n.push(m)}}O.workbook=s,n.forEach(function(e){i(e)})}},O.populate=function(e){if(XLSX&&O.workbook){var t=O.workbook.Sheets.MATCH,r={v:"",t:"s"};t.B1=f.meta.players[0]?{v:f.meta.players[0],t:"s"}:r,t.B2=f.meta.players[1]?{v:f.meta.players[1],t:"s"}:r,t.B3=f.meta.p1hand?{v:f.meta.p1hand,t:"s"}:r,t.B4=f.meta.p2hand?{v:f.meta.p2hand,t:"s"}:r,t.B5=f.meta.category?{v:f.meta.category,t:"s"}:r,t.B6=f.meta.matchdate?{v:f.prepareDate?f.prepareDate(f.meta.matchdate):"",t:"s"}:r,t.B7=f.meta.tournament?{v:f.meta.tournament,t:"s"}:r,t.B8=f.meta.round?{v:f.meta.round,t:"s"}:r,t.B9=f.meta.time?{v:f.meta.time,t:"s"}:r,t.B10=f.meta.court?{v:f.meta.court,t:"s"}:r,t.B11=f.meta.surface?{v:f.meta.surface,t:"s"}:r,t.B12=f.meta.umpire?{v:f.meta.umpire,t:"s"}:r,t.B13=f.meta.bestof?{v:f.meta.bestof,t:"s"}:r,t.B14=f.meta.final_set_tiebreak?{v:f.meta.final_set_tiebreak,t:"s"}:r,t.B15=f.meta.charter?{v:f.meta.charter,t:"s"}:r,e.forEach(function(e,r){t["M"+(18+r)]&&(t["M"+(18+r)].f='IF(A80="","",IF(K80=1,I$1,I$2))'),t["N"+(18+r)]={t:"s",v:e[0]},t["O"+(18+r)]={t:"s",v:e[1]}})}},O.save=function(e){function t(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n!=e.length;++n)r[n]=255&e.charCodeAt(n);return t}if(XLSX&&O.workbook){var r={bookType:"xlsx",bookSST:!1,type:"binary"},n=XLSX.write(O.workbook,r);e=e?e+"MCP.xlsx":"match_export.xlsx";var a=new Blob([t(n)],{type:""}),i=document.createElement("a");i.download=e,i.innerHTML="Download File",null!=window.URL?i.href=window.URL.createObjectURL(a):(i.href=window.URL.createObjectURL(a),i.onclick=destroyClickedElement,i.style.display="none",document.body.appendChild(i)),i.click()}};var A={};A.file_format="text",f.CH=A,A.parse=function(t){e();var r=JSON.parse(t);f.meta.players=[r.players[0].name,r.players[1].name],f.meta.advantages=!(r.format.code.indexOf("n")>0),a(),r.points.forEach(function(e){i(e.code.toUpperCase())})};var T={};T.file_format="text",f.PTF=T,T.parse=function(r){function n(e){f.meta.charter=e[6]}function o(e){f.meta.first_service="T"==e[1]?0:1}function s(e){f.meta.start_time=e[1]}function l(e){f.meta.players[0]=e[1],f.meta.players[1]=e[2],f.meta.matchdate=t(new Date(e[3]));var r=e[4];f.meta.tournament=r?r:"undefined",f.meta.surface=e[5],f.meta.round=e[7],f.meta.in_out=e[6]}function c(e){f.meta.bestof=+e[1],f.meta.setgames=2*+e[2],7==e.length?(f.meta.advantages="Ad"==e[5],f.meta.lets="Let"==e[6],f.meta.tiebreak=!(e[3].indexOf("First")>=0),f.meta.tiebreak_at=e[3].indexOf("Tiebreak at")>=0?+e[3].split("-")[2]:f.meta.setgames/2,f.meta.tiebreak_to=+e[3].split("-")[0],f.meta.final_settiebreak=!(e[4].indexOf("First")>=0),f.meta.final_set_tiebreak_at=e[4].indexOf("Tiebreak at")>=0?+e[4].split("-")[2]:f.meta.setgames/2,f.meta.final_set_tiebreak_to=+e[4].split("-")[0],f.meta.final_set_tiebreak_only=e[4].indexOf("Only")>0):6==e.length?(console.log("Old Format"),f.meta.advantages="Ad"==e[4],f.meta.setgames=2*+e[5],e[3].indexOf("Point Tie-Break Only")>=0&&(f.meta.tiebreak_to=7,f.meta.final_set_tiebreak_to=10,f.meta.final_set_tiebreak_only=!0)):5==e.length&&(f.meta.advantages="Ad"==e[4],f.meta.tiebreak_to=7,f.meta.final_set_tiebreak_to=10,f.meta.final_set_tiebreak_only=!0)}function u(e){function t(e){for(var t={"Near Deuce":{court:"Near Court",x:[120,180],placements:{Wide:[45,65],Body:[65,78],T:[78,90],O:[90,180]}},"Near Ad":{court:"Near Court",x:[60,120],placements:{Wide:[115,135],Body:[102,115],T:[90,102],O:[45,90]}},"Far Deuce":{court:"Far Court",x:[60,120],placements:{Wide:[115,135],Body:[102,115],T:[90,102],O:[45,90]}},"Far Ad":{court:"Far Court",x:[120,180],placements:{Wide:[45,65],Body:[65,78],T:[78,90],O:[90,180]}}},r=Object.keys(t),n=0;n<r.length;n++){var a=t[r[n]];if(a.court==e.path.impact.court&&a.x[0]<e.path.impact.x&&e.path.impact.x<a.x[1])for(var i=Object.keys(a.placements),o=0;o<i.length;o++){var s=a.placements[i[o]];if(s[0]<Math.abs(e.path.angle)&&Math.abs(e.path.angle)<s[1])return i[o]}}}function r(e,t,r,n){function a(e,t,r){function n(e,t){return t>=e[0]&&t<=e[1]?1:0}var a={x:e,y:t};return a.court=t==v.net_y?"Net":t<v.net_y?"Far Court":"Near Court",a.in_doubles=n(v.doubles_wide_x,e)&&n(v.out_long_y,t)&&t!=v.net_y?1:0,a.in_singles=n(v.singles_wide_x,e)&&n(v.out_long_y,t)&&t!=v.net_y?1:0,a.volley_zone=n(v.service_line_y,t)&&"Net"!=a.court?1:0,a.right_service_box=n(v.service_line_y,t)&&(n(v.svc_left_x,e)&&"Far Court"==a.court||n(v.svc_right_x,e)&&"Near Court"==a.court)?1:0,a.left_service_box=n(v.service_line_y,t)&&(n(v.svc_right_x,e)&&"Far Court"==a.court||n(v.svc_left_x,e)&&"Near Court"==a.court)?1:0,a.service_boxes=a.left_service_box||a.right_service_box?1:0,a.service_line=n(v.no_mans_zone_y,t)&&!a.service_boxes&&"Net"!==a.court?1:0,a.no_mans_land=!n(v.baseline_zone_y,t)||a.service_boxes||a.service_line||"Net"===a.court?0:1,a.baseline=n(v.out_long_y,t)&&!(a.service_boxes||a.service_line||a.no_mans_land)&&"Net"!==a.court?1:0,a.doubles_alley=a.in_doubles&&!a.in_singles?1:0,a.location=a.left_service_box?"Ad Service Box":a.right_service_box?"Deuce Service Box":a.service_line?"Service Line":a.volley_zone?"Volley Zone":a.no_mans_land?"No Mans":a.baseline?"Baseline":"Net"==a.court?"Net":"mark"==r?"Long":"Defensive",a}var i=37,o=203,s=120,l=16,c=304,u=90,d=230,p=l+20,f=c-20,h=p+30,m=f-30,v={singles_competitors:["T","O"],doubles_competitors:["T1","T2","O1","O2"],centerline_x:s,net_y:160,doubles_wide_x:[18,230],singles_wide_x:[i,o],out_long_y:[l,c],service_line_y:[u,d],svc_left_x:[i,s+3],svc_right_x:[s-3,o],approach_y:[u,d],baseline_zone_y:[p,f],no_mans_zone_y:[h,m]};Math.degrees=function(e){return e*(180/Math.PI)},Math.radians=function(e){return e*(Math.PI/180)};var g={impact:a(e,t,"impact"),mark:a(r,n,"mark")};return g.trajectory="",g.impact.x||g.impact.y||g.mark.x||g.mark.y?(g.impact.x<=v.centerline_x&&g.mark.x>v.centerline_x||g.impact.x>v.centerline_x&&g.mark.x<=v.centerline_x?g.mark.y>v.service_line_near_y&&g.mark.y<v.service_line_far_y?g.trajectory="Short Angle":g.trajectory="Cross Court":g.mark.x>v.centerline_x-40&&g.mark.x<v.centerline_x+40?g.trajectory="Center":g.trajectory="Line",delta_x=g.impact.x-g.mark.x,delta_y=g.impact.y-g.mark.y,g.angle=Math.degrees(Math.atan2(delta_y,delta_x)),g.distance=Math.sqrt(Math.pow(delta_x,2)+Math.pow(delta_y,2)),g):g}var n="",a=e[1];x.last_shot="T"==a?0:1;var i={};if(i.stroke=e[2],i.stroke_type=e[3],i.x1=e[4],i.y1=e[5],i.name=i.result,i.x2=e[7],i.y2=e[8],i.path=r(i.x1,i.y1,i.x2,i.y2),i.trajectory=i.path.trajectory,i.end_point=i.path.mark.location,i.time=e[10],i.placement=t(i),i.result=e[6],x.shots.push(i),x.result=i.result,["Passing Shot","Net Cord"].indexOf(i.result)>=0&&(x.result="Winner",x.terminator=";*"),["Ace","Winner"].indexOf(i.result)>=0&&(x.terminator="*"),["Serve Winner"].indexOf(i.result)>=0&&(x.terminator="#",x.result="Winner"),"Second Serve"==i.stroke_type&&(x.serve=2),["Out","Out Off-Net","Out Passing Shot"].indexOf(i.result)>=0&&(x.result="Unforced Error",x.terminator="@","Long"==i.end_point?i.error="d":i.error="w"),"Net"==i.end_point&&(x.result="Unforced Error",x.terminator="@",i.error="n"),"Missed"==i.stroke)x.server="T"==a?0:1;else if(i.stroke.indexOf("Serve")>=0){var o={Wide:4,Body:5,T:6,O:0};x.server="T"==a?0:1,n+=o[i.placement],i.stroke_type.indexOf("Second")>=0&&(x.first_serve={error:"Unknown",serves:n?[n+(i.error||"e")]:["0e"]},i.error&&(x.result="Double Fault")),x.serves=[n]}else if(i.stroke.indexOf("Return")>=0)n+="q",i.error&&(n+=i.error),x.rally?x.rally.push(n):x.rally=[n],"Forcing Error"==i.result&&(x.result="Forced Error",x.rally?x.rally.push("q#"):x.rally=["q#"]);else{"Forehand"==i.stroke?("Drive"==i.stroke_type&&(n+="f"),"Drop Shot"==i.stroke_type&&(n+="u"),"Volley"==i.stroke_type&&(n+="v"),"Slice"==i.stroke_type&&(n+="r"),"Overhead"==i.stroke_type&&(n+="o"),"Lob"==i.stroke_type&&(n+="l"),"Other"==i.stroke_type&&(n+="q")):"Backhand"==i.stroke&&("Drive"==i.stroke_type&&(n+="b"),"Drop Shot"==i.stroke_type&&(n+="y"),"Volley"==i.stroke_type&&(n+="z"),"Slice"==i.stroke_type&&(n+="s"),"Overhead"==i.stroke_type&&(n+="p"),"Lob"==i.stroke_type&&(n+="m"),"Other"==i.stroke_type&&(n+="q")),i.error&&(n+=i.error),x.rally?x.rally.push(n):x.rally=[n],"Forcing Error"==i.result&&(x.result="Forced Error",x.rally?x.rally.push("#"):x.rally=["q#"])}}function d(e,t){var r=+e[5];x.winner="T"==e[1]?0:1,(x.server!=x.last_shot&&r%2||x.server==x.last_shot&&!(r%2))&&(r+=1);
var n=r-(x.rally.length+1);n>0&&(x.rally=new Array(n).fill("q").concat(x.rally)),0==x.rally.length&&0==x.serves.length&&(x.serves=x.server==x.winner?["S"]:["R"]),x.terminator&&(x.rally.length?x.rally[x.rally.length-1]+=x.terminator:x.serves.length&&(x.serves[x.serves.length-1]+=x.terminator)),v(),x.code=g(x),y.push(x),x=h()}function h(){return{serve:1,serves:[],rally:[],shots:[]}}function m(){a()}function v(){function e(e){return a.x1&&a.x2&&a.y1&&a.y2?"("+[a.x1,a.y1,a.x2,a.y2].join(",")+")":""}var t=[],r=[],n=[];if(x.shots.forEach(function(e){"Serve"!=e.stroke&&"Missed"!=e.stroke?n.push(e):"First Serve"==e.stroke_type?t.push(e):r.push(e)}),n.length){var a=n[0];x.rally[0]+=e(a)}if(2==n.length){var a=n[1],i=x.rally.length-1;x.rally[i]+=e(a)}if(t.length){var a=p(t);if(r.length){var i=x.first_serve.serves.length-1;x.first_serve.serves[i]+=e(a)}else{var i=x.serves.length-1;x.serves[i]+=e(a)}}if(r.length){var a=p(r),i=x.serves.length-1;x.serves[i]+=e(a)}}function g(e){var t=e.first_serve?e.first_serve.serves.join("")+"|":"";return t+=e.serves.join(""),t+=e.rally.join("")}e();var y=[],x=h(),b={Header:n,Server:o,"Match Details":l,Format:c,"Start Time":s,Shot:u,Point:d,Match:m};d3.csv.parseRows(r,function(e,t){"function"==typeof b[e[0]]&&b[e[0]](e,t)}),y.forEach(function(e){i(e)})};var P;if("undefined"!=typeof window.DOMParser)P=function(e){return(new window.DOMParser).parseFromString(e,"text/xml")};else{if("undefined"==typeof window.ActiveXObject||!new window.ActiveXObject("Microsoft.XMLDOM"))throw new Error("No XML parser found");P=function(e){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}}var R=["del","de","di","du","van","von","ten"];f.loaders=Object.keys(f).filter(function(e){return f[e].file_format}),"function"==typeof define&&define.amd?define(f):"object"==typeof module&&module.exports&&(module.exports=f),this.parsers=f}(),!function(){function e(e){var r=e.yyyymmdd();return t(r)}function t(e){e=e.toString();var t=e.slice(0,4)+"-"+e.slice(4,6)+"-"+e.slice(6);return t}function r(e,t,r,n){var r=r||"GET";if(["GET","POST"].indexOf(r)<0)return!1;if("function"!=typeof n)return!1;var a=new XMLHttpRequest;return a.open(r,e,!0),a.setRequestHeader("Content-Type","application/json"),a.onload=function(){n(a.responseText)},a.send(t),!0}function n(e,t){function n(e){console.log(e)}var a=e.doc[0].data.match._id;if(t){var o=JSON.stringify({data:e,action:"save",destination:"timeline/Matches",filename:"mt"+a});r("/api/match/push",o,"POST",n)}var s=e.doc[0].data.events.filter(function(e){return"first_server"==e.type});s=s.length?s[0].team:"home";var l="home"==s?0:1;i.umo&&i.umo.options({match:{first_service:l}}),pts=[];for(var c,u,d=1,p=e.doc[0].data.events,f=0;f<p.length;f++){var h=p[f];["service_taken","match_started","periodstart"].indexOf(h.type)>=0&&(c=h.uts),"first_serve_fault"==h.type&&(d=2),"score_change_tennis"==h.type&&(u=h.uts,point_time=c&&u?u-c:0,pts.push({team:h.team,service:d,ace:1==h.pointtype,df:2==h.pointtype,time:point_time,uts:h.uts}),d=1,c=u)}pts.forEach(function(e,t){var r="home"==e.team?0:1,n=(i.umo.push(r),i.umo.points()),a=n[n.length-1],o={score:a.score};if(o.uts=e.uts,o.time=e.time,i.umo.decoratePoint&&"2"==e.service){var s=a.code;e.df?(s="0e",o.result="Double Fault",o.serves=["0e"]):e.ace&&(s="0*",o.result="Ace",o.serves=["0*"]),o.code="0e|"+s,o.first_serve={error:"Error",serves:["0e"]}}else e.ace&&i.umo.decoratePoint&&"1"==e.service&&(o.code="0*",o.result="Ace",o.serves=["0*"]);i.umo.decoratePoint(t,o)}),i.uponCompletion&&i.uponCompletion()}function a(){i.umo&&(i.umo.options({match:{desc:i.meta.match_desc||"",sets:+i.meta.bestof||3,final_set_tiebreak:void 0==i.meta.final_set_tiebreak||i.meta.final_set_tiebreak,final_set_tiebreak_only:i.meta.final_set_tiebreak_only||!1,final_set_tiebreak_to:void 0==i.meta.final_set_tiebreak_to?7:+i.meta.final_set_tiebreak_to},set:{games:void 0==i.meta.setgames?12:i.meta.setgames,tiebreak:void 0==i.meta.tiebreak||i.meta.tiebreak,tiebreak_at:i.meta.tiebreak_at?+i.meta.tiebreak_at:i.meta.setgames?+i.meta.setgames/2:6,tiebreak_to:void 0==i.meta.tiebreak_to?7:+i.meta.tiebreak_to,advantage:void 0==i.meta.advantage||i.meta.advantage,lets:0!=i.meta.lets}}),i.umo.metadata({players:{0:{name:i.meta.players[0],fname:i.meta.p1fname||"",lname:i.meta.p1lname||"",fh:i.meta.p1hand},1:{name:i.meta.players[1],fname:i.meta.p2fname||"",lname:i.meta.p2lname||"",fh:i.meta.p2hand},2:{name:i.meta.players[2],fname:i.meta.p3fname||"",lname:i.meta.p3lname||"",fh:i.meta.p3hand},3:{name:i.meta.players[3],fname:i.meta.p4fname||"",lname:i.meta.p4lname||"",fh:i.meta.p4hand}},tournament:{name:i.meta.tournament,surface:i.meta.surface,round:i.meta.round},match:{date:i.meta.matchdate,court:i.meta.court,category:i.meta.category,umpire:i.meta.umpire},charter:i.meta.charter}),i.umo.update())}Date.prototype.yyyymmdd=function(){var e=this.getFullYear().toString(),t=(this.getMonth()+1).toString(),r=this.getDate().toString();return e+(t[1]?t:"0"+t[0])+(r[1]?r:"0"+r[0])};var i={};i.reset=function(){i.meta={players:{0:"Player One",1:"Player Two"}},i.umo&&i.umo.reset()};var o={};i.timeline=o,o.fetch=function(e){function t(e){var t=JSON.parse(e);o.info(aip.QueryString.timeline,t.data?JSON.parse(t.data):void 0)}i.reset();var n=JSON.stringify({type:"cache",cacheURL:"_timeline/Matches/mt"+e+".json"});r("/api/match/request",n,"POST",t)},o.data=function(e,t){if(t)n(t,0);else{var r="http://ls.sportradar.com/ls/feeds/?/betfair/en/Europe:Berlin/gismo/match_timeline/"+e;d3.json(r,function(e){n(e,1)})}},o.info=function(t,n){function s(e){var t=JSON.parse(e);t.data&&l(JSON.parse(t.data))}function l(s){function l(e){console.log(e)}if(!s)return i.umo&&i.umo.options({match:{sets:5}}),void o.data(aip.QueryString.timeline);if(!n){var c=JSON.stringify({data:s,action:"save",destination:"timeline/Matches",filename:"mi"+t});r("/api/match/push",c,"POST",l)}var u=s.doc[0].data,d=u.match._dt.uts,p=new Date(0);p.setUTCSeconds(d),i.meta.matchdate=e(p),i.meta.players=[];var f=u.match.teams.home,h=u.match.teams.away;f.children?(i.meta.players[0]=f.children[0].name.split(",").reverse().join(" ").trim(),i.meta.players[2]=f.children[1].name.split(",").reverse().join(" ").trim()):i.meta.players.push(f.name.split(",").reverse().join(" ").trim()),h.children?(i.meta.players[1]=h.children[0].name.split(",").reverse().join(" ").trim(),i.meta.players[3]=h.children[1].name.split(",").reverse().join(" ").trim()):i.meta.players.push(h.name.split(",").reverse().join(" ").trim()),i.meta.tiebreak=!!u.match.coverage.tiebreak,i.meta.final_set_tiebreak=!!u.match.coverage.tiebreak,i.meta.final_set_tiebreak_only=10==+u.match.coverage.tiebreak,i.meta.final_set_tiebreak_to=10==+u.match.coverage.tiebreak?10:7,i.meta.advantage=1==u.match.coverage.advantage,i.meta.round=u.match.roundname.shortname||"",i.meta.tournament=u.tournament.tennisinfo.name||u.tournament.name,i.meta.category=u.tournament.tennisinfo.gender[0],i.meta.bestof=u.tournament.tennisinfo.sets,i.meta.court=u.stadium?u.stadium.name:"",i.meta.surface=u.tournament.ground.main,i.meta.status=u.match.status.name,a(),o.data(aip.QueryString.timeline,n)}if(n){var c=JSON.stringify({type:"cache",cacheURL:"_timeline/Matches/mi"+t+".json"});r("/api/match/request",c,"POST",s)}else{var u="http://ls.sportradar.com/ls/feeds/?/betfair/en/Europe:Berlin/gismo/match_info/"+t;d3.json(u,l)}};var s={};i.tennisMath=s,s.process=function(e){i.reset(),i.umo&&i.umo.options({match:{sets:5}}),s.info(e)},s.data=function(e){function t(t){function n(t){var r=JSON.parse(t),n=/site\snot\sfound/;r.data&&!n.test(r.data)?(s.processData(JSON.parse(r.data),e),s.save&&s.save(e,r.data,"tennismath","ml")):i.uponCompletion&&i.uponCompletion()}var a=JSON.parse(t);if(a.data){var o=JSON.parse(a.data);"object"!=typeof o&&(o=JSON.parse(o)),s.processData(o,e)}else{var l=JSON.stringify({matchURL:"http://app.tennis-math.com/matchlog/"+e+".json"});r("/api/match/request",l,"POST",n)}}var n=JSON.stringify({type:"cache",cacheURL:"_tennismath/ml"+e+".json"});r("/api/match/request",n,"POST",t)},s.processData=function(e,t){for(var r,n,a=e.children,o=/(\w+)\sis\sserving/,s=String.fromCharCode(8226),l=i.meta.p1fname!=i.meta.p2fname,c=0;c<a.length;c++){n=!1;for(var u=a[c].children,d=0;d<u.length;d++){var p=u[d].header;if(void 0==r&&o.test(p)&&l){var f=o.exec(p)[1];r=f==i.meta.p2fname?1:0,i.umo&&i.umo.options({match:{first_service:r}})}p.indexOf("TIE-BREAK")>=0&&(n=!0);for(var h=n?["0T","0T"]:["0","0"],m=u[d].children,v=0;v<m.length;v++){var g={};g.serve=1;var y=[];g.rally=[];for(var p=m[v].header,x=p.split("/font")[0],b=which_serve=0;b<x.length;which_serve+=+(s===x[b++]));for(var b=q_serve=0;b<x.length;q_serve+=+("?"===x[b++]));if(2!=which_serve&&2!=q_serve||(g.first_serve={error:"Unknown"},g.serve=2),void 0==r&&p.indexOf("Serving sequence is changed")>=0)i.umo&&i.umo.options({match:{first_service:1}});else{var w=i.umo?i.umo.nextService():void 0;if(p=p.split("(!)").join(""),y=p.split(":"),!(y.length<2)){y[0]=y[0].split(" ").reverse()[0],y[1]=y[1].split(" ")[0];var _=void 0;n?h[0]!=y[0]&&h[1]==y[1]?_=w?"receiver":"server":h[1]!=y[1]&&h[0]==y[0]&&(_=w?"server":"receiver"):"A"==h[0]||"A"==h[1]?"+"==y[0]||"A"==h[1]&&"40"==y[1]?_="server":("+"==y[1]||"A"==h[0]&&"40"==y[0])&&(_="receiver"):"+"==y[0]||h[0]!=y[0]&&h[1]==y[1]?_="server":("+"==y[1]||h[1]!=y[1]&&h[0]==y[0])&&(_="receiver"),h=y;var k=p.indexOf("volley")>=0,S=p.indexOf("smash")>=0,O=p.indexOf("drop-shot")>=0,A="receiver"==_?"":"q",T="q";p.indexOf("FH")>0&&(T=k?"v":S?"o":O?"u":"f"),p.indexOf("BH")>0&&(T=k?"z":S?"p":O?"y":"b"),p.indexOf("double fault")>0&&(g.code="0e|0e"),p.indexOf("ace")>0&&(g.code=1==g.serve?"0*":"0e|0*",g.terminator="*"),p.indexOf("winner")>0&&(g.terminator="*"),p.indexOf("unforced error")>0&&(A+="q",g.terminator="@"),p.indexOf(" forced error")>0&&(A+="q",g.terminator="#"),p.indexOf("return error")>0&&(A="",g.terminator="@"),g.code||(A+=T,A+=g.terminator,g.code=1==g.serve?"0"+A:"0e|0"+A);var g=sequences.pointParser(g.code.split("|"));if(i.umo){i.umo.push(g)}}}}}}i.uponCompletion&&i.uponCompletion()},s.save=function(e,t,n,a){function i(e){console.log(e)}var o=JSON.stringify({data:t,action:"save",destination:n,filename:a+e,file_type:".json"});r("/api/match/push",o,"POST",i)},s.info=function(e){function t(t){function n(t){var r=JSON.parse(t);s.save&&s.save(e,r.data,"tennismath","mi"),r.data&&s.processInfo(e,JSON.parse(r.data))}var a=JSON.parse(t);if(a.data){var i=JSON.parse(a.data);"object"!=typeof i&&(i=JSON.parse(i)),s.processInfo(e,i)}else{var o=JSON.stringify({matchURL:"http://app.tennis-math.com/matchinfo/"+e+".json"});r("/api/match/request",o,"POST",n)}}var n=JSON.stringify({type:"cache",cacheURL:"_tennismath/mi"+e+".json"});r("/api/match/request",n,"POST",t)},s.processInfo=function(t,r){r.note&&(i.meta.tournament=r.note),r.t1p1.playerSex&&(i.meta.category=r.t1p1.playerSex[0]);var n=r.t1p1?r.t1p1.firstName+" "+r.t1p1.lastName:"",o=r.t2p1?r.t2p1.firstName+" "+r.t2p1.lastName:"";if((n||o)&&(i.meta.players=[n,o]),i.meta.p1fname=r.t1p1.firstName,i.meta.p2fname=r.t2p1.firstName,i.meta.p1lname=r.t1p1.lastName,i.meta.p2lname=r.t2p1.lastName,r.date){var l=new Date(r.date);i.meta.matchdate=e(l)}r.t1p1.playerHanded&&(i.meta.p1hand=r.t1p1.playerHanded[0]),r.t2p1.playerHanded&&(i.meta.p2hand=r.t2p1.playerHanded[0]),r.surface&&(i.meta.surface=r.surface),i.meta.advantage="REGULAR"==r.rule.deuce,i.meta.bestof=+r.rule.amountOfSets.split("_")[2],i.meta.match_desc=r.rule.name,i.meta.setgames=2*+r.rule.firstToGames.split("_")[2],"NONE"!=i.meta.tiebreak,i.meta.tiebreak_to=+r.rule.tieBreakPoints.split("_")[1],i.meta.tiebreak_at="TB_AT_FIRST_TO"!=+r.rule.tieBreak?i.meta.tiebreak_to-1:i.meta.tiebreak_to,a(),s.data(t)};var l={};i.tennisSB=l,l.process=function(e){function t(t){var r=JSON.parse(t);l.info(e,r)}i.reset(),r("/lib/ex/tsbrules.json","","GET",t)},l.data=function(e,t){function n(n){function a(r){var n=JSON.parse(r),a=/site\snot\sfound/;n.data&&!a.test(n.data)?(l.processData(JSON.parse(n.data),e),"MATCH POINT"==t.datajson.statusstr&&l.save(e,n.data,"tsb","gamedetail")):i.uponCompletion&&i.uponCompletion()}var o=JSON.parse(n);if(o.data){var s=JSON.parse(o.data);"object"!=typeof s&&(s=JSON.parse(s)),l.processData(s,e)}else{var c=JSON.stringify({matchURL:"http://ts.nik.space/api/json?c=gamedetaillist&gamecode="+e});r("/api/match/request",c,"POST",a)}}var a=JSON.stringify({type:"cache",cacheURL:"_tsb/"+e+"_gamedetail.json"});r("/api/match/request",a,"POST",n)},l.processData=function(e,t){function r(e,t){2==a&&(e.code="0e|"+e.code),e.code&&(e=sequences.pointParser(e.code.split("|")));i.umo.push(e);a=1,e={}}e.reverse();var n={},a=1,o={1:"",2:"",3:"0e",4:"0*",5:"q@",6:"q*"};e.forEach(function(e,t){var s=1-e.jsondata.a.substr(1,1)%2,l=e.jsondata.a.substr(2,1),c=(e.jsondata.a.substr(4,1)-1,i.umo.nextService());n.code=o[l],"2"==l?a=2:"146".indexOf(l)>=0?(n.winner=s,"1"==l&&(n.code=c==n.winner?"S":"R"),"6"==l&&(n.code=(c==n.winner?"0q":"0")+n.code),r(n,t)):"35".indexOf(l)>=0&&(n.winner=1-s,"5"==l&&(n.code=(c==n.winner?"0":"0q")+n.code),r(n,t))}),i.uponCompletion&&i.uponCompletion()},l.save=function(e,t,n,a){function i(e){console.log(e)}var o=JSON.stringify({data:t,action:"save",destination:n,filename:e+"_"+a,file_type:".json"});r("/api/match/push",o,"POST",i)},l.info=function(e,t){function n(n){function a(r){var n=JSON.parse(r);if(n.data){var a=JSON.parse(n.data);"MATCH POINT"==a.datajson.statusstr&&l.save(e,n.data,"tsb","game"),l.processInfo(a,e,t)}else i.uponCompletion&&i.uponCompletion()}var o=JSON.parse(n);if(o.data){var s=JSON.parse(o.data);"object"!=typeof s&&(s=JSON.parse(s)),l.processInfo(s,e,t)}else{var c=JSON.stringify({matchURL:"http://ts.nik.space/api/json?c=game&gamecode="+e});r("/api/match/request",c,"POST",a)}}var a=JSON.stringify({type:"cache",cacheURL:"_tsb/"+e+"_game.json"});r("/api/match/request",a,"POST",n)},l.processInfo=function(t,r,n){var o=n.filter(function(e){return t.totalset==e.tid})[0];if(i.umo){var s=t.isservechanged?1:0;i.umo.options({match:{first_service:s}}),o&&(i.meta.advantage=0==o.advantagetype,i.meta.bestof=o.bestofsets,i.meta.match_desc=o.desc,i.meta.tiebreak=+o.tiebreaktype>0,i.meta.tiebreak_at=2==+o.tiebreaktype?+o.gamesperset-1:+o.gamesperset,i.meta.tiebreak_to=+o.tiebreakpoint,i.meta.setgames=2*o.gamesperset,2==o.finalsettype&&(i.meta.final_set_tiebreak_only=!0,i.meta.final_set_tiebreak_to=10),i.umo.options({set:{games:2*o.gamesperset}}))}t.address&&(i.meta.tournament=t.address);var c=t.player1name,u=t.player2name;if((c||u)&&(i.meta.players=[c,u]),t.wdate){var d=new Date(t.wdate);i.meta.matchdate=e(d)}a(),l.data(r,t)},"function"==typeof define&&define.amd?define(i):"object"==typeof module&&module.exports&&(module.exports=i),this.sources=i}(),!function(){function e(){var e=/^([0-9]|[a-z])+([0-9a-z]+)$/i,t=document.querySelector("#tmtCode");t&&e.test(t.value)&&t.value.length>9&&t.value.length<13?n():tsbCode.value.length>0?a():document.getElementById("upload_file").click()}function t(e){13==e.which&&n()}function r(e){13==e.which&&a()}function n(){var e=document.querySelector("#tmtCode");return!(e.value.length<10)&&(o.loadTennisMath&&o.loadTennisMath(),void(sources&&sources.tennisMath.process(e.value)))}function a(){var e=document.querySelector("#tsbCode");return!(e.value.length<3)&&(o.loadTennisScoreboard&&o.loadTennisScoreboard(),void(sources&&sources.tennisSB.process(e.value)))}function i(e){var t=[".csv"];if(parsers&&parsers.loaders.length&&parsers.loaders.forEach(function(e){t.push("."+e.toLowerCase())}),e.length>0){for(var r=!1,n=0;n<t.length;n++){var a=t[n];if(e.substr(e.length-a.length,a.length).toLowerCase()==a.toLowerCase()){r=a;break}}if(!r)return!1}return a.split(".").join("")}var o={uponCompletion:null,loadTennisMath:null,loadTennisScoreboard:null};o.umo=mo.matchObject(),o.uploadMatch=e,o.submitTMTcode=t,o.submitTSBcode=r,o.fetchTennisMath=n,o.fetchTennisScoreboard=a,upload_file.onchange=function(e){if(window.FileReader){o.umo.points([]),parsers&&(parsers.umo=o.umo);var t,r=new FileReader,n=(e.target.files[0],upload_file.value.split("\\")),a=n[n.length-1];if(r.onload=function(e){if(e.target.error)return void alert("Error while reading file");var a=e.target.result;if(parsers&&parsers.loaders.length&&parsers.loaders.indexOf(t.toUpperCase())>=0){var i=t+" LOADER....";aip&&aip.sendReport(i),parsers[t.toUpperCase()].parse(a)}if(2==r.readyState){o.uponCompletion&&o.uponCompletion();var s=document.getElementById("myModal");s.style.display="none"}var i="UPLOAD....."+n.join("");aip&&aip.sendReport(i)},t=i(a),!t)return void console.log("not a valid file type");if(parsers&&parsers.loaders.length&&parsers.loaders.indexOf(t.toUpperCase())>=0){var s=parsers[t.toUpperCase()].file_format;"text"==s?r.readAsText(e.target.files[0]):"binary"==s&&r.readAsBinaryString(e.target.files[0])}upload_file.value=""}},"function"==typeof define&&define.amd?define(o):"object"==typeof module&&module.exports&&(module.exports=o),this.readWrite=o}(),!function(){function e(e,t){t=t||"data.txt";var r=new Blob([e],{type:"text/plain"}),n=document.createElement("a");n.download=t,n.innerHTML="Download File",null!=window.URL?n.href=window.URL.createObjectURL(r):(n.href=window.URL.createObjectURL(r),n.onclick=destroyClickedElement,n.style.display="none",document.body.appendChild(n)),n.click()}function t(){var e=[],t=u.match_data,a=t.metadata(),i=t.options().match.first_service;e.push(a.players[i].name||""),e.push(a.players[1-i].name||""),e.push(a.players[i].hand||""),e.push(a.players[1-i].hand||""),e.push(a.match.category||""),e.push(a.match.date?n(a.match.date):""),e.push('"'+a.tournament.name+'"'||""),e.push(a.tournament.round||""),e.push(a.tournament.time||""),e.push(a.match.court||""),e.push(a.tournament.surface||""),e.push(a.match.umpire||""),e.push(a.charter||""),e.push(t.options().match.sets||""),e.push(t.options().match.final_set_tiebreak||"");var o="meta,1st,2nd\r\n",s=[];t.points().map(function(e){if(e.code)return e.code.split("|")}).filter(function(e){return e}).forEach(function(e){s.push(e.join(","))});var l=e.length>s.length?e.length:s.length;for(r=0;r<l;r++)o+=e[r]||"",o+=","+(s[r]||"")+"\r\n";return o}function n(e){return e.split("-").join("")}function a(t){var r=t.match_data,n=r.metadata(),a=n.match.date;if(r.points().length){var o=statistics.statObjects(r.points()),c=o.map(i).join(","),u=o.map(s).join(","),d=o.map(l).join(","),p="Match Date,Player,"+c+"\r\n";p+=a+","+n.players[0].name+","+u+"\r\n",p+=a+","+n.players[1].name+","+d+"\r\n";var f=(new Date).toDateString().split(" ").join("-")+"_";f+=n.players[0].name+"-"+n.players[1].name+".csv",e(p,f)}}function i(e){return e.pct?e.name+",% "+e.name:e.name}function o(e,t){return e.pct?e.numerator[t]+","+e.pct[t]:e.numerator[t]}function s(e){return o(e,0)}function l(e){return o(e,1)}function c(r){if(u.match_data=md=r.match_data,md.points().length){var n=(new Date).toDateString().split(" ").join("-")+"_",a=md.metadata().players;[a[0],a[1]].forEach(function(e){n+=e.name.split(" ").join("")+"_"}),n+="MCP.csv";var i=t();e(i,n);var o="DOWNLOAD....."+n;aip&&aip.sendReport(o)}}var u={};u.downloadStats=a,u.downloadMatch=c,this.saveMCP=u}(),d3.selection.prototype.translate=function(e){return this.attr("transform",function(t,r){return"translate("+["function"==typeof e?e.call(this,t,r):e]+")"})},d3.selection.prototype.tspans=function(e,t){return this.selectAll("tspan").data(e).enter().append("tspan").attr("class","sb-text").text(function(e){return e}).attr("x",0).attr("dy",function(e,r){return r?t||15:0})};var UUID=function(){for(var e={},t=[],r=0;r<256;r++)t[r]=(r<16?"0":"")+r.toString(16);return e.generate=function(){var e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,a=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&r]+t[r>>8&255]+"-"+t[r>>16&15|64]+t[r>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&a]+t[a>>8&255]+t[a>>16&255]+t[a>>24&255]},e}();!function(){horizonChart=function(){function e(e){e.each(function(){var e=d3.select(this).append("svg:g").attr("class","hcc").append("a");r=function(){function t(){b.domain(_.empty()?w.domain():_.extent());_.extent()}var r="horizontal"==i.display.orientation,l=r?i.height:i.width,c=i.display.ppp?i.display.ppp:l/a.length,u=r?c*a.length:i.width,d=r?i.height:c*a.length;e.attr("xlink:href",s.xlink.click).attr("width",u).attr("height",d).attr("transform","translate("+ +i.position.x+","+ +i.position.y+")").on("click",function(){s.chart.click&&s.chart.click(n)});var p=d3.extent(a.map(function(e){return e[0]})),f=d3.extent(a.map(function(e){return e[1]})),h=d3.scale.linear().domain(p).range([0,c*a.length]),m=d3.scale.linear().domain([0,i.bounds.vRangeMax?i.bounds.vRangeMax:f[1]]).range([0,l*i.display.bands]);if(r)var v="offset"==i.display.mode?function(e){return"translate(0, "+(e+(e<0)-i.display.bands)*l+")"}:function(e){return(e<0?"scale(1,-1)":"")+"translate(0, "+(e-i.display.bands)*l+")"};else var v="offset"==i.display.mode?function(e){return"translate("+(e+(e<0)-i.display.bands)*l+", 0)"}:function(e){return(e<0?"scale(-1,1)":"")+"translate("+(e-i.display.bands)*l+", 0)"};var g=e.selectAll("defs").data([null]);g.enter().append("defs").append("clipPath").attr("id","horizon_clip"+i.id).append("rect").attr("width",u).attr("height",d),g.select("rect").transition().duration(i.display.transition_time).attr("width",u).attr("height",d),e.selectAll("g").data([null]).enter().append("g").attr("clip-path","url(#horizon_clip"+i.id+")");var y=e.select("g").selectAll("path").data(d3.range(-1,-i.display.bands-1,-1).concat(d3.range(1,i.display.bands+1)),Number);if(r)var x=d3.svg.area().interpolate(i.display.interpolate).x(function(e){return h(e[0])}).y0(l*i.display.bands).y1(function(e){return l*i.display.bands-m(e[1])})(a);else var x=d3.svg.area().interpolate(i.display.interpolate).y(function(e){return h(e[0])}).x0(l*i.display.bands).x1(function(e){return l*i.display.bands-m(e[1])})(a);if(y.enter().append("path").style("fill",o).attr("transform",v).attr("d",x),y.exit().remove(),y.on("mouseover",function(){s.path.mouseover&&s.path.mouseover(n)}).on("mouseout",function(e,t){s.path.mouseout&&s.path.mouseout(e,t,this)}).transition().duration(i.display.transition_time).style("fill",o).attr("transform",v).attr("d",x),i.elements.brush){var b=d3.scale.linear().domain(p).range([0,u]),w=d3.scale.linear().domain(b.domain()).range([0,u]),_=d3.svg.brush().x(w).on("brush",t);e.append("g").attr("class","brush"+i.id).style({stroke:"#fff","fill-opacity":.125,"shape-rendering":"crispEdges"}).call(_).selectAll("rect").attr("y",-6).attr("height",i.height+7)}else e.select(".brush"+i.id).remove()}})}function t(e,r){if(e&&r)for(var n=Object.keys(e),a=Object.keys(r),i=0;i<n.length;i++)if(a.indexOf(n[i])>=0){var o=r[n[i]],s=e[n[i]];"object"==typeof o&&"function"!=typeof s&&o&&o.constructor!==Array?t(e[n[i]],r[n[i]]):r[n[i]]=e[n[i]]}}var r,n,a=[],i={id:0,width:960,height:100,position:{x:0,y:0},elements:{brush:!1},display:{ppp:void 0,bands:1,mode:"mirror",orientation:"horizontal",transition_time:0,interpolate:"basis"},bounds:{vRangeMax:void 0}},o=d3.scale.linear().domain([-i.display.bands,0,0,i.display.bands]).range(["#08519c","#bdd7e7","#bae4b3","#006d2c"]),s={update:{begin:null,end:null},chart:{click:null},path:{mouseover:null,mouseout:null},xlink:{click:null},brush:{update:null}};return e.options=function(r){return arguments.length?(t(r,i),e):i},e.events=function(r){return arguments.length?(t(r,s),e):s},e.width=function(t){return arguments.length?(i.width=t,e):i.width},e.height=function(t){return arguments.length?(i.height=t,e):i.height},e.data=function(t){return arguments.length?(t.constructor===Function&&(n=t),e):n},e.sdata=function(t){return arguments.length?(t.constructor===Array&&(a=t),e):a},e.update=function(e){s.update.begin&&s.update.begin(),"function"==typeof r&&r(e),setTimeout(function(){s.update.end&&s.update.end()},i.display.transition_time)},e.bands=function(t){return arguments.length?(i.display.bands=+t,o.domain([-i.display.bands,0,0,i.display.bands]),e):i.display.bands},e.mode=function(t){return arguments.length?(i.display.mode=t+"",e):i.display.mode},e.duration=function(t){return arguments.length?(i.display.transition_time=+t,e):i.display.transition_time},e.orientation=function(t){return arguments.length?(i.display.orientation=t+"",e):i.display.orientation},e.colors=function(t){return arguments.length?(o.domain([-i.display.bands,0,0,i.display.bands]),o.range(t),e):o.range()},e}}(),function(){ptsHorizonGroup=function(){function e(e){e.each(function(){var t=e.append("div").attr("id","ptsHorizonGroup"+a.id);r=function(r){e.each(function(){if(a.display.sizeToFit||r&&r.sizeToFit){var i=e.node().getBoundingClientRect();horizontal?a.width=Math.max(i.width,100):a.height=Math.max(i.height,80)}t.selectAll(".hz"+a.id).remove(),n.forEach(function(e,r){var n=t.append("div").attr("class","flex-chart-group hz"+a.id).attr("id","hz"+a.id+"x"+r),i=e.horizon.data().score(),o=(i.winner+" d. "+i.loser,e.horizon.data().metadata()),s=e.horizon.data().score().match_score;o.tournament.round+": "+s;n.append("div").attr("class","flex-h-score").append("p").text(e.score).style("color",function(){return e.won?"green":"red"}).on("click",function(){}),n.append("div").attr("class","flex-h-pts").call(e.horizon),e.horizon.update()})})}})}function t(e,r){if(e&&r)for(var n=Object.keys(e),a=Object.keys(r),i=0;i<n.length;i++)if(a.indexOf(n[i])>=0){var o=r[n[i]],s=e[n[i]];"object"==typeof o&&"function"!=typeof s&&o.constructor!==Array?t(e[n[i]],r[n[i]]):r[n[i]]=e[n[i]]}}var r,n=[],a={id:0,width:900,height:80,margins:{spacing:10},display:{ppp:void 0,bands:3,mode:"mirror",orientation:"horizontal",transition_time:1e3,interpolate:"basis",sizeToFit:!1},bounds:{vRangeMax:24},color:{range:["#6b6ecf","#f0f0f0","#f0f0f0","#a55194"]}},i={update:{begin:null,end:null}};return e.options=function(r){return arguments.length?(t(r,a),e):a},e.events=function(r){return arguments.length?(t(r,i),e):i},e.data=function(t){return arguments.length?(n=t,e):n},e.update=function(e){i.update.begin&&i.update.begin(),r(e),setTimeout(function(){i.update.end&&i.update.end()},a.display.transition_time)},e.colors=function(t){return arguments.length?(a.color.range=[t[0],"#f0f0f0","#f0f0f0",t[1]],n.forEach(function(e){e.colors(t)}),e):[a.color.range[0],a.color.range[3]]},e},ptsHorizon=function(){function e(e){s.chart.click&&s.chart.click({umo:e})}function t(t){t.each(function(){function t(e){for(var t=[],r=[],n=e.sets(),a=0;a<n.length;a++)t=t.concat(n[a].player_data()[0].map(function(e){return e.pts})),r=r.concat(n[a].player_data()[1].map(function(e){return e.pts}));gai=function(e,t){return e.reduce(function(e,r,n){return r===t&&e.push(n),e},[])};var i=gai(t,0).concat(gai(r,0));i.sort(function(e,t){return e-t}),i.indexOf(t.length-1)<0&&i.push(t.length-1);var o=t.map(function(e,t){return e-r[t]}),s=i.map(function(e,t){return o.slice(0==t?0:i[t-1]+1,e+1)});return s}for(var r=d3.select(this),c=r.append("svg").attr("id","ptsHorizon"+o.id),u=0;u<5;u++)i[u]=c.append("g").attr("id","horizon"+o.id+u).style("display","none"),i[u].call(l[u]);a=function(a){function u(){k.domain(O.empty()?S.domain():O.extent()),s.brush.brushing&&s.brush.brushing(O.extent())}function d(){k.domain(O.empty()?S.domain():O.extent()),s.brush.start&&s.brush.start(O.extent())}function p(){k.domain(O.empty()?S.domain():O.extent()),s.brush.end&&s.brush.end(O.extent())}o.elements.brush&&(o.margins.spacing=0);var f="horizontal"==o.display.orientation;if(o.display.sizeToFit||a&&a.sizeToFit){var h=r.node().getBoundingClientRect();f?o.width=Math.max(h.width,100):o.height=Math.max(h.height,80)}var m=t(n),v=m.map(function(e){return e.length}).reduce(function(e,t){return e+t}),g=f?o.width:o.height,y=(g-m.length*o.margins.spacing)/v;c.attr("id","ptsHorizon"+o.id).attr("width",o.width).attr("height",o.height);for(var x=0,b=0,w=0;w<l.length;w++)if(m[w]){var _=m[w].map(function(e,t){return[t+1,e]});if(!_.length)continue;l[w].height(o.height).width(o.width).options({id:o.id+"c"+w,display:{ppp:y,bands:o.display.bands,orientation:o.display.orientation},position:{x:o.position.x+x,y:o.position.y+b},bounds:{vRangeMax:o.bounds.vRangeMax}}).events({chart:{click:e},path:{mouseover:o.elements.brush?void 0:s.mouseover,mouseout:o.elements.brush?void 0:s.mouseout}}).duration(o.display.transition_time).colors(o.color.range).mode(o.display.mode).data(n).sdata(_).update(),"horizontal"==o.display.orientation?x+=y*m[w].length+o.margins.spacing:b+=y*m[w].length+o.margins.spacing,i[w].style("display","inline")}else i[w].style("display","none");if(o.elements.brush){var k=d3.scale.linear().domain([0,v]).range([0,o.width]),S=d3.scale.linear().domain(k.domain()).range([0,o.width]),O=d3.svg.brush().x(S).on("brush",u).on("brushstart",d).on("brushend",p),A=c.selectAll(".brush"+o.id);A.remove(),c.append("g").attr("class","brush"+o.id).style({stroke:"#fff","fill-opacity":.125,"shape-rendering":"crispEdges"}).call(O).selectAll("rect").attr("y",-6).attr("height",o.height+7)}else c.select(".brush"+o.id).remove()}})}function r(e,t){if(e&&t)for(var n=Object.keys(e),a=Object.keys(t),i=0;i<n.length;i++)if(a.indexOf(n[i])>=0){var o=t[n[i]],s=e[n[i]];"object"==typeof o&&"function"!=typeof s&&o.constructor!==Array?r(e[n[i]],t[n[i]]):t[n[i]]=e[n[i]]}}for(var n,a,i=[],o={id:0,width:900,height:80,margins:{spacing:10},position:{x:0,y:0},elements:{brush:!0},display:{ppp:void 0,bands:3,mode:"mirror",orientation:"horizontal",transition_time:1e3,interpolate:"basis",sizeToFit:!1},bounds:{vRangeMax:24},color:{range:["#6b6ecf","#f0f0fa","#f6edf4","#a55194"]}},s={update:{begin:null,end:null},brush:{brushing:null,start:null,end:null},chart:{click:null},mouseover:void 0,mouseout:void 0},l=[],c=0;c<5;c++)l.push(horizonChart());return t.options=function(e){return arguments.length?(r(e,o),t):o},t.events=function(e){return arguments.length?(r(e,s),t):s},t.width=function(e){return arguments.length?(o.width=e,t):o.width},t.height=function(e){return arguments.length?(o.height=e,t):o.height},t.data=function(e){return arguments.length?(n=e,t):n},t.update=function(e){s.update.begin&&s.update.begin(),"function"==typeof a&&a(e),setTimeout(function(){s.update.end&&s.update.end()},o.display.transition_time)},t.bands=function(e){return arguments.length?(o.display.bands=+e,t):o.display.bands},t.mode=function(e){return arguments.length?(o.display.mode=e+"",t):o.display.mode},t.duration=function(e){return arguments.length?(o.display.transition_time=+e,t):o.display.transition_time},t.orientation=function(e){return arguments.length?(o.display.orientation=e+"",t):o.display.orientation},t.colors=function(e){return arguments.length?(o.color.range=[e[0],"#f0f0f0","#f0f0f0",e[1]],t):[o.color.range[0],o.color.range[3]]},t}}(),!function(){function getStorage(){var e;try{localStorage.setItem("storage",""),localStorage.removeItem("storage"),e=window.localStorage}catch(t){e=new LocalStorageAlternative}return e}function LocalStorageAlternative(){var e={};this.setItem=function(t,r){e[t]=r},this.getItem=function(t){return"undefined"!=typeof e[t]?e[t]:null},this.removeItem=function(t){e[t]=void 0}}function initAwesomeplete(){var e=document.getElementById("thePlayer");e&&new Awesomplete(document.getElementById("thePlayer"),{list:playerlist}),"object"==typeof playerlist&&playerlist.length?activateSearch():interact.dbUpdate()}function fetchPlayerDB(){var ajax=new XMLHttpRequest;ajax.open("GET","/api/pldb/",!0),ajax.onload=function(){playerlist=eval(ajax.responseText).map(function(e){return{value:e[0],label:e[0]+" <b>["+e[1]+"]</b>"}}),interact.storage.pldb=JSON.stringify(playerlist),initAwesomeplete()},ajax.send()}function initScript(){function e(){var e=window.innerWidth,t=document.getElementById("navmenu");if(t){var r=parseInt(t.style.width||250);r=e<=480?e:250,t.style.width=r+"px",t.style["margin-left"]="-"+r+"px"}}interact.storage.pldb?(playerlist=JSON.parse(interact.storage.pldb),initAwesomeplete()):fetchPlayerDB();var t=document.getElementById("panel");t&&(t.style.display="inline"),
modal=document.getElementById("myModal");for(var r=document.querySelectorAll(".modalInfo"),r=document.getElementsByClassName("modalInfo"),n=0;n<r.length;n++)r[n].addEventListener("click",function(){var e=this.getAttribute("info");showModal(e)},!1);for(var a=document.getElementsByClassName("launchSearch"),n=0;n<a.length;n++)a[n].addEventListener("click",launchSearch,!1);document.getElementById("closeModal").onclick=function(){interact.closeModal()},readWrite&&(readWrite.loadTennisMath=hideModal),readWrite&&(readWrite.loadTennisScoreboard=hideModal);var i=document.getElementById("menu");i&&(i.onclick=function(){interact.toggleMenu()}),window.addEventListener("resize",e,!1)}function pageFullyLoaded(){fullyLoaded=!0}function activateSearch(){for(var e=document.querySelectorAll(".fully-loaded"),t=0;t<e.length;t++)e[t].style.display="inline"}function launchSearch(){var e=document.getElementById("myModal");e.style.display="none",search&&search.toggleSearch("open"),interact.toggleMenu("close")}function showModal(e,t){var r=1==e.split(" ").length;if((!r||modalText[e])&&modal&&e){interact.events.showModal&&interact.events.showModal(),search&&search.toggleSearch&&search.toggleSearch("close"),interact.toggleMenu("close");var n=document.getElementById("modalText");if(n.innerHTML=r?modalText[e]:e,modal.style.display="block",r)var a=e;else var a=t||"Undefined";var i=("Modal Display: "+a).replace(/\ /g,"_");aip&&aip.sendReport(i)}}function hideModal(){var e=document.getElementById("myModal");e.style.display="none"}function toggleMenu(e){var t=window.innerWidth,r=document.getElementById("navmenu"),n=window.getComputedStyle(navmenu).getPropertyValue("margin-left").match(/\d/g).join("")*-1,a=parseInt(r.style.width||250),a=t<=480?t:250;return r.style.width=a+"px","close"==e?r.style["margin-left"]="-"+a+"px":"open"==e?(r.style["margin-left"]="0px",search&&search.toggleSearch("close")):(r.style["margin-left"]=n<0?"0px":"-"+a+"px",search&&search.toggleSearch("close")),!1}var interact={};interact.storage=getStorage();var playerlist,fullyLoaded=!1,modal;interact.events={showModal:null},location.origin.indexOf("localhost")<0&&(!function(e,t,r,n,a,i,o){e.GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,i=t.createElement(r),o=t.getElementsByTagName(r)[0],i.async=1,i.src=n,o.parentNode.insertBefore(i,o)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-65756694-2","auto"),ga("send","pageview")),document.addEventListener("DOMContentLoaded",initScript),interact.closeModal=function(){modal.style.display="none"},window.addEventListener("load",pageFullyLoaded,!1),interact.launchSearch=launchSearch,interact.notFound=function(){showModal("notfound")},interact.dbUpdate=function(){showModal("dbupdate")},interact.showModal=showModal,interact.toggleMenu=toggleMenu;var notice=' <div><input type="image" src="/splash/Search Icon.png" onclick="interact.launchSearch()" width="20"> <b><i>For interactive charts, search for a player.</i></b> <input type="image" src="/splash/Search Icon.png" onclick="interact.launchSearch()" width="20"></div>',notice="",modalText={PTS:"<h2>Points to Set</h2>"+notice+'<p>"Points-to-Set" presents a visual summary of a tennis match and attempts to capture something of the dynamics of Point Progression during play.</p><center><img class="img-responsive" style="max-width: 600px" src="/splash/pts-1.jpg" alt="Points To Set"> </center> <p> To win a standard Set in a tennis match a player must, at a minimum, win six games and be ahead by two games.  Four points must be won in each game; the minimum number of points necessary to win a standard set is therefore twenty-four.  </p> <p> We can think of the "Points to Set" number as the minimum distance from the current number of points won until the end of the Set; it always assumes the opponent wins no additional points. Any points won in a game that is lost don\'t count. If a set is tied at five-five, an additional game, at least four more points, must be won; at six-six, at least seven more points must be won in a tiebreak.  </p> <center> <img class="img-responsive" style="max-width: 600px" src="/splash/pts-2.jpg" alt="Points To Set"> </center> <p> "Points to Set" provides a clearer indication of where two players stand than the more traditional "Total Points Won". "Points to Set" charts make it easy to see that two 6-3 sets can be very different, or that a 6-3 set can contain as many points as a 7-5 set.</p><p>The "Point to Set" component is interactive.  Hovering on the first point of each set displays winners (green) and errors (red) as well as rally lengths, if available. Hovering over the last point of each set highlights which games were won by each player.</p> <p>Read more about <a href="http://tennisviz.blogspot.hr/2015/08/points-to-set.html" target="_blank">Points to Set</a> on the <a href="http://tennisviz.blogspot.hr/2015/08/points-to-set.html" target="_blank">TennisVisuals Blog</a>.</p>',matchRadar:"<h2> Match Radar</h2>"+notice+'<p> The Match Radar is intended to provide a compact visual comparison of the key statistics for players of a tennis match, enabling a quick assessment of whether and how one player dominated another, whether a match was lob-sided, and where players differed on key statistics.  It is not intended as a tool for in-depth analysis.  </p> <p> The Match Radar <i>Reboot</i> introduces a new dynamic chart component.  In this example a layer depicting a player\'s average stats for a chosen time period has been added for comparision with player tournament and match performances.  </p><div class="flex-modal-parent"><div class="flex-modal-child"> <img class="img-responsive" style="max-width: 400px" src="/splash/MatchRadar.jpg" alt="Match Radar"></div></div> <p> View the published code for the <a target="_blank" href="http://bl.ocks.org/TennisVisuals/c591445c3e6773c6eb6f">Updating radarChart</a> at <a target="_blank" href="http://bl.ocks.org/TennisVisuals/">Bl.ocks.org</a> </p> <p> Read more about <a href="http://tennisviz.blogspot.hr/2015/08/match-radar.html" target="_blank">Match Radar</a> on the <a href="http://tennisviz.blogspot.hr" target="_blank">TennisVisuals Blog</a>.</p> ',gameTree:"<h2> Game Tree </h2>"+notice+'<p> "Game Tree" is a depiction of Point Progression for a selection of games within a tennis match or across a series of tennis matches.  Games start at \'0-0\' and "progress" through the tree until a player wins the game.  On the left is a composite view of all games served by Federer in his Round Robin match against Djokovic in the 2015 Tour Finals. On the right is a composite view of all of Djokovic\'s service games. </p><p><center> <img class="img-responsive" border="0" style="max-width: 400px" src="/splash/GT1.jpg" alt="Game Tree"><img class="img-responsive" style="max-width: 400px" border="0" src="/splash/GT2.jpg" alt="Game Tree"></center></p> <p> The thickness of the lines connecting any two scores indicates the number of points which "progressed" between the two nodes.  The color of the lines indicates the Percentage of points which were won due to  <font style="color: green">Winners</font> and <font style="color: red">Errors</font>.  </p> <p> The player you have searched for is represented by the <b><font style="color: purple">Purple</font></b> circles.  The opponent is in <b><font style="color: blue">Blue</font></b>.  The initial view is games served by your player.  The two circles in the upper left corner are "Selectors" where you can decide which player\'s serves you would like to view.  Deselecting both shows all points, regardless of server.  </p> <p> Hovering over Point Lines displays the number of points which "progressed" between two nodes; hovering over a Point Node displays the % of Games Won for the Primary Player (your search).  Depending on which player you have selected (using the Selectors) you can tell the % of games "Held" and "Broken" from any Point Score during a match or collection of matches.  </p> <p> Read more about <a href="http://tennisviz.blogspot.hr/2015/10/game-tree.html" target="_blank">"Game Tree"</a> on the <a href="http://tennisviz.blogspot.hr/2015/10/game-tree.html" target="_blank">TennisVisuals Blog</a>.  </p> <div id="footer"> Original design <a href="http://gamesetmap.com">&copy; GameSetMap</a>. Reproduced and enhanced with permission.</div>',rallyTree:"<h2> Rally Tree </h2>"+notice+' <p> Tennis is an "intermittent" sport.  The level of intensity can vary greatly with the rally length of points and the time taken between points (among other factors including surface, ball type, sex and level of play).  When rallies are visualized they are typically depicted temporally from the first point to the last, which gives a jagged chart where it is difficult to discern any pattern at all.  "Rally Tree" is an attempt to bring a different perspective to the analysis of rallies.  </p> <p> "Rally Tree" depicts the distribution of points across various rally lengths, beginning at the top with rally lengths of Zero, which indicate either Aces, Serve Winners, or Double Faults. Color coding differentiates errors where balls were "netted" vs. hit long.  </p> <img class="img-responsive" border="0" src="/splash/RT1.jpg" alt="Rally Tree"> <p> There are several available views.  The default view displays all points for a single match or selection of matches. You can filter by player to display only points served by either player (or composite of opponents).  </p> <p> Additionally there is an overlay depicting the percentage chance that a point was won for any given rally length. The offset vertical lines represent 50% either side of center (0%).  For the "served points" views, this gives a graphic representation of the Persistence of Server Advantage, which varies greatly among players. Please note that this is <i><b>not</b></i> the same as percentage of points won for a given rally length.  </p> <img class="img-responsive" border="0" src="/splash/RT2.jpg" alt="Rally Tree"> <p>In the near future "Rally Tree" will be integrated with "Game Tree" and other TAVA components so that selections in one component can drive views in another.  For instance, a "Point Progression" from 0-0 to 0-15 can be selected in "Game Tree" to view the distribution of points in the "Rally Tree" or "Points-to-Set".  From this point it will be possible to explore whether there are certain points in a match when rally lengths increase...  </p> <p>When "Tournament Views" are introduced, it will be possible to filter "Game Trees" and "Rally Trees" by Surface type.  </p> <p> To read more about <a href="http://www.tennisabstract.com/blog/2011/08/17/how-long-does-the-servers-advantage-last/" target="_blank"> "Persistence of Server Advantage"</a> please follow the link to Jeff Sackmann\'s blog post on the topic.</p>',ladderChart:'<h2> Ladder Chart </h2><p>The Ladder Chart provides a "roll-up" view of a player\'s tournament outcomes.  ATP and WTA Tournaments are represented as Circles, <b>colored</b> to indicate surface and <b>sized</b> to denote the rank of the tournament. Matches on the Challenger Tour are represented as Triangles, and Futures matches are represented as Square.</p><p>In the interactive views: <ol><li><b>View Matches</b> by clicking on a tournament</li><li><b>Zoom In</b> by clicking on Years on the lower Axis</li><li><b>Zoom Out</b> by clicking on the player name</li><li><b>Filter Rounds</b> by clicking on the left axis</li><li><b>Filter by Surface</b> by clicking Surface counters</li> <li><b>Filter by Opponent</b> click the Opponents counter and enter a name</li><li><b>Filter by Tournament</b> click the Tournament counter and enter a name</li> </ol> </p> <img class="img-responsive" border="0" src="/splash/ladderDemo.gif" alt="Ladder Chart"><p> </p> <p> Ladder Chart is based on a design by <a href="https://twitter.com/jburnmurdoch" target="_blank">John Burn-Murdoch</a> for <a href="https://ig.ft.com/sites/novak-djokovic-the-best-tennis-season-ever/" target="_blank"> The Financial Times </a>. The <a href="https://twitter.com/Renestance/status/668513083955027969" target="_blank">original design</a> was created by <a href="https://twitter.com/Renestance" target="_blank">Ren Denfeld</a> of <a href="http://www.insideout-tennis.de/" target="_blank">Inside-Out Tennis</a>.',pCoords:'<h2> Parallel Coordinates </h2><p>Parallel Coordinates is a method of visualizing multi-dimensional data; it becomes truly powerful as an interactive tool where various axes may be \'brushed\' to filter data by desired ranges of values.</p><p>The <b>average values</b> for all selected matches appears in <font color="blue">blue</font> below each axis.</p><p>In the interactive views: <ol><li><b>Filter Matches</b> by clicking and dragging along an axis</li><li><b>Clear Filters</b> by clicking anywhere on the axis outside the filter</li><li><b>Slide Filters</b> by \'grabbing\' and dragging them up or down an axis</li><li><b>Rearrange Axes</b> by \'grabbing\' axis titles and dragging them left or right</li><li><b>Select Dimensions</b> by clicking the <img border="0" src="/images/gear.png" width="12"> \'Settings\' icon on the right of the chart</li></ol> </p> <img class="img-responsive" border="0" src="/splash/pCoords.jpg" alt="Rally Tree"> <p>Match Surfaces are indicated by color and the Win/Loss % for each surface is displayed below the chart. </p>',horizon:"<h2> Horizon Graph </h2>"+notice+' <p> "Horizon Graphs" provide a condensed representation of the Points-to-Set chart, showing the difference between the Points-to-Set number for each player in a match.  The darker a player\'s color, the futher ahead they are in the set. At a glance it is possible to tell when the momentum changed in a match.   </p> <center> <img class="img-responsive" border="0" src="/splash/horizon.gif" alt="Horizon"> </center> <p>In match views "brushing" can be used with the Horizon Graph to select ranges of points. </p> <p> "Horizon Graphs" can be used to quickly compare a series of sets or matches, with enough detail to easily differentiate a 6-0, 6-0 win that was a "cakewalk" from a 6-0, 6-0 win where every game went to deuce and beyond.  </p> <p> Read more about <a href="http://tennisviz.blogspot.hr/2015/08/points-to-set-horizon-corona.html" target="_blank">"Horizon Graphs"</a> on the <a href="http://tennisviz.blogspot.hr/2015/08/points-to-set-horizon-corona.html" target="_blank">TennisVisuals Blog</a>.  </p>',coronaHorizon:'<h2>Corona Horizon</h2>The "Corona" is a Radial Horizon Graph intented to provide a compact, iconic representation of a match.<center> <div class="flex-modal-parent"> <div class="flex-modal-child"><img border="0" style="max-height: 180px" src="/splash/CH_Williams.jpg" alt="Corona"/></div> <div class="flex-modal-child"><img border="0" src="/splash/CH_Nadal.jpg" width="180" alt="Corona"/></div> <div class="flex-modal-child"><img border="0" src="/splash/CH_Halep.jpg" width="180" alt="Corona"/></div> </div></center> You can read about the origin of this graph on the <a href="http://tennisviz.blogspot.hr/2015/08/points-to-set-horizon-corona.html">TennisVisuals Blog</a> ',gameFish:"<h2>GameFish: Point Progression, Key Shots, Rallies</h2>"+notice+'<p>The GameFish visualization provides a single-glance overview of one game from a tennis match.  It is an enhancement of the standard score-matrix for tennis matches.</p><div class="flex-modal-parent"><div class="flex-modal-child"><img height="180px" src="/splash/GF-v.jpg"></div><div class="fles-child"></div></div><p> The boxes on the edges the graphic indicate which player was serving.  Light Green dots represent Service Winners; Yellow dots represent Serves that were "In"; Red dots represent faults.</p><p> The Game Grid in the center of the graphic indicates the winner of the point by cell color as well as the final "Key Shot" which determined the point winner.</p><p> Rally lengths are depicted with bluish-grey bars which appear "behind" the GameFish.</p>',sunburst:"<h2>Sunburst: Match at a Glance</h2>"+notice+'<p>The Sunburst was my very first experiment utilizing D3 to visualize a tennis match.  Eventually I will get around to re-writing it to fit in with the current trajectory of this site... but you can still read about it on the <a href="http://tennisviz.blogspot.hr/2015/07/sunburst-match-at-glance.html">TennisVisuals blog.</a> </p>',sankey:"<h2>Shot Explorer: Parallel Sets</h2>"+notice+'<p>The Shot Explorer was one of the earliest components I developed for visualizaing and interactively exporing all of the shots captured by ProTracker Tennis. It is currently being re-written and will reappear soon.  You can read about its functionality on the <a href="http://tennisviz.blogspot.hr/2015/08/shot-explorer-parallel-sets.html">TennisVisuals blog.</a> </p>',upload:' <h2>Match Upload</h2><b>*</b> Uploading files from popular tracking applications is an experimental feature.  The "Court View" is not yet available.</p> <p> <div class="flex-modal-parent"> <div class="flex-modal-icon"><table><tr><td> <input type="image" class="trackers" src="/splash/ptf.jpg" title="upload" onclick="readWrite.uploadMatch()" tabindex="-1"/> </td><td valigh="top"></td></tr></table></div> <div class="flex-modal-icon"><table><tr><td> <input type="image" class="trackers" src="/splash/mcp.jpg" title="upload" onclick="readWrite.uploadMatch()" tabindex="-1"/> </td><td valigh="top"></td></tr></table></div> <div class="flex-modal-icon"><table><tr><td> <input type="image" class="trackers" src="/splash/ttm.jpg" title="upload" onclick="readWrite.uploadMatch()" tabindex="-1"/> </td><td valigh="top"></td></tr></table></div> <div class="flex-modal-icon"><table><tr><td> <input type="image" class="trackers" src="/splash/mts.jpg" title="upload" onclick="readWrite.uploadMatch()" tabindex="-1"/> </td><td valigh="top"></td></tr></table></div> <div class="flex-modal-icon"><table><tr><td> <input type="image" class="trackers" src="/splash/esc.jpg" title="upload" onclick="readWrite.uploadMatch()" tabindex="-1"/> </td><td valigh="top"></td></tr></table></div> <div class="flex-modal-icon"><table><tr><td> <input type="image" class="trackers" src="/splash/tss.jpg" title="upload" onclick="readWrite.uploadMatch()" tabindex="-1"/> </td><td valigh="top"></td></tr></table></div> <div class="flex-modal-icon"><table><tr><td> <input type="image" class="trackers" src="/splash/smt.jpg" title="upload" onclick="readWrite.uploadMatch()" tabindex="-1"/> </td><td valigh="top"></td></tr></table></div> <div class="flex-modal-icon"><table><tr><td> <input type="image" class="trackers" src="/splash/tst.jpg" title="upload" onclick="readWrite.uploadMatch()" tabindex="-1"/> </td><td valigh="top"></td></tr></table></div> <div class="flex-modal-icon"><table><tr><td> <input type="image" class="trackers" src="/splash/tsp.jpg" title="upload" onclick="readWrite.uploadMatch()" tabindex="-1"/> </td><td valigh="top"></td></tr></table></div> </div> <div class="flex-modal-parent"> <div class="flex-modal-icon"><table><tr><td> <input type="image" class="trackers" src="/splash/tmt.jpg" onclick="readWrite.fetchTennisMath()" tabindex="-1"/> </td><td valigh="top"><p>enter code:<br><input id="tmtCode" onkeyup="readWrite.submitTMTcode(event)"></p></td></tr></table></div> <div class="flex-modal-icon"><table><tr><td> <input type="image" class="trackers" src="/splash/tsb.jpg" onclick="readWrite.fetchTennisScoreboard()" tabindex="-1"/> </td><td valigh="top"><p>enter code:<br> <input id="tsbCode" onkeyup="readWrite.submitTSBcode(event)"></p></td></tr></table></div> </div> </p> <button id="upload_button" class="btn upload-btn" alt="Upload File" onclick="readWrite.uploadMatch()" tabindex="-1">Upload File</button> ',tracking:' <h2>Match Tracking</h2><p>TennisVisuals supports the import of matches tracked by popular mobile apps such as <a href="http://www.fieldtown.co.uk/">ProTracker Tennis</a>. To import a match, click <input type="image" src="/images/ul.png" height="25" alt="upload" onclick="interact.showModal(\'upload\')"> and select a match from your file system. You can also enter match codes for matches tracked using <a href="http://tennismath.com/">TennisMath</a> and <a href="http://ts.nik.space/games">Tennis Scoreboard</a>.</p><p>For more advanced match tracking, you can try <a href="/CourtHive">CourtHive</a>. Read more about the impetus for <a href="/CourtHive">CourtHive</a> in <a href="https://medium.com/the-tennis-notebook/how-to-chart-a-match-cb52ab9f62e5#.2tt7js98b">How To Chart a Match.</a></p><a href="https://medium.com/the-tennis-notebook/how-to-chart-a-match-cb52ab9f62e5#.2tt7js98b"><p><center><img class="img-responsive" border="0" src="/splash/htcm.jpg" alt="ladderChart"></center></p></a>',faq:'<h2>Frequently Asked Questions</h2><ul> <li><h3><b>What is this?</b></h3>TennisVisuals is my playground.  I\'m learning D3.js (and a number of other related tools) while attempting to visualize data generated by tennis matches.</li> <li><h3><b>What\'s the Point?</b></h3>There is no commercial impetus to this endeavour. But there is a long-term vision which will radically reshape this project once I feel I have the chops to attempt it... </li> <li><h3><b>How do I use it?</b></h3>Start by searching for your favorite player.  If you don\'t know any player names, just start typing.  Names will be suggested. Matches appear organized by tournament on a timeline. Filter by selecting a surface, or entering an opponent or tournament name. Select a tournament to see a list of matches for your chosen player. <p><center> <img class="img-responsive" border="0" src="/splash/ladderDemo.gif" alt="ladderChart"> </center></p><p>When there are stats available for selected tournaments they are displayed below the tournament timeline in an interactive chart that enables further filtering.</p><p><center><img class="img-responsive" border="0" src="/splash/pCoords.jpg" alt="Rally Tree"></center></p> Horizon Charts for specific matches are presented after selecting a tournament in the tournament timeline or the stat browser. Click on a Horizon Chart for interactive visualizations of the match you want to explore.<p><center> <img class="img-responsive" border="0" src="/splash/tournamentHorizon.jpg" alt="tournamentHorizon"> </center></p> You can read about the other visualizations you will encounter in the Gallery on the TennisVisuals home page. Be sure to click around on the visualizations to interact with the data. The "Horizon Chart", for instance, is "brushable", meaning you can drag across it to select a range of points; other charts will update dynamically to reflect the points chosen.</p><p><center> <img class="img-responsive" border="0" src="/splash/interactive.gif" alt="Interactive Visualizations"> </center></p><p></li> <li><h3><b>Where does the data come from?</b></h3>At present the bulk of the data comes from the <a href="https://github.com/JeffSackmann/tennis_MatchChartingProject" target="_blank">Match Charting Project</a>.  When I get around to it I will add other data sources.  But you can chart your own matches using <a href="/CourtHive">CourtHive</a>, and matches exported from popular tracking applications such as ProTracker Tennis can be uploaded as well.</p><p><center><img class="img-responsive" border="0" src="/splash/trackers.jpg" alt="Tracking Applications"></center></p></li></ul>',notfound:"<center><h2>Oops... Match File Not Found</h2><center>",dbupdate:"<center><h2>Database Update in Progress... you can still upload files!</h2></center>"};this.interact=interact}();
