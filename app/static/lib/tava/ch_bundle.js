!function(){function e(){function e(){h.data(statistics.statObjects(r.points())),h.update()}function t(){y&&y.points(r.points()).update()}function n(){g&&g.update()}function l(e){"function"==typeof mcps.scrollTo&&mcps.scrollTo(e)}function i(){d.update()}function s(){if(E){var e=r.teams();E.options({labels:{Player:e[0],Opponent:e[1]}}),E.data(r.points()).update()}}function u(e){var t=d3.select("#pointDescription");t.html(e)}function v(){mcps.populateUMO(),mcps.update()}function b(){metaEdit.umo(r).init(),metaEdit.colors(p),metaEdit.onChange=v,mcps.callback(metaEdit.update),mcps.umo(r),o()}d3.select("#CHinstructions").html(m),mcps.colors=p,mcps.init(),mcps.events({pointDescription:u,finishedLoad:o}),mcps.callback(a),r=mo.matchObject(),c.match_data=r;var h=statView();h.options({colors:p,display:{responsive:!0}}),d3.select("#CHstatPanel").call(h),mcps.callback(e);var f=mOverview();d3.select("#CHmatchOverview").call(f),f.options({colors:p,display:{highlight_winner:!1,responsive:!0}}),mcps.callback(f.update),f.data(r).update();var y=rallyTree();y.width(350).height(300),y.options({data:{sort:!0},points:{colors:{Ace:"green","Serve Winner":"lightgreen",Winner:"seagreen","Forced Volley Error":"red","Forced Error":"orange","Forcing Error":"green","Passing Shot":"green",In:"yellow","Net Cord":"yellow","Double Fault":"red","Unforced Error":"red",Out:"coral",Netted:"red",Net:"red","Out Long":"red","Out Passing Shot":"red",OO:"red"}}}),d3.select("#CHrallytree").call(y),mcps.callback(t);var g=momentumChart();g.width(820).height(300),g.options({display:{sizeToFit:!1,continuous:!1,orientation:"horizontal",transition_time:1e3,service:!1,rally:!0,player:!1,grid:!1},colors:p}),g.data(r),d3.select("#CHmomentum").call(g),mcps.callback(n),d=ptsMatch(),d.width(820),d.options({height:60,resize:!1,display:{sizeToFit:!1}}),d.events({point_bars:{click:l}}),d.data(r),d3.select("#CHpts").call(d),mcps.callback(i),mr=RadarChart().options({legend:{display:!1},resize:!1}),d3.select("#CHbasestats").call(mr),mr.width(400).height(400).levels(6).update(),ss=RadarChart().options({legend:{display:!1},resize:!1}),d3.select("#CHservestats").call(ss),ss.width(400).height(400).levels(6).update();var E=GameTree(),M={display:{sizeToFit:!1},lines:{points:{winners:"green",errors:"#BA1212",unknown:"#2ed2db"},colors:{underlines:"black"}},nodes:{colors:{0:p[0],1:p[1],neutral:"#ecf0f1"}},selectors:{enabled:!0,selected:{0:!1,1:!1}}};E.options(M),E.width(350).height(350).update(),d3.select("#CHgametree").call(E),mcps.callback(s),readWrite&&(readWrite.umo=r,readWrite.uponCompletion=b),sources&&(sources.umo=r,sources.uponCompletion=b),parsers&&(parsers.umo=r,parsers.uponCompletion=b),mcps.umo(r,!1);var k=Object.keys(aip.QueryString);if(k.indexOf("timeline")>=0)aip&&aip.sendReport("TIMELINE...."+aip.QueryString.timeline),sources&&sources.timeline.fetch(aip.QueryString.timeline);else if(k.indexOf("tennis-math")>=0){aip&&aip.sendReport("TENNIS-MATH...."+aip.QueryString["tennis-math"]);var w=aip.QueryString["tennis-math"];sources&&sources.tennisMath.process(w)}else if(k.indexOf("tsb")>=0){aip&&aip.sendReport("Tennis Scoreboard...."+aip.QueryString.tsb);var w=aip.QueryString.tsb;sources&&sources.tennisSB.process(w)}else if(parsers&&parsers.loaders.length){var x=parsers.loaders.filter(function(e){return k.indexOf(e.toLowerCase())>-1&&"text"==parsers[e.toUpperCase()].file_format});x.length>0?d3.text("/mailcache/"+x[0].toLowerCase()+"/"+aip.QueryString[x[0].toLowerCase()],function(e,t){!e&&t?(mcps.reset(),parsers[x[0]].parse(t),parsers.uponCompletion()):e&&(mcps.reset(),interact.notFound())}):b()}else b()}function t(){mcps.reset(),aip&&aip.sendReport("RESET"),o(!0)}function a(){r.points().length?(d3.select("#download").style("display","inline"),d3.select("#upload").style("display","none")):(d3.select("#download").style("display","none"),d3.select("#upload").style("display","inline"),metaEdit.hide())}function n(){metaEdit.visible||metaEdit.show()}function l(){var e=r.teams(),t=statistics.counters(r.points()),a=statistics.baseStats(t),n=Object.keys(a[0]).filter(function(e){return 0==e.search("Pct")}),l=n.map(function(e){return{axis:e,value:void 0==a[0][e]?0:a[0][e]/100}}),i=n.map(function(e){return{axis:e,value:void 0==a[1][e]?0:a[1][e]/100}});mr.data([{key:e[0],values:l},{key:e[1],values:i}]),mr.update();var a=statistics.serveStats(t),n=Object.keys(a[0]).filter(function(e){return 0==e.search("Pct")}),l=n.map(function(e){return{axis:e,value:void 0==a[0][e]?0:a[0][e]/100}}),i=n.map(function(e){return{axis:e,value:void 0==a[1][e]?0:a[1][e]/100}});ss.data([{key:e[0],values:l},{key:e[1],values:i}]),ss.update()}function i(){var e=document.querySelector("#help");"none"==e.style.display||""==e.style.display?(d3.select("#help").style("display","inline"),d3.select("#charticon").style("display","inline"),d3.select("#chartselector").style("display","none"),aip&&aip.sendReport("HELP")):(d3.select("#help").style("display","none"),d3.select("#charticon").style("display","none"),d3.select("#chartselector").style("display","inline"))}function o(e){var t=document.querySelector("#CHinstructions");e||(t.style.display="none");var a=document.querySelector("#CHmomentum"),n=document.querySelector("#CHpts"),l=document.querySelector("#CHgametree"),i=document.querySelector("#CHrallytree");e||!r.points().length?(l.style.display="none",i.style.display="none",a.style.display="none",n.style.display="none",t.style.display="inline"):"inline"==l.style.display?(l.style.display="none",i.style.display="none",a.style.display="inline"):"inline"==a.style.display?(a.style.display="none",n.style.display="inline"):(n.style.display="none",l.style.display="inline",i.style.display="inline")}function s(){d3.select("#charticon").style("display","none"),pointHistory.style("display","inline")}var d,r,c={},p=["#a55194","#6b6ecf"];c.init=e,c.reset=t,c.editInfo=n,c.calcStats=l,c.toggleHelp=i,c.toggleCharts=o,c.showCharts=s;var u="",m='<p>If you\'re familiar with the <a target="_blank" href="http://www.tennisabstract.com/blog/2015/12/08/11-reasons-to-contribute-to-the-match-charting-project/"> The Match Charting Project</a>, you can begin charting immediately.  <p>Charts will appear once the first point is entered.  Use the chart icon <img src="/images/bar_chart_inline.png" height="20"> to toggle between charts.  To edit metadata about the match, including player names, click the <img src="/images/meta_inline.png" height="20"> icon.  If you don\'t know the shot-sequence codes, click <img src="/images/help_inline.png" height="20"> to display a cheat sheet.  Click the <img src="/images/dl_inline.png" height="20"> icon to save your work and <img src="/images/reset_inline.png" height="20"> to reset the spreadsheet.  </p> <p>You can find an overview of CourtHive (Version 1) functionality <a target="_blank" href="https://medium.com/@TennisVisuals/courthive-d0caca7c2899">here</a> and read more about why you should consider charting <a target="_blank" href="https://medium.com/the-tennis-notebook/how-to-chart-a-match-cb52ab9f62e5">here</a>.</p> <p>If you would like to see an example, click <a href="'+u+'?mcp=1988_AO_SteffiGraf_ChrisEvert_MCP.csv">here</a> or <a href="'+u+'?mcp=20151122-M-Tour_Finals-F-Roger_Federer-Novak_Djokovic.csv">here</a>. You can also load matches charted using <a href="http://tennis-math.com/" target="_blank">Tennis-Math</a> by following the example of <a href="'+u+'?tennis-math=TTJRd09URXg">this URL</a> or <a href="'+u+'?tennis-math=WmpsbE5UYz0">this URL</a>.';this.charting=c}(),!function(){function getStorage(){var e;try{localStorage.setItem("storage",""),localStorage.removeItem("storage"),e=window.localStorage}catch(t){e=new LocalStorageAlternative}return e}function LocalStorageAlternative(){var e={};this.setItem=function(t,a){e[t]=a},this.getItem=function(t){return"undefined"!=typeof e[t]?e[t]:null},this.removeItem=function(t){e[t]=void 0}}function catchTab(e){9==e.which&&e.preventDefault()}function configureTiebreakAt(e){tiebreakat.getElementsByTagName("option")[0].text=e-1,tiebreakat.getElementsByTagName("option")[0].value=e-1,tiebreakat.getElementsByTagName("option")[1].text=e,tiebreakat.getElementsByTagName("option")[1].value=e,tiebreakat.value=e}function validateDate(e){return e?isNaN(e.split("-").join(""))?"MDinvaliddate":3!=e.split("-").length||10!=e.length?"MDincompletedate":"MDvaliddate":"MDvaliddate"}function setUMOmeta(){var e=metaEdit.storage;playerone.value=e.MEplayerone||"Player One",playertwo.value=e.MEplayertwo||"Player Two",player3.value=e.MEplayer3||"",player4.value=e.MEplayer4||"",tournament.value=e.MEtournament||"",p1hand.value=e.MEp1hand||"",p2hand.value=e.MEp2hand||"",category.value=e.MEcategory||"",round.value=e.MEround||"",matchdate.value=e.MEmatchdate||"",court.value=e.MEcourt||"",surface.value=e.MEsurface||"",umpire.value=e.MEumpire||"",charter.value=e.MEcharter||"",bestof.value=e.MEbestof||"",finalset.value=e.MEfinalset||"normal",firstservice.value=e.MEfirstservice||0,setsto.value=e.MEsetsto||12,configureTiebreakAt(setsto.value/2),tiebreakat.value=e.MEtiebreakat||6,tiebreakto.value=e.MEtiebreakto||7,advantages.value=e.MEadvantages||"true",lets.value=e.MElets||"true"}function resetMeta(){var e=metaEdit.storage;e.MEplayerone="Player One",e.MEplayertwo="Player Two",e.MEplayer3="",e.MEplayer4="",e.MEtournament="",e.MEp1hand="",e.MEp2hand="",e.MEcategory="",e.MEround="",e.MEmatchdate="",e.MEcourt="",e.MEsurface="",e.MEumpire="",e.MEcharter="",e.MEbestof="",e.MEfinalset="normal",e.MEfirstservice=0,e.MEsetsto=12,e.MEtiebreakat=6,e.MEtiebreakto=7,e.MEadvantages="true",e.MElets="true"}function updateUMOmeta(){if(umo){var e=validateDate(matchdate.value);umo.options({match:{first_service:+firstservice.value,sets:+bestof.value,final_set_tiebreak:"normal"==finalset.value||"supertiebreak"==finalset.value?!0:!1,final_set_tiebreak_to:"supertiebreak"==finalset.value?10:7,final_set_tiebreak_only:"supertiebreak"==finalset.value?!0:!1},set:{games:+setsto.value||12,tiebreak:"false"==tiebreakto.value?!1:!0,tiebreak_at:"false"==tiebreakat.value?!1:+tiebreakat.value,tiebreak_to:"false"==tiebreakto.value?7:+tiebreakto.value,advantage:"false"==advantages.value?!1:!0,lets:"false"==lets.value?!1:!0}}),umo.metadata({players:{0:{name:playerone.value,fname:"",lname:"",fh:p1hand.value},1:{name:playertwo.value,fname:"",lname:"",fh:p2hand.value},2:{name:player3.value,fname:"",lname:"",fh:p1hand.value},3:{name:player4.value,fname:"",lname:"",fh:p2hand.value}},tournament:{name:tournament.value,surface:surface.value,round:round.value},match:{date:"MDvaliddate"==e?matchdate.value:"",court:court.value,category:category.value,umpire:umpire.value},charter:charter.value}),umo.update()}}var metaEdit={onChange:void 0};metaEdit.visible=!1,metaEdit.storage=getStorage();var umo,metaHTML=' <div class="flex-meta-parent"> <div class="flex-meta-child"> <h2 class="metaHeading" >Players</h2> </div> <div class="flex-meta-child"> <input type="checkbox" id="choosedoubles" name="choosedoubles" value="doubles" onClick="metaEdit.doublesClick(this)">Doubles </div> </div> <div class="flex-meta-parent"> <div id="p1div" class="flex-meta-child"> <input name="playerone" id="playerone" class="MDplayerentry teamone" type="text" spellcheck="false" placeholder="Player One" tabindex="1" onfocus="this.setSelectionRange(0, this.value.length)" autocomplete="off" aria-autocomplete="list"> <select class="MDselection" name="p1hand" id="p1hand" tabindex="2"> <option value="R">R</option> <option value="L">L</option> </select> </div> <div id="p2div" class="flex-meta-child"> <input name="playertwo" id="playertwo" class="MDplayerentry teamtwo" type="text" spellcheck="false" placeholder="Player Two" tabindex="3" onfocus="this.setSelectionRange(0, this.value.length)" autocomplete="off" aria-autocomplete="list"> <select class="MDselection" name="p2hand" id="p2hand" tabindex="4"> <option value="R">R</option> <option value="L">L</option> </select> </div> </div> <div class="flex-meta-parent"> <div id="p3div" class="flex-meta-child"> <input name="player3" id="player3" class="MDplayerentry teamone" type="text" spellcheck="false" placeholder="2nd Player Team One" tabindex="5" onfocus="this.setSelectionRange(0, this.value.length)" autocomplete="off" aria-autocomplete="list"> <select class="MDselection" name="p3hand" id="p3hand" tabindex="6"> <option value="R">R</option> <option value="L">L</option> </select> </div> <div id="p4div" class="flex-meta-child"> <input name="player4" id="player4" class="MDplayerentry teamtwo" type="text" spellcheck="false" placeholder="2nd Player Team Two" tabindex="7" onfocus="this.setSelectionRange(0, this.value.length)" autocomplete="off" aria-autocomplete="list"> <select class="MDselection" name="p4hand" id="p4hand" tabindex="8"> <option value="R">R</option> <option value="L">L</option> </select> </div> </div> <div class="flex-meta-parent"> <div class="flex-meta-child"> <h2 class="metaHeading" >Match</h2> </div> </div> <div class="flex-meta-parent"> <div class="flex-meta-child"> <label name="firstservice_label" id="firstservice_label"> First Service <select class="MDselection" name="firstservice" id="firstservice" tabindex="9"> <option value="0">1</option> <option value="1">2</option> </select> </label> </div> <div class="flex-meta-child"> <label name="advantage_label" id="advantage_label"> Advantages <select class="MDwideselection" name="advantages" id="advantages" tabindex="10"> <option value="true">Normal</option> <option value="false">No Advantage</option> </select> </label> </div> <div class="flex-meta-child"> <label name="lets_label" id="lets_label"> Lets <select class="MDwideselection" name="lets" id="lets" tabindex="11"> <option value="true">Normal</option> <option value="false">No Lets</option> </select> </label> </div> </div> <div class="flex-meta-parent"> <div class="flex-meta-child"> <label name="bestof_label" id="bestof_label"> Best of <select name="bestof" id="bestof" class="MDselection" tabindex="12"> <option value="1">1</option> <option value="3" selected="selected">3</option> <option value="5">5</option> </select> </label> </div> <div class="flex-meta-child"> <label name="setsto_label" id="setsto_label"> Sets to <select name="setsto" id="setsto" class="MDselection" tabindex="13"> <option value="8">4</option> <option value="12" selected="selected">6</option> <option value="14">7</option> <option value="16">8</option> <option value="18">9</option> <option value="20">10</option> </select> </label> </div> <div class="flex-meta-child"> <label name="tiebreakat" id="tiebreakat_label"> Tie-break at <select name="tiebreakat" id="tiebreakat" class="MDselection" tabindex="24"> <option value="5">5</option> <option value="6" selected="selected">6</option> <option value="false">-</option> </select> </label> </div> <div class="flex-meta-child"> <label name="tiebreakto_label" id="tiebreakto_label"> Tie-break to <select name="tiebreakto" id="tiebreakto" class="MDselection" tabindex="14"> <option value="7" selected="selected">7</option><option value="12">12</option> <option value="false">-</option> </select> </label> </div> <div class="flex-meta-child"> <label name="finalset_label" id="finalset_label"> Final Set <select name="finalset" id="finalset" class="MDwideselection" tabindex="15"> <option value="normal" selected="selected">Normal</option> <option value="supertiebreak">Super Tie-break</option> <option value="longset">Long Set</option> </select> </label> </div> </div> <div class="flex-meta-parent"> <div class="flex-meta-child"> <label name="round_label" id="round_label"> Round <select class="MDround" name="round" id="round" tabindex="17"> <option value="">-</option> <option value="F">F</option> <option value="SF">SF</option> <option value="QF">QF</option> <option value="R16">R16</option> <option value="R32">R32</option> <option value="R64">R64</option> <option value="R128">R128</option> <option value="Q1">Q1</option> <option value="Q2">Q2</option> </select> </label> </div> <div class="flex-meta-child"> <label name="surface_label" id="surface_label"> Surface <select class="MDround" name="surface" id="surface" tabindex="18"> <option value="">-</option> <option value="H">Hard</option> <option value="C">Clay</option> <option value="G">Grass</option> <option value="T">HarTru</option> </select> </label> </div> <div class="flex-meta-child"> <label name="category_label" id="category_label"> Gender <select name="category" id="category" class="MDselection" tabindex="19"> <option value="">-</option> <option value="M">M</option> <option value="W">W</option> </select> </label> </div> </div> <div class="flex-meta-parent"> <div class="flex-meta-child"> <label id="court_label" name="court_label"> Court <input autocomplete="off" name="court" class="MDcourt" type="text" value="" id="court" placeholder="Court" tabindex="20"> </label> </div> <div class="flex-meta-child"> <label id="umpire_label" name="umpire_label"> Umpire <input autocomplete="off" name="umpire" class="MDumpire" type="text" value="" id="umpire" placeholder="Umpire" tabindex="21"> </label> </div> </div> <div class="flex-meta-parent"> <div class="flex-meta-child"> <label id="date_label"> Date <input autocomplete="off" name="matchdate" class="MDvaliddate" type="text" value="" id="matchdate" placeholder="YYYY-MM-DD" tabindex="22"> </label> </div> <div class="flex-meta-child"> <label id="chartedby_label"> Charted by <input autocomplete="off" name="charter" class="MDcharter" type="text" value="" id="charter" placeholder="" tabindex="23"> </label> </div> </div> <div class="flex-meta-parent"> <div class="flex-meta-child"> <h2 class="metaHeading" >Tournament</h2> </div> </div> <div class="flex-meta-parent"> <div class="flex-meta-child"> <input autocomplete="off" name="tournament" class="MDtournament" type="text" value="" id="tournament" placeholder="Tournament Name" tabindex="16"> </div> </div> <p> <div class="flex-meta-parent flex-center"> <div class="flex-meta-child"> <button id="metaSubmit" class="btn meta-btn meta-submit" alt="Submit Metadata" onclick="metaEdit.submitMeta()" tabindex="-1">Submit</button> <button id="metaCancel" class="btn meta-btn meta-cancel" alt="Cancel Metadata" onclick="metaEdit.cancelMeta()" tabindex="-1">Cancel</button> </div> </div> ',meta=d3.select("body").append("div").attr("id","meta").style("display","none");document.getElementById("meta").innerHTML=metaHTML;var playerone=document.getElementById("playerone"),playertwo=document.getElementById("playertwo"),player3=document.getElementById("player3"),player4=document.getElementById("player4"),tournament=document.getElementById("tournament"),court=document.getElementById("court"),umpire=document.getElementById("umpire"),matchdate=document.getElementById("matchdate"),charter=document.getElementById("charter"),p1hand=document.getElementById("p1hand"),p2hand=document.getElementById("p2hand"),p3hand=document.getElementById("p3hand"),p4hand=document.getElementById("p4hand"),category=document.getElementById("category"),round=document.getElementById("round"),surface=document.getElementById("surface"),bestof=document.getElementById("bestof"),finalset=document.getElementById("finalset"),firstservice=document.getElementById("firstservice"),setsto=document.getElementById("setsto"),tiebreakat=document.getElementById("tiebreakat"),tiebreakto=document.getElementById("tiebreakto"),advantages=document.getElementById("advantages"),lets=document.getElementById("lets");metaEdit.disable=function(e){e=void 0==e?!1:!0,playerone.disabled=e,playertwo.disabled=e,player3.disabled=e,player4.disabled=e,tournament.disabled=e,court.disabled=e,umpire.disabled=e,matchdate.disabled=e,charter.disabled=e,p1hand.disabled=e,p2hand.disabled=e,p3hand.disabled=e,p4hand.disabled=e,category.disabled=e,round.disabled=e,surface.disabled=e,bestof.disabled=e,finalset.disabled=e,firstservice.disabled=e,setsto.disabled=e,tiebreakat.disabled=e,tiebreakto.disabled=e,advantages.disabled=e,lets.disabled=e},metaEdit.doublesClick=function(e){e.checked?(d3.select("#p3div").style("display","inline"),d3.select("#p4div").style("display","inline")):(d3.select("#p3div").style("display","none"),d3.select("#p4div").style("display","none"))},metaEdit.submitMeta=function(){updateUMOmeta(),metaEdit.hide(),metaEdit.onChange&&metaEdit.onChange()},metaEdit.cancelMeta=function(){metaEdit.update(),metaEdit.hide()},metaEdit.update=function(){if(umo){var e=umo.metadata(),t=metaEdit.storage;playerone.value=t.MEplayerone=e.players[0].name||"Player One",playertwo.value=t.MEplayertwo=e.players[1].name||"Player Two",player3.value=t.MEplayer3=e.players[2].name||"",player4.value=t.MEplayer4=e.players[3].name||"",tournament.value=t.MEtournament=e.tournament.name||"",p1hand.value=t.MEp1hand=e.players[0].fh||"R",p2hand.value=t.MEp2hand=e.players[1].fh||"R",category.value=t.MEcategory=e.match.category||"",round.value=t.MEround=e.tournament.round||"",matchdate.value=t.MEmatchdate=e.match.date||"",court.value=t.MEcourt=e.match.court||"",surface.value=t.MEsurface=e.tournament.surface?e.tournament.surface.slice(0,1):"",umpire.value=t.MEumpire=e.match.umpire||"",charter.value=t.MEcharter=e.charter||"",bestof.value=t.MEbestof=umo.options().match.sets||"3",firstservice.value=t.MEfirstservice=umo.options().match.first_service||0,setsto.value=t.MEsetsto=umo.options().set.games||12,configureTiebreakAt(setsto.value/2),tiebreakat.value=t.MEtiebreakat=umo.options().set.tiebreak_at?umo.options().set.tiebreak_at||6:"false",tiebreakto.value=t.MEtiebreakto=umo.options().set.tiebreak?umo.options().set.tiebreak_to||7:"false",advantages.value=t.MEadvantages=umo.options().set.advantage?"true":"false",lets.value=t.MElets=umo.options().set.lets?"true":"false",finalset.value=t.MEfinalset=umo.options().match.final_set_tiebreak_only?"supertiebreak":umo.options().match.final_set_tiebreak?"normal":"longset"}},metaEdit.colors=function(e){d3.select("#playerone").style("border","2px solid"+e[0]),d3.select("#playertwo").style("border","2px solid"+e[1]),d3.select("#player3").style("border","2px solid"+e[0]),d3.select("#player4").style("border","2px solid"+e[1])},metaEdit.show=function(){if(player3.value||player4.value){var e=document.getElementById("choosedoubles");e.checked=!0,metaEdit.doublesClick(e)}meta.style("display","inline"),metaEdit.visible=!0,playerone.focus()},metaEdit.hide=function(){meta.style("display","none"),metaEdit.visible=!1},metaEdit.umo=function(e){return arguments.length?"function"!=typeof e||"UMO"!=e.type?!1:(umo=e,metaEdit):umo},metaEdit.init=function(){function p1enter(){var e=document.querySelector("#p1div li");e&&(playerone.value=e.textContent),p1Submit()}function p1Submit(){playertwo.focus()}function p2enter(){var e=document.querySelector("#p2div li");e&&(playertwo.value=e.textContent),p2Submit()}function p2Submit(){"none"!=d3.select("#p3div").style("display")?player3.focus():tournament.focus()}function p3enter(){var e=document.querySelector("#p3div li");e&&(player3.value=e.textContent),p3Submit()}function p3Submit(){player4.focus()}function p4enter(){var e=document.querySelector("#p4div li");e&&(player4.value=e.textContent),p2Submit()}function p4Submit(){tournament.focus()}var ajax=new XMLHttpRequest;ajax.open("GET","/api/pldb/",!0),ajax.onload=function(){var playerlist=eval(ajax.responseText).map(function(e){return{value:e[0],label:e[0]+" <b>["+e[1]+"]</b>"}});new Awesomplete(playerone,{list:playerlist}),new Awesomplete(playertwo,{list:playerlist}),new Awesomplete(player3,{list:playerlist}),new Awesomplete(player4,{list:playerlist})},ajax.send(),playerone.addEventListener("keydown",catchTab,!1),playerone.addEventListener("keyup",function(e){(13==e.which||9==e.which)&&p1enter()}),playerone.addEventListener("awesomplete-selectcomplete",function(){p1Submit()},!1),playertwo.addEventListener("keydown",catchTab,!1),playertwo.addEventListener("keyup",function(e){(13==e.which||9==e.which)&&p2enter()}),playertwo.addEventListener("awesomplete-selectcomplete",function(){p2Submit()},!1),player3.addEventListener("keydown",catchTab,!1),player3.addEventListener("keyup",function(e){(13==e.which||9==e.which)&&p3enter()}),player3.addEventListener("awesomplete-selectcomplete",function(){p3Submit()},!1),player4.addEventListener("keydown",catchTab,!1),player4.addEventListener("keyup",function(e){(13==e.which||9==e.which)&&p4enter()}),player4.addEventListener("awesomplete-selectcomplete",function(){p4Submit()},!1),matchdate.addEventListener("keyup",function(){var e=validateDate(matchdate.value);matchdate.className=e}),setsto.addEventListener("change",function(){configureTiebreakAt(setsto.value/2)}),umo.points().length?metaEdit.update():(setUMOmeta(),updateUMOmeta())},this.metaEdit=metaEdit}(),!function(){function e(t,a){if(t&&a)for(var n=Object.keys(t),l=Object.keys(a),i=0;i<n.length;i++)if(l.indexOf(n[i])>=0){var o=a[n[i]],s=t[n[i]];"object"==typeof o&&"function"!=typeof s&&o.constructor!==Array?e(t[n[i]],a[n[i]]):a[n[i]]=t[n[i]]}}function t(){var e;try{localStorage.setItem("storage",""),localStorage.removeItem("storage"),e=window.localStorage}catch(t){e=new a}return e}function a(){var e={};this.setItem=function(t,a){e[t]=a},this.getItem=function(t){return"undefined"!=typeof e[t]?e[t]:null},this.removeItem=function(t){e[t]=void 0}}function n(){var e=document.getElementsByClassName("cache"),t=Object.keys(e);try{t.forEach(function(t){isNaN(t)||(k.storage[e[t].id]="")})}catch(a){}S.forEach(function(e){try{e.value=x[e.id],s(e,"")}catch(t){e.value="",s(e,"")}})}function l(e){e=e||0;for(var t=document.querySelectorAll(".mcpInfo"),a=0;a<t.length;a++){var n=t[a].id.match(/\d/g).join("");n>e&&(t[a].innerHTML="")}}function i(e){return"function"==typeof sequences.stripNonMCP?sequences.stripNonMCP(e):e}function o(e,t){t=t||this,y(null,t.value,t);var a,n=i(t.value),l=sequences.validator(n),o=l.valid?"cellvalid":"cellinvalid";9==e.which&&e.shiftKey?a=v(t):37==e.which||(38==e.which?a=p(t,!0):39==e.which||(40==e.which?a=p(t):(13==e.which||9==e.which)&&(l.valid&&l.complete?(a=u(t,l.fault),k.populateUMO()):l.valid&&!l.complete&&s(t,"cellincomplete"),l.message&&B.pointDescription&&B.pointDescription(l.message))));var d=sequences.pointParser([n]),r=t.id.match(/\d+/g).join("");"function"==typeof d.rallyLength&&b(C+r,d.rallyLength());var c=sequences.describePoint(d);c&&B.pointDescription&&B.pointDescription(c.join("; ")),t.classList.contains(o)||s(t,o),""==n&&B.pointDescription&&B.pointDescription("")}function s(e,t){e.classList.remove("cellincomplete"),e.classList.remove("cellvalid"),e.classList.remove("cellinvalid"),e.classList.remove("cellempty"),t&&e.classList.add(t)}function d(e){9==e.which&&e.preventDefault()}function r(e){9==e.which&&e.shiftKey?v(this):(9==e.which||13==e.which)&&m(this)}function p(e,t){var a=e.id.match(/[A-Za-z]/g).join(""),n=e.id.match(/\d/g).join(""),l=t&&n>1?+n-1:!t&&L-1>n?+n+1:n,i=document.querySelector("#"+a+l);return i.focus(),i}function u(e,t){var a=e.id.match(/[A-Za-z]/g).join(""),n=e.id.match(/\d/g).join(""),l=a!=I&&t?n:+n+1,i=a==_&&t?I:_,o=document.querySelector("#"+i+l);return o.focus(),o}function m(e){var t=e.id.match(/\d/g).join(""),a=L-1>t?+t+1:t,n=_,l=document.querySelector("#"+n+a);return l.focus(),l}function v(e){var t=e.id.match(/[A-Za-z]/g).join(""),a=e.id.match(/\d/g).join(""),n=t==_?+a-1:a,l=t==I?_:_,i=document.querySelector("#"+l+n);return i.focus(),i}function b(e,t){var a=document.getElementById(e);a.innerHTML=t}function h(e,t){var a=document.getElementById(e);a.style.color=t}function f(e){var t=document.getElementById(e);return t.value}function y(e,t,a){a=a||document.getElementById(e);var n=a.className.split(" ").filter(function(e){return e.indexOf("font")>=0}).join(" "),l=+n.split("font")[1],i=g(t,a.className);i>255&&l>9?(a.classList.remove(n),a.classList.add("font"+(l-1))):230>i&&14>l&&(a.classList.remove(n),a.classList.add("font"+(l+1)))}function g(e,t){var a=document.querySelector("#textWidth"),n=t.split(" ").filter(function(e){return e.indexOf("cell")<0}).join(" ");return a.className=n,a.innerHTML=e,a.clientWidth}function E(e){if(e=e||1,b("A"+e,1==e?"0":""),b("B"+e,1==e?"0":""),b("C"+e,1==e?"0":""),b("D"+e,1==e?"0":""),b("E"+e,1==e?"0-0":""),b("F"+e,1==e?"1":""),1==e){var t=document.getElementById(_+"1");t.focus()}}function M(e){for(var t=document.querySelectorAll(".notes"),a=0;a<t.length;a++)t[a].style.width=e+"px"}var k={};k.storage=t();var w,x,S,L=600,C="H",_="I",I="J",T="K",D=[],B={pointDescription:null,finishedLoad:null};k.events=function(t){return arguments.length?(e(t,B),k):B},k.init=function(){for(var e=["pt #","S1","S2","G1","G2","Pts","G#","Srv","R","1st","2nd","Notes"],t=document.querySelector("#mcpHeader").insertRow(-1),a=0;12>a;a++){var n=t.insertCell(-1),l="cell"+a;11==a&&(l+=" notes"),n.innerHTML=e[a],n.className=l}for(var c=0;L>c;c++)for(var t=document.querySelector("#mcpPoints").insertRow(-1),a=0;12>a;a++){var p="",u=a>0?String.fromCharCode("A".charCodeAt(0)+a-1):"",m=9>a?"span":"input",v=" tabIndex = -1",l="cell cell"+a,b=10==a?" onfocus='this.setSelectionRange(0, this.value.length)'":"";9>a&&(l+=" mcpInfo"),(9==a||10==a)&&(l+=" font14 service cache",p=" spellcheck='false'"),11==a&&(l+=" notes cache"),t.insertCell(-1).innerHTML=c&&a?"<"+m+v+p+b+" class='"+l+"' id='"+u+c+"'/>":c||""}E(),x={},S=[].slice.call(document.querySelectorAll(".cache")),S.forEach(function(e){e.onfocus=function(t){e.classList.contains("notes")&&(t.target.value=k.storage[t.target.id]||"",d3.select("#statPanel").style("display","none"),k.sizeNotes(350)),e.classList.contains("service")&&(t.target.value=i(k.storage[t.target.id]))},e.onblur=function(t){var a=e.classList.contains("notes");if(a)k.storage[t.target.id]=t.target.value,d3.select("#statPanel").style("display","inline"),k.sizeNotes(40);else{var n=t.target.value!=i(k.storage[t.target.id]);n&&(k.storage[t.target.id]=t.target.value,computeAll())}};var t=function(){return i(k.storage[e.id])};Object.defineProperty(x,e.id,{get:t}),Object.defineProperty(x,e.id.toLowerCase(),{get:t})}),(window.computeAll=function(){S.forEach(function(e){try{if(x[e.id]&&(e.value=x[e.id]),e.classList.contains("service")){var t=sequences.validator(e.value),a=t.valid?"cellvalid":"cellinvalid";"cellvalid"!=a||t.complete||(a="cellincomplete"),e.classList.contains(a)||s(e,a)}}catch(n){}})})();for(var h=document.querySelectorAll(".service"),c=0;c<h.length;c++)h[c].addEventListener("keydown",d,!1),h[c].addEventListener("keyup",o,!1);for(var f=document.querySelectorAll(".notes"),c=0;c<f.length;c++)f[c].addEventListener("keydown",d,!1),f[c].addEventListener("keyup",r,!1)},k.reset=function(){w.reset(),l(),E(),n(),k.update(),B.pointDescription&&B.pointDescription(""),history.pushState({foo:""},"","?")},k.umo=function(e,t){if(!arguments.length)return w;if("function"!=typeof e||"UMO"!=e.type)return!1;if(w=e,0==t)return k;if(w.points().length)k.populateSS();else{var a=!0;k.populateUMO(a),w.points().length&&B.finishedLoad&&B.finishedLoad()}return k},k.update=function(){D.length&&D.forEach(function(e){"function"==typeof e&&e()})},k.callback=function(e){return arguments.length?void("function"==typeof e?D.push(e):"array"==typeof e&&e.foreach(c)(function(e){"function"==typeof e&&D.push(e)})):D},k.populateSS=function(){l(),E(),n(),w.points().forEach(function(e,t){if(e.code){var a=e.code.split("|"),n=_+(+t+1);k.storage[n]=a[0];var l=document.querySelector("#"+n);if(l.value=i(a[0]),a[1]){var o=I+(+t+1);a[1]&&(k.storage[o]=a[1]);var l=document.querySelector("#"+o);l.value=i(a[1])}if(e.note){var s=T+(+t+1);k.storage[s]=e.note;var l=document.querySelector("#"+s);l.value=e.note}}}),k.populateUMO()},k.populateUMO=function(e){if(void 0!=w.nextService()){w.points([]);for(var t=w.players(),a=1;L>a;a++){var n=w.nextService(),l=t[n].split(" ").map(function(e){return e[0]}).join("");b("G"+a,l),k.colors&&h("G"+a,k.colors[n]);var i=f(_+a),o=f(I+a),s=f(T+a);y(_+a,i),y(I+a,o);var d=k.storage[_+a],r=k.storage[I+a];if(""==d&&""==r)break;var c=sequences.pointParser([d,r]);if(!c.result)break;s.length&&(c.note=s);var p=w.push(c);if(!p.result)break;var u=n?p.point.score.split("-").reverse().join("-"):p.point.score;

b("E"+(a+1),u.indexOf("G")>=0?"0-0":u);var m=w.score(),v=m.score;b("A"+(a+1),v[0]),b("B"+(a+1),v[1]);var g=w.score().match_score.split(",").length,E=w.sets()[g-1].score().games;b("C"+(a+1),E[0]),b("D"+(a+1),E[1]);var M=w.sets().map(function(e){return e.games().length}).reduce(function(e,t){return e+t});M=u.indexOf("G")>=0?M+1:M,b("F"+(a+1),M),b(C+a,p.point.rallyLength())}if(e){var x=document.getElementById(_+1);x.focus()}k.update()}},k.scrollTo=function(e){var t=w.pointIndex(e.set,e.game,e.score),a=document.getElementById(_+(+t+1));a.focus()},k.sizeNotes=M,this.mcps=k}();var help='<table id="helpTable"> <tr> <td class="helpCol" valign="top"> <b>Serves</b> <table class="mcpKeys"> <tr><td>4</td><td>&nbsp;&nbsp;</td><td>Wide</td><td></td><td></td></tr> <tr><td>5</td><td>&nbsp;&nbsp;</td><td>Body</td><td></td><td></td></tr> <tr><td>6</td><td>&nbsp;&nbsp;</td><td>T</td><td></td><td></td></tr> <tr><td>0</td><td>&nbsp;&nbsp;</td><td>Unknown</td><td></td><td></td></tr> <tr><td></td><td>&nbsp;&nbsp;</td><td></td><td></td><td></td></tr> </table> <b>Shot Direction</b> <table class="mcpKeys"> <tr><td>1</td><td>&nbsp;&nbsp;</td><td>Left</td><td></td><td></td></tr> <tr><td>2</td><td>&nbsp;&nbsp;</td><td>Center</td><td></td><td></td></tr> <tr><td>3</td><td>&nbsp;&nbsp;</td><td>Right</td><td></td><td></td></tr> <tr><td></td><td>&nbsp;&nbsp;</td><td></td><td></td><td></td></tr> </table> </td> <td class="helpCol" valign="top"> <b>Rally Shots</b> <table class="mcpKeys"> <tr><td>f</td><td>&nbsp;&nbsp;</td><td><center>Hand         </center></td><td>&nbsp;&nbsp;</td><td>b</td></tr> <tr><td>r</td><td>&nbsp;&nbsp;</td><td><center>Slice        </center></td><td>&nbsp;&nbsp;</td><td>s</td></tr> <tr><td>l</td><td>&nbsp;&nbsp;</td><td><center>Lob          </center></td><td>&nbsp;&nbsp;</td><td>m</td></tr> <tr><td>v</td><td>&nbsp;&nbsp;</td><td><center>Volley       </center></td><td>&nbsp;&nbsp;</td><td>z</td></tr> <tr><td>o</td><td>&nbsp;&nbsp;</td><td><center>Smash        </center></td><td>&nbsp;&nbsp;</td><td>p</td></tr> <tr><td>u</td><td>&nbsp;&nbsp;</td><td><center>Drop Shot    </center></td><td>&nbsp;&nbsp;</td><td>y</td></tr> <tr><td>h</td><td>&nbsp;&nbsp;</td><td><center>Half Volley  </center></td><td>&nbsp;&nbsp;</td><td>i</td></tr> <tr><td>j</td><td>&nbsp;&nbsp;</td><td><center>Drive Volley </center></td><td>&nbsp;&nbsp;</td><td>k</td></tr> <tr><td>t</td><td>&nbsp;&nbsp;</td><td><center>Trick Shot   </center></td><td>&nbsp;&nbsp;</td><td>t</td></tr> <tr><td>q</td><td>&nbsp;&nbsp;</td><td><center>Unknown      </center></td><td>&nbsp;&nbsp;</td><td>q</td></tr> </table> </td> <td class="helpCol" valign="top"> <b>Errors</b> <table class="mcpKeys"> <tr><td>n</td><td>&nbsp;&nbsp;</td><td>Netted</td><td></td><td></td></tr> <tr><td>w</td><td>&nbsp;&nbsp;</td><td>Out Wide</td><td></td><td></td></tr> <tr><td>d</td><td>&nbsp;&nbsp;</td><td>Out Long</td><td></td><td></td></tr> <tr><td>x</td><td>&nbsp;&nbsp;</td><td>Wide and Long</td><td></td><td></td></tr> <tr><td>e</td><td>&nbsp;&nbsp;</td><td>Unknown Error</td><td></td><td></td></tr> <tr><td>g</td><td>&nbsp;&nbsp;</td><td>Foot Fault</td><td></td><td></td></tr> <tr><td>!</td><td>&nbsp;&nbsp;</td><td>Shank</td><td></td><td></td></tr> <tr><td></td><td>&nbsp;&nbsp;</td><td></td><td></td><td></td></tr> </table> </td> <td class="helpCol" valign="top"> <b>Shot Depth</b> <table class="mcpKeys"> <tr><td>7</td><td>&nbsp;&nbsp;</td><td>Shallow</td><td></td><td></td></tr> <tr><td>8</td><td>&nbsp;&nbsp;</td><td>Deep</td><td></td><td></td></tr> <tr><td>9</td><td>&nbsp;&nbsp;</td><td>Near Baseline</td><td></td><td></td></tr> <tr><td></td><td>&nbsp;&nbsp;</td><td></td><td></td><td></td></tr> </table> <b>Point Terminators</b> <table class="mcpKeys"> <tr><td>*</td><td>&nbsp;&nbsp;</td><td>Winner</td><td></td><td></td></tr> <tr><td>#</td><td>&nbsp;&nbsp;</td><td>Forced Error</td><td></td><td></td></tr> <tr><td>@</td><td>&nbsp;&nbsp;</td><td>Unforced Error</td><td></td><td></td></tr> <tr><td></td><td>&nbsp;&nbsp;</td><td></td><td></td><td></td></tr> </table> </td> <td class="helpCol" valign="top"> <b>Incidentals</b> <table class="mcpKeys"> <tr><td>;</td><td>&nbsp;&nbsp;</td><td>Net Cord</td><td></td><td></td></tr> <tr><td>c</td><td>&nbsp;&nbsp;</td><td>Let</td><td></td><td></td></tr> <tr><td></td><td>&nbsp;&nbsp;</td><td></td><td></td><td></td></tr> </table> <b>Position</b> <table class="mcpKeys"> <tr><td>+</td><td>&nbsp;&nbsp;</td><td>Approach</td><td></td><td></td></tr> <tr><td>-</td><td>&nbsp;&nbsp;</td><td>at the Net</td><td></td><td></td></tr> <tr><td>=</td><td>&nbsp;&nbsp;</td><td>Baseline</td><td></td><td></td></tr> </table> </td> <td class="helpCol" valign="top"> <b>Point Assignment</b> <table class="mcpKeys"> <tr><td>S</td><td>&nbsp;&nbsp;</td><td>Server Point</td><td></td><td></td></tr> <tr><td>P</td><td>&nbsp;&nbsp;</td><td>Server Penalty</td><td></td><td></td></tr> <tr><td>R</td><td>&nbsp;&nbsp;</td><td>Receiver Point</td><td></td><td></td></tr> <tr><td>Q</td><td>&nbsp;&nbsp;</td><td>Receiver Penalty</td><td></td><td></td></tr> </table> </td> </tr> </table>',hlp=document.getElementById("help");hlp.innerHTML=help,!function(){function e(){var e=document.querySelector("#"+r.domElement+" li");e&&(i.value=e.textContent.split("[")[0].trim()),t()}function t(){document.getElementById("blur").focus(),"function"==typeof c.submit&&c.submit(i.value),a()}function a(e){if(o){var t=o.style.visibility||"hidden";"close"==e?o.style.visibility="hidden":"open"==e?(o.style.visibility="visible",i&&i.focus()):(interact.toggleMenu("close"),"hidden"==t?(o.style.visibility="visible",i&&i.focus()):o.style.visibility="hidden")}}function n(e,t){if(e&&t)for(var a=Object.keys(e),l=Object.keys(t),i=0;i<a.length;i++)if(l.indexOf(a[i])>=0){var o=t[a[i]],s=e[a[i]];"object"==typeof o&&"function"!=typeof s&&o.constructor!==Array?n(e[a[i]],t[a[i]]):t[a[i]]=e[a[i]]}}function l(e){9==e.which&&e.preventDefault()}var i,o,s={},d=!1,r={domElement:void 0,searchForm:void 0,searchIcon:void 0},c={submit:void 0};s.init=function(){if(!r.domElement||!r.searchForm)return d=!1,!1;if(o=document.getElementById(r.domElement),i=document.getElementById(r.searchForm),!o||!i)return d=!1,!1;if(r.searchIcon){var n=document.getElementById(r.searchIcon);n&&(n.onclick=function(){a()})}var s=document.createElement("input");i.appendChild(s),s.setAttribute("id","blur"),s.setAttribute("type","text"),s.style.position="absolute",s.style.opacity="0",i.addEventListener("keydown",l,!1),i.addEventListener("keyup",function(t){(13==t.which||9==t.which)&&e()}),i.addEventListener("awesomplete-selectcomplete",function(){t()},!1)},s.toggleSearch=a,s.options=function(e){return arguments.length?(n(e,r),s):r},s.events=function(e){return arguments.length?(n(e,c),s):c},this.search=s}();